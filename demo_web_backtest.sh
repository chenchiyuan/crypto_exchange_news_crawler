#!/bin/bash

# ç½‘æ ¼äº¤æ˜“å›æµ‹Webç³»ç»Ÿæ¼”ç¤ºè„šæœ¬

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  ğŸš€ ç½‘æ ¼äº¤æ˜“å›æµ‹Webå¯è§†åŒ–ç³»ç»Ÿ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
echo "ğŸ“¡ æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€..."
if curl -s http://127.0.0.1:8001/backtest/ > /dev/null 2>&1; then
    echo "âœ… æœåŠ¡å™¨å·²è¿è¡Œåœ¨ç«¯å£ 8001"
else
    echo "âš ï¸  æœåŠ¡å™¨æœªå¯åŠ¨ï¼Œæ­£åœ¨å¯åŠ¨..."
    python manage.py runserver 8001 &
    SERVER_PID=$!
    echo "   æœåŠ¡å™¨PID: $SERVER_PID"
    sleep 3
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  ğŸ“Š è¿è¡Œå›æµ‹æµ‹è¯•"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# è¿è¡ŒAPIæµ‹è¯•
python test_backtest_api.py

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  ğŸŒ è®¿é—®Webç•Œé¢"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  æµè§ˆå™¨è®¿é—®: http://127.0.0.1:8001/backtest/"
echo ""
echo "  åŠŸèƒ½ï¼š"
echo "  âœ… é…ç½®å›æµ‹å‚æ•°"
echo "  âœ… ä¸€é”®è¿è¡Œå›æµ‹"
echo "  âœ… å¯è§†åŒ–å›¾è¡¨å±•ç¤º"
echo "  âœ… å›æ”¾æ§åˆ¶"
echo "  âœ… äº¤æ˜“æ—¥å¿—æŸ¥çœ‹"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# è¯¢é—®æ˜¯å¦æ‰“å¼€æµè§ˆå™¨
read -p "æ˜¯å¦åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€? (y/n): " -n 1 -r
echo ""
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "ğŸŒ æ­£åœ¨æ‰“å¼€æµè§ˆå™¨..."
    if command -v open &> /dev/null; then
        # macOS
        open http://127.0.0.1:8001/backtest/
    elif command -v xdg-open &> /dev/null; then
        # Linux
        xdg-open http://127.0.0.1:8001/backtest/
    elif command -v start &> /dev/null; then
        # Windows
        start http://127.0.0.1:8001/backtest/
    else
        echo "âš ï¸  æ— æ³•è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œè¯·æ‰‹åŠ¨è®¿é—®ï¼š"
        echo "   http://127.0.0.1:8001/backtest/"
    fi
fi

echo ""
echo "âœ¨ æ¼”ç¤ºå®Œæˆï¼"
echo ""
