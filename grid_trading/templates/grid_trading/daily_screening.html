<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å†é€‰å¸Dashboard - é‡åŒ–ç»ˆç«¯</title>
    <style>
        /* ========== Design Tokens ========== */
        :root {
            --bg-body: #0b0e11;
            --bg-card: #15181f;
            --bg-hover: #1e232d;
            --bg-input: #0b0e11;
            --border-color: #2b313a;
            --text-main: #e1e7ef;
            --text-sub: #8492a6;
            --primary: #2962ff;
            --success: #00c853;
            --warning: #ffd600;
            --danger: #ff1744;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --radius: 6px;
            --font-base: 'Inter', -apple-system, sans-serif;
            --font-mono: 'Roboto Mono', monospace;
            --text-sm: 12px;
            --text-base: 13px;
            --text-md: 14px;
            --text-lg: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-base);
            background-color: var(--bg-body);
            color: var(--text-main);
            padding: var(--space-5);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        /* ========== Header ========== */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .header h1 {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--text-main);
        }

        .header-actions {
            display: flex;
            gap: var(--space-3);
        }

        .btn {
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-main);
            font-size: var(--text-sm);
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background: var(--bg-hover);
            border-color: var(--primary);
        }

        /* ========== Date Selector ========== */
        .date-selector-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: var(--space-5);
        }

        .date-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--space-3);
            margin-top: var(--space-4);
        }

        .date-item {
            background: var(--bg-input);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            padding: var(--space-4);
            cursor: pointer;
            transition: all 0.2s;
        }

        .date-item:hover {
            border-color: var(--primary);
            background: var(--bg-hover);
        }

        .date-item.active {
            border-color: var(--primary);
            background: rgba(41, 98, 255, 0.1);
        }

        .date-item-date {
            font-size: var(--text-md);
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: var(--space-2);
        }

        .date-item-meta {
            font-size: var(--text-sm);
            color: var(--text-sub);
            display: flex;
            gap: var(--space-3);
            flex-wrap: wrap;
        }

        .date-item-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* ========== Results Section ========== */
        .results-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: var(--space-5);
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--border-color);
        }

        .results-title {
            font-size: var(--text-lg);
            font-weight: 600;
        }

        .results-meta {
            font-size: var(--text-sm);
            color: var(--text-sub);
            display: flex;
            gap: var(--space-4);
        }

        /* ========== Table ========== */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--text-sm);
        }

        thead {
            background: var(--bg-input);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: var(--space-3);
            text-align: left;
            font-weight: 600;
            color: var(--text-sub);
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            color: var(--primary);
        }

        td {
            padding: var(--space-3);
            border-bottom: 1px solid var(--border-color);
        }

        tbody tr {
            transition: background 0.15s;
        }

        tbody tr:hover {
            background: var(--bg-hover);
        }

        .symbol-cell {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--primary);
        }

        .number-cell {
            font-family: var(--font-mono);
            text-align: right;
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        /* ========== Loading & Empty States ========== */
        .loading {
            text-align: center;
            padding: var(--space-6);
            color: var(--text-sub);
        }

        .empty {
            text-align: center;
            padding: var(--space-6);
            color: var(--text-sub);
        }

        /* ========== Filter Info ========== */
        .filter-info {
            background: var(--bg-input);
            border-radius: var(--radius);
            padding: var(--space-3);
            margin-bottom: var(--space-4);
            font-size: var(--text-sm);
            color: var(--text-sub);
        }

        .filter-info strong {
            color: var(--text-main);
        }

        /* ========== Responsive ========== */
        @media (max-width: 768px) {
            .date-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-3);
            }

            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-3);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“… æ—¥å†é€‰å¸Dashboard</h1>
            <div class="header-actions">
                <a href="/screening/" class="btn">â† è¿”å›å®æ—¶ç­›é€‰</a>
                <a href="/grids/" class="btn">ç½‘æ ¼ç®¡ç†</a>
            </div>
        </div>

        <!-- Date Selector -->
        <div class="date-selector-card">
            <h2 style="font-size: var(--text-md); margin-bottom: var(--space-2);">é€‰æ‹©æ—¥æœŸ</h2>
            <p style="font-size: var(--text-sm); color: var(--text-sub); margin-bottom: var(--space-4);">
                åŸºäºæ¯æ—¥10ç‚¹å‰æ•°æ®åˆ†æçš„é€‰å¸ç»“æœ
            </p>
            <div id="dateGrid" class="date-grid">
                <div class="loading">åŠ è½½æ—¥æœŸåˆ—è¡¨...</div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section">
            <div class="results-header">
                <div>
                    <h2 class="results-title" id="resultsTitle">ç­›é€‰ç»“æœ</h2>
                    <div class="results-meta" id="resultsMeta"></div>
                </div>
            </div>

            <!-- Filter Controls -->
            <div class="filter-controls" style="background: var(--bg-card); border-radius: var(--radius); padding: var(--space-4); margin-bottom: var(--space-3); border: 1px solid var(--border-color);">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-3);">
                    <h3 style="font-size: var(--text-md); font-weight: 500;">åŠ¨æ€ç­›é€‰æ¡ä»¶</h3>
                    <button id="resetFilters" class="btn" style="padding: 4px 12px; font-size: var(--text-sm);">æ¢å¤é»˜è®¤</button>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-3);">
                    <div>
                        <label style="display: block; font-size: var(--text-sm); color: var(--text-sub); margin-bottom: 4px;">VDR â‰¥</label>
                        <input type="number" id="filterMinVdr" step="0.1" placeholder="ä¸é™"
                               style="width: 100%; padding: 6px 10px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-main); font-size: var(--text-sm);">
                    </div>
                    <div>
                        <label style="display: block; font-size: var(--text-sm); color: var(--text-sub); margin-bottom: 4px;">15mæŒ¯å¹… â‰¥ (%)</label>
                        <input type="number" id="filterMinAmplitude" step="1" placeholder="ä¸é™"
                               style="width: 100%; padding: 6px 10px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-main); font-size: var(--text-sm);">
                    </div>
                    <div>
                        <label style="display: block; font-size: var(--text-sm); color: var(--text-sub); margin-bottom: 4px;">EMA99æ–œç‡ â‰¤</label>
                        <input type="number" id="filterMaxMa99Slope" step="1" placeholder="ä¸é™"
                               style="width: 100%; padding: 6px 10px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-main); font-size: var(--text-sm);">
                    </div>
                    <div>
                        <label style="display: block; font-size: var(--text-sm); color: var(--text-sub); margin-bottom: 4px;">å¹´åŒ–èµ„è´¹ â‰¥ (%)</label>
                        <input type="number" id="filterMinFundingRate" step="0.1" placeholder="ä¸é™"
                               style="width: 100%; padding: 6px 10px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-main); font-size: var(--text-sm);">
                    </div>
                    <div>
                        <label style="display: block; font-size: var(--text-sm); color: var(--text-sub); margin-bottom: 4px;">24häº¤æ˜“é‡ â‰¥ (USDT)</label>
                        <input type="number" id="filterMinVolume" step="1000000" placeholder="ä¸é™"
                               style="width: 100%; padding: 6px 10px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-main); font-size: var(--text-sm);">
                    </div>
                </div>
                <div style="margin-top: var(--space-3); padding-top: var(--space-3); border-top: 1px solid var(--border-color);">
                    <button id="applyFilters" class="btn" style="background: var(--primary); color: white; border-color: var(--primary); font-weight: 500;">åº”ç”¨ç­›é€‰</button>
                    <span id="filterStats" style="margin-left: var(--space-3); font-size: var(--text-sm); color: var(--text-sub);"></span>
                </div>
            </div>

            <!-- Filter Info -->
            <div id="filterInfo" class="filter-info"></div>

            <!-- Results Table -->
            <div class="table-container">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th data-sort="rank">æ’å</th>
                            <th data-sort="symbol">æ ‡çš„</th>
                            <th data-sort="current_price">ä»·æ ¼</th>
                            <th data-sort="vdr">VDR</th>
                            <th data-sort="ker">KER</th>
                            <th data-sort="ovr">OVR</th>
                            <th data-sort="amplitude_sum_15m">15mæŒ¯å¹…</th>
                            <th data-sort="ma20_slope">EMA20æ–œç‡</th>
                            <th data-sort="ma99_slope">EMA99æ–œç‡</th>
                            <th data-sort="drawdown_from_high_pct">é«˜ç‚¹å›è½%</th>
                            <th data-sort="annual_funding_rate">å¹´åŒ–èµ„è´¹</th>
                            <th data-sort="open_interest">OI (M)</th>
                            <th data-sort="volume_24h_calculated">24häº¤æ˜“é‡(M)</th>
                            <th data-sort="vol_oi_ratio">Vol/OI</th>
                            <th>æ¨èæŒ‚å•</th>
                            <th>ç½‘æ ¼åŒºé—´</th>
                            <th data-sort="composite_index">ç»¼åˆæŒ‡æ•°</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                        <tr>
                            <td colspan="17" class="loading">è¯·é€‰æ‹©æ—¥æœŸ</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let currentDate = null;
        let currentSortBy = 'amplitude_sum_15m';
        let currentSortOrder = 'desc';
        let allResults = [];

        // é»˜è®¤ç­›é€‰æ¡ä»¶
        const DEFAULT_FILTERS = {
            minVdr: 6,
            minAmplitude: 50,
            maxMa99Slope: -10,
            minFundingRate: -10,
            minVolume: 5000000  // 5M USDT
        };

        // åˆå§‹åŒ–ç­›é€‰æ¡ä»¶
        function initializeFilters() {
            if (DEFAULT_FILTERS.minVdr !== null) {
                document.getElementById('filterMinVdr').value = DEFAULT_FILTERS.minVdr;
            }
            if (DEFAULT_FILTERS.minAmplitude !== null) {
                document.getElementById('filterMinAmplitude').value = DEFAULT_FILTERS.minAmplitude;
            }
            if (DEFAULT_FILTERS.maxMa99Slope !== null) {
                document.getElementById('filterMaxMa99Slope').value = DEFAULT_FILTERS.maxMa99Slope;
            }
            if (DEFAULT_FILTERS.minFundingRate !== null) {
                document.getElementById('filterMinFundingRate').value = DEFAULT_FILTERS.minFundingRate;
            }
            if (DEFAULT_FILTERS.minVolume !== null) {
                document.getElementById('filterMinVolume').value = DEFAULT_FILTERS.minVolume;
            }
        }

        // åŠ è½½æ—¥æœŸåˆ—è¡¨
        async function loadDates() {
            try {
                const response = await fetch('/screening/daily/api/dates/');
                const data = await response.json();

                const dateGrid = document.getElementById('dateGrid');

                if (data.dates.length === 0) {
                    dateGrid.innerHTML = '<div class="empty">æš‚æ— æ—¥å†ç­›é€‰è®°å½•<br><small>è¿è¡Œå‘½ä»¤: python manage.py screen_by_date</small></div>';
                    return;
                }

                dateGrid.innerHTML = data.dates.map(item => `
                    <div class="date-item" data-date="${item.date}" onclick="selectDate('${item.date}')">
                        <div class="date-item-date">${item.date}</div>
                        <div class="date-item-meta">
                            <span>ğŸ“Š ${item.total_candidates}ä¸ªæ ‡çš„</span>
                            <span>â± ${item.execution_time}s</span>
                        </div>
                    </div>
                `).join('');

                // è‡ªåŠ¨é€‰æ‹©æœ€æ–°æ—¥æœŸ
                if (data.dates.length > 0) {
                    selectDate(data.dates[0].date);
                }
            } catch (error) {
                console.error('Failed to load dates:', error);
                document.getElementById('dateGrid').innerHTML = '<div class="empty">åŠ è½½å¤±è´¥</div>';
            }
        }

        // é€‰æ‹©æ—¥æœŸ
        async function selectDate(date) {
            currentDate = date;

            // æ›´æ–°UI
            document.querySelectorAll('.date-item').forEach(item => {
                item.classList.toggle('active', item.dataset.date === date);
            });

            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('resultsSection').classList.add('active');
            document.getElementById('resultsTitle').textContent = `${date} ç­›é€‰ç»“æœ`;
            document.getElementById('resultsBody').innerHTML = '<tr><td colspan="17" class="loading">åŠ è½½ä¸­...</td></tr>';

            // åŠ è½½ç»“æœ
            try {
                // æ„å»ºURLå‚æ•°
                const params = new URLSearchParams({
                    sort_by: currentSortBy,
                    sort_order: currentSortOrder
                });

                // æ·»åŠ è¿‡æ»¤å‚æ•°
                const minVdr = document.getElementById('filterMinVdr').value;
                const minAmplitude = document.getElementById('filterMinAmplitude').value;
                const maxMa99Slope = document.getElementById('filterMaxMa99Slope').value;
                const minFundingRate = document.getElementById('filterMinFundingRate').value;
                const minVolume = document.getElementById('filterMinVolume').value;

                if (minVdr) params.append('min_vdr', minVdr);
                if (minAmplitude) params.append('min_amplitude', minAmplitude);
                if (maxMa99Slope) params.append('max_ma99_slope', maxMa99Slope);
                if (minFundingRate) params.append('min_funding_rate', minFundingRate);
                if (minVolume) params.append('min_volume', minVolume);

                const response = await fetch(`/screening/daily/api/${date}/?${params.toString()}`);
                const data = await response.json();

                allResults = data.results;
                renderResults(data);
            } catch (error) {
                console.error('Failed to load results:', error);
                document.getElementById('resultsBody').innerHTML = '<tr><td colspan="17" class="empty">åŠ è½½å¤±è´¥</td></tr>';
            }
        }

        // æ¸²æŸ“ç»“æœ
        function renderResults(data) {
            const { record, results, filter_stats } = data;

            // æ›´æ–°å…ƒä¿¡æ¯
            document.getElementById('resultsMeta').innerHTML = `
                <span>æ€»æ ‡çš„æ•°: ${record.total_candidates}</span>
                <span>æ‰§è¡Œæ—¶é—´: ${record.execution_time}ç§’</span>
                <span>æƒé‡: VDR ${(record.weights.vdr * 100).toFixed(0)}% | KER ${(record.weights.ker * 100).toFixed(0)}%</span>
            `;

            // æ›´æ–°è¿‡æ»¤ç»Ÿè®¡
            if (filter_stats) {
                document.getElementById('filterStats').innerHTML = `
                    æ˜¾ç¤º <strong>${filter_stats.filtered}</strong> / ${filter_stats.total} ä¸ªæ ‡çš„
                `;
            }

            // æ›´æ–°è¿‡æ»¤æ¡ä»¶ä¿¡æ¯
            const filters = record.filters;
            document.getElementById('filterInfo').innerHTML = `
                <strong>é»˜è®¤ç­›é€‰æ¡ä»¶:</strong>
                VDRâ‰¥${filters.min_vdr || 'ä¸é™'} |
                15mæŒ¯å¹…â‰¥${filters.min_amplitude || 'ä¸é™'}% |
                å¹´åŒ–èµ„è´¹â‰¥${filters.min_funding_rate || 'ä¸é™'}% |
                EMA99æ–œç‡â‰¤${filters.max_ma99_slope || 'ä¸é™'} |
                24häº¤æ˜“é‡â‰¥$${(filters.min_volume / 1000000).toFixed(1)}M
            `;

            // æ¸²æŸ“è¡¨æ ¼
            const tbody = document.getElementById('resultsBody');

            if (results.length === 0) {
                tbody.innerHTML = '<tr><td colspan="17" class="empty">æ— ç¬¦åˆæ¡ä»¶çš„æ ‡çš„</td></tr>';
                return;
            }

            // è¾…åŠ©å‡½æ•°
            const fmtPrice = (price) => {
                const num = parseFloat(price);
                if (isNaN(num) || num === 0) return '0.00';
                if (num >= 1) return num.toFixed(2);
                const absNum = Math.abs(num);
                const leadingZeros = -Math.floor(Math.log10(absNum)) - 1;
                const decimalPlaces = Math.max(2, leadingZeros + 3);
                return num.toFixed(decimalPlaces);
            };
            const fmtNum = (n, d=2) => n.toLocaleString('en-US', {minimumFractionDigits: d, maximumFractionDigits: d});
            const fmtPct = (n) => `${n.toFixed(2)}%`;

            tbody.innerHTML = results.map(r => `
                <tr>
                    <td class="number-cell">${r.rank}</td>
                    <td class="symbol-cell">
                        <a href="https://www.binance.com/zh-CN/futures/${r.symbol}"
                           target="_blank"
                           style="color: var(--primary); text-decoration: none;">
                            ${r.symbol}
                        </a>
                        ${r.has_spot ? '<span style="color: var(--success); font-size: 10px; margin-left: 4px;">ç°</span>' : ''}
                    </td>
                    <td class="number-cell">$${fmtPrice(r.price)}</td>
                    <td class="number-cell">${fmtNum(r.vdr, 1)}</td>
                    <td class="number-cell">${fmtNum(r.ker, 3)}</td>
                    <td class="number-cell">${fmtNum(r.ovr, 2)}</td>
                    <td class="number-cell">${fmtPct(r.amplitude_sum_15m)}</td>
                    <td class="number-cell ${r.ma20_slope >= 0 ? 'positive' : 'negative'}">
                        ${fmtNum(r.ma20_slope || 0, 2)}
                    </td>
                    <td class="number-cell ${r.ma99_slope >= 0 ? 'positive' : 'negative'}">
                        ${fmtNum(r.ma99_slope, 2)}
                    </td>
                    <td class="number-cell ${(r.drawdown_from_high_pct || 0) > 0 ? 'negative' : (r.drawdown_from_high_pct || 0) < 0 ? 'positive' : ''}">
                        ${r.drawdown_from_high_pct !== undefined && r.drawdown_from_high_pct !== null ? fmtPct(r.drawdown_from_high_pct) : '0.00%'}
                    </td>
                    <td class="number-cell ${r.annual_funding_rate >= 0 ? 'positive' : 'negative'}">
                        ${fmtPct(r.annual_funding_rate)}
                    </td>
                    <td class="number-cell" style="font-size: var(--text-sm);">
                        ${((r.open_interest || 0) / 1000000).toFixed(1)}M
                    </td>
                    <td class="number-cell" style="font-size: var(--text-sm);">
                        ${((r.volume_24h_calculated || 0) / 1000000).toFixed(1)}M
                    </td>
                    <td class="number-cell" style="font-weight: 600; color: ${(r.vol_oi_ratio || 0) > 1 ? 'var(--success)' : 'var(--warning)'}">
                        ${(r.vol_oi_ratio || 0).toFixed(3)}
                    </td>
                    <td style="font-size: var(--text-sm); max-width: 150px; padding: var(--space-2);">
                        ${r.entry_candidates && r.entry_candidates.length > 0 ?
                            r.entry_candidates.slice(0, 2).map((cand, idx) => `
                                <div style="margin-bottom: 4px; padding: 4px; ${idx === 0 && r.entry_strategy_label === cand.label ? 'background: rgba(41, 98, 255, 0.1); border-left: 2px solid var(--primary);' : 'border-left: 2px solid var(--border-color);'}">
                                    <div style="font-weight: 600; color: var(--text-main); font-size: 11px;">
                                        ${cand.label}${idx === 0 && r.entry_strategy_label === cand.label ? ' â˜…' : ''}
                                    </div>
                                    <div style="color: var(--primary); font-weight: 600; font-size: 12px;">
                                        $${fmtPrice(cand.entry_price)}
                                    </div>
                                    <div style="font-size: 10px; color: var(--text-sub);">
                                        ${(cand.trigger_prob_24h * 100).toFixed(0)}% Â· ${cand.avg_trigger_time.toFixed(1)}h
                                    </div>
                                </div>
                            `).join('')
                        : '<div style="color: var(--text-sub); font-size: 11px;">æ— å»ºè®®</div>'}
                    </td>
                    <td style="font-size: var(--text-sm);">
                        <div style="color: var(--text-sub);">U: $${fmtPrice(r.grid_upper || 0)}</div>
                        <div style="color: var(--text-sub);">L: $${fmtPrice(r.grid_lower || 0)}</div>
                        <div style="color: ${(r.grid_count || 0) > 100 ? 'var(--danger)' : 'var(--primary)'}; font-weight: 600; margin-top: 2px;">
                            ${r.grid_count || 0}å±‚${(r.grid_count || 0) > 100 ? ' âš ï¸' : ''}
                        </div>
                    </td>
                    <td class="number-cell">${fmtNum(r.composite_index, 2)}</td>
                </tr>
            `).join('');
        }

        // æ’åºåŠŸèƒ½
        document.querySelectorAll('th[data-sort]').forEach(th => {
            th.addEventListener('click', () => {
                const sortBy = th.dataset.sort;

                if (currentSortBy === sortBy) {
                    currentSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSortBy = sortBy;
                    currentSortOrder = 'asc';
                }

                if (currentDate) {
                    selectDate(currentDate);
                }
            });
        });

        // è¿‡æ»¤å™¨äº‹ä»¶ç›‘å¬
        document.getElementById('applyFilters').addEventListener('click', () => {
            if (currentDate) {
                selectDate(currentDate);
            }
        });

        document.getElementById('resetFilters').addEventListener('click', () => {
            // é‡ç½®ä¸ºé»˜è®¤ç­›é€‰æ¡ä»¶
            initializeFilters();
            if (currentDate) {
                selectDate(currentDate);
            }
        });

        // è¾“å…¥æ¡†å›è½¦è§¦å‘ç­›é€‰
        document.querySelectorAll('.filter-controls input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && currentDate) {
                    selectDate(currentDate);
                }
            });
        });

        // åˆå§‹åŒ–
        initializeFilters();
        loadDates();
    </script>
</body>
</html>
