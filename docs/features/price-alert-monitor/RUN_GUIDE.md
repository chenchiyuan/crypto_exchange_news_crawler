# ä»·æ ¼ç›‘æ§ç³»ç»Ÿè¿è¡ŒæŒ‡å—

## ğŸ¯ ç³»ç»Ÿæ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä»·æ ¼ç›‘æ§ç³»ç»Ÿ                             â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  æ•°æ®æ›´æ–°ä»»åŠ¡    â”‚ â”€â”€â”€â–¶ â”‚  Kçº¿æ•°æ®ç¼“å­˜      â”‚             â”‚
â”‚  â”‚  (æ¯5åˆ†é’Ÿ)       â”‚      â”‚  (1m/15m/4h)     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                    â”‚                         â”‚
â”‚                                    â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  ä»·æ ¼æ£€æµ‹ä»»åŠ¡    â”‚ â”€â”€â”€â–¶ â”‚  è§„åˆ™å¼•æ“        â”‚             â”‚
â”‚  â”‚  (æ¯5åˆ†é’Ÿ)       â”‚      â”‚  (5ç§è§„åˆ™)       â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                    â”‚                         â”‚
â”‚                                    â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  è‡ªåŠ¨åŒæ­¥ä»»åŠ¡    â”‚      â”‚  æ¨é€é€šçŸ¥        â”‚             â”‚
â”‚  â”‚  (æ¯å¤©10:30)     â”‚      â”‚  (æ±‡æˆæ¥å£)      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚              Web Dashboard + REST API            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å®Œæ•´éƒ¨ç½²æµç¨‹

### Step 1: æ•°æ®åº“åˆå§‹åŒ–

```bash
# 1. æ‰§è¡Œè¿ç§»
python manage.py migrate grid_trading

# 2. åˆå§‹åŒ–è§„åˆ™å’Œé…ç½®
python manage.py shell <<'EOF'
from grid_trading.django_models import PriceAlertRule, SystemConfig

# åˆ›å»º5æ¡è§„åˆ™
rules = [
    {'rule_id': 1, 'name': '7å¤©ä»·æ ¼æ–°é«˜(4h)', 'description': '...', 'enabled': True, 'parameters': {}},
    {'rule_id': 2, 'name': '7å¤©ä»·æ ¼æ–°ä½(4h)', 'description': '...', 'enabled': True, 'parameters': {}},
    {'rule_id': 3, 'name': 'ä»·æ ¼è§¦åŠMA20', 'description': '...', 'enabled': True, 'parameters': {'ma_threshold': 0.5}},
    {'rule_id': 4, 'name': 'ä»·æ ¼è§¦åŠMA99', 'description': '...', 'enabled': True, 'parameters': {'ma_threshold': 0.5}},
    {'rule_id': 5, 'name': 'ä»·æ ¼è¾¾åˆ°åˆ†å¸ƒåŒºé—´90%æå€¼', 'description': '...', 'enabled': True, 'parameters': {'percentile': 90}},
]

for rule in rules:
    PriceAlertRule.objects.get_or_create(rule_id=rule['rule_id'], defaults=rule)

print("âœ“ åˆå§‹åŒ–å®Œæˆ")
EOF
```

### Step 2: æ‰‹åŠ¨æµ‹è¯•

#### æµ‹è¯•1: æ•°æ®æ›´æ–°

```bash
# æ‰§è¡Œä¸€æ¬¡æ•°æ®æ›´æ–°
python manage.py update_price_monitor_data --skip-lock

# é¢„æœŸè¾“å‡º:
# [2025-12-08 10:30:00] å¼€å§‹æ•°æ®æ›´æ–°...
# è·å–åˆ° 0 ä¸ªå¯ç”¨çš„ç›‘æ§åˆçº¦
# âš ï¸ æ²¡æœ‰å¯ç”¨çš„ç›‘æ§åˆçº¦ï¼Œé€€å‡ºæ‰§è¡Œ
```

#### æµ‹è¯•2: æ·»åŠ ç›‘æ§åˆçº¦

```bash
# ä½¿ç”¨REST APIæ·»åŠ åˆçº¦
curl -X POST http://localhost:8000/grid_trading/price-monitor/api/contracts/ \
  -H "Content-Type: application/json" \
  -d '{
    "symbols": ["BTCUSDT", "ETHUSDT"],
    "source": "manual"
  }'

# é¢„æœŸå“åº”:
# {
#   "added": ["BTCUSDT", "ETHUSDT"],
#   "skipped": [],
#   "message": "æˆåŠŸæ·»åŠ 2ä¸ªåˆçº¦ï¼Œè·³è¿‡0ä¸ªå·²å­˜åœ¨çš„åˆçº¦"
# }
```

#### æµ‹è¯•3: å†æ¬¡æ•°æ®æ›´æ–°

```bash
# æ‰§è¡Œæ•°æ®æ›´æ–°
python manage.py update_price_monitor_data --skip-lock

# é¢„æœŸè¾“å‡º:
# [2025-12-08 10:31:00] å¼€å§‹æ•°æ®æ›´æ–°...
# è·å–åˆ° 2 ä¸ªå¯ç”¨çš„ç›‘æ§åˆçº¦
#
# [1/2] æ›´æ–° BTCUSDT...
#   âœ“ 1m  :  150 æ¡ (0.15s)
#   âœ“ 15m :   96 æ¡ (0.12s)
#   âœ“ 4h  :   42 æ¡ (0.10s)
#
# [2/2] æ›´æ–° ETHUSDT...
#   âœ“ 1m  :  150 æ¡ (0.14s)
#   âœ“ 15m :   96 æ¡ (0.11s)
#   âœ“ 4h  :   42 æ¡ (0.09s)
#
# âœ“ æ•°æ®æ›´æ–°å®Œæˆï¼Œè€—æ—¶ 1.2 ç§’
# ç»Ÿè®¡: æ›´æ–° 2 ä¸ªåˆçº¦ï¼Œè·å– 576 æ¡Kçº¿
```

#### æµ‹è¯•4: ä»·æ ¼æ£€æµ‹

```bash
# æ‰§è¡Œä»·æ ¼æ£€æµ‹
python manage.py check_price_alerts --skip-lock

# é¢„æœŸè¾“å‡º:
# [2025-12-08 10:32:00] å¼€å§‹ä»·æ ¼è§¦å‘æ£€æµ‹...
# è·å–åˆ° 2 ä¸ªå¯ç”¨çš„ç›‘æ§åˆçº¦
# å¯ç”¨è§„åˆ™æ•°é‡: 5
#
# [1/2] æ£€æµ‹ BTCUSDT...
#   å½“å‰ä»·æ ¼: $43,250.50
#   Kçº¿æ•°æ®: 42 æ ¹(4h)
#   âœ“ æœªè§¦å‘ä»»ä½•è§„åˆ™
#
# [2/2] æ£€æµ‹ ETHUSDT...
#   å½“å‰ä»·æ ¼: $2,280.75
#   Kçº¿æ•°æ®: 42 æ ¹(4h)
#   ğŸ”” è§¦å‘ 1 ä¸ªè§„åˆ™:
#     - è§„åˆ™3: ä»·æ ¼è§¦åŠMA20 [âœ“ å·²æ¨é€]
#
# âœ“ ä»·æ ¼æ£€æµ‹å®Œæˆï¼Œè€—æ—¶ 2.5 ç§’
# ç»Ÿè®¡: æ£€æµ‹ 2 ä¸ªåˆçº¦ï¼Œè§¦å‘ 1 æ¬¡è§„åˆ™ï¼Œæ¨é€ 1 æ¡å‘Šè­¦
```

#### æµ‹è¯•5: æŸ¥çœ‹è§¦å‘æ—¥å¿—

```bash
# æŸ¥è¯¢è§¦å‘æ—¥å¿—
curl "http://localhost:8000/grid_trading/price-monitor/api/logs/?limit=5"

# é¢„æœŸå“åº”:
# {
#   "count": 1,
#   "results": [
#     {
#       "id": 1,
#       "symbol": "ETHUSDT",
#       "rule_id": 3,
#       "rule_name": "ä»·æ ¼è§¦åŠMA20",
#       "current_price": "2280.75",
#       "current_price_display": "$2,280.75",
#       "pushed": true,
#       "pushed_at": "2025-12-08T10:32:15Z",
#       "skip_reason": "",
#       "extra_info": {
#         "ma20": 2285.20,
#         "threshold_pct": 0.5,
#         "distance_pct": 0.19
#       },
#       "triggered_at": "2025-12-08T10:32:15Z"
#     }
#   ]
# }
```

### Step 3: é…ç½®å®šæ—¶ä»»åŠ¡(Cron)

åˆ›å»º cron è„šæœ¬ `/etc/cron.d/price_monitor`:

```bash
# ä»·æ ¼ç›‘æ§ç³»ç»Ÿå®šæ—¶ä»»åŠ¡

# æ•°æ®æ›´æ–°ä»»åŠ¡: æ¯5åˆ†é’Ÿæ‰§è¡Œ
*/5 * * * * www-data cd /path/to/project && /path/to/venv/bin/python manage.py update_price_monitor_data >> /var/log/price_monitor/data_update.log 2>&1

# ä»·æ ¼æ£€æµ‹ä»»åŠ¡: æ¯5åˆ†é’Ÿæ‰§è¡Œ(é”™å¼€2åˆ†é’Ÿ)
2,7,12,17,22,27,32,37,42,47,52,57 * * * * www-data cd /path/to/project && /path/to/venv/bin/python manage.py check_price_alerts >> /var/log/price_monitor/check_alerts.log 2>&1

# è‡ªåŠ¨åŒæ­¥ä»»åŠ¡: æ¯å¤©10:30æ‰§è¡Œ
30 10 * * * www-data cd /path/to/project && /path/to/venv/bin/python manage.py sync_monitored_contracts >> /var/log/price_monitor/sync_contracts.log 2>&1
```

### Step 4: å¯åŠ¨WebæœåŠ¡

```bash
# å¼€å‘ç¯å¢ƒ
python manage.py runserver 0.0.0.0:8000

# ç”Ÿäº§ç¯å¢ƒ(ä½¿ç”¨gunicorn)
gunicorn listing_monitor_project.wsgi:application \
  --bind 0.0.0.0:8000 \
  --workers 4 \
  --timeout 60 \
  --access-logfile /var/log/price_monitor/gunicorn_access.log \
  --error-logfile /var/log/price_monitor/gunicorn_error.log
```

### Step 5: è®¿é—®Dashboard

æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:8000/grid_trading/price-monitor/

## ğŸ”§ ç³»ç»Ÿé…ç½®

### å¿…éœ€é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `huicheng_push_token` | æ±‡æˆæ¨é€Token | `6020867bc6334c609d4f348c22f90f14` |
| `huicheng_push_channel` | æ¨é€æ¸ é“åç§° | `price_monitor` |

### å¯é€‰é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ | æ¨èå€¼ |
|--------|------|--------|--------|
| `duplicate_suppress_minutes` | é˜²é‡å¤é—´éš”(åˆ†é’Ÿ) | 60 | 60-120 |
| `data_update_interval_minutes` | æ•°æ®æ›´æ–°é—´éš”(åˆ†é’Ÿ) | 5 | 5 |
| `sync_schedule_time` | åŒæ­¥æ—¶é—´(HH:MM) | 10:30 | ä»»æ„ |
| `max_monitored_contracts` | æœ€å¤§åˆçº¦æ•° | 500 | 500-1000 |

ä¿®æ”¹é…ç½®:

```bash
# æ–¹å¼1: Django Admin
# è®¿é—® http://localhost:8000/admin/grid_trading/systemconfig/

# æ–¹å¼2: REST API
curl -X PATCH http://localhost:8000/grid_trading/price-monitor/api/configs/duplicate_suppress_minutes/ \
  -H "Content-Type: application/json" \
  -d '{"value": "120"}'

# æ–¹å¼3: Django Shell
python manage.py shell -c "
from grid_trading.django_models import SystemConfig
SystemConfig.objects.filter(key='duplicate_suppress_minutes').update(value='120')
"
```

## ğŸ“Š ç›‘æ§è¿ç»´

### 1. æ—¥å¸¸ç›‘æ§æŒ‡æ ‡

#### æŸ¥çœ‹æ‰§è¡Œç»Ÿè®¡

```bash
# æ•°æ®æ›´æ–°æˆåŠŸç‡
python manage.py shell -c "
from grid_trading.django_models import DataUpdateLog
from datetime import timedelta
from django.utils import timezone

recent = DataUpdateLog.objects.filter(
    started_at__gte=timezone.now() - timedelta(days=1)
)
total = recent.count()
success = recent.filter(status='success').count()
failed = recent.filter(status='failed').count()

print(f'æ•°æ®æ›´æ–°ç»Ÿè®¡(24h):')
print(f'  æ€»æ¬¡æ•°: {total}')
print(f'  æˆåŠŸ: {success} ({success/total*100:.1f}%)')
print(f'  å¤±è´¥: {failed} ({failed/total*100:.1f}%)')
"
```

#### æŸ¥çœ‹æ¨é€ç»Ÿè®¡

```bash
# ä»Šæ—¥è§¦å‘å’Œæ¨é€ç»Ÿè®¡
python manage.py shell -c "
from grid_trading.django_models import AlertTriggerLog
from django.utils import timezone

today_start = timezone.now().replace(hour=0, minute=0, second=0)
logs = AlertTriggerLog.objects.filter(triggered_at__gte=today_start)

total_triggers = logs.count()
total_pushes = logs.filter(pushed=True).count()
push_rate = (total_pushes / total_triggers * 100) if total_triggers > 0 else 0

print(f'è§¦å‘ç»Ÿè®¡(ä»Šæ—¥):')
print(f'  è§¦å‘æ¬¡æ•°: {total_triggers}')
print(f'  æ¨é€æ¬¡æ•°: {total_pushes}')
print(f'  æ¨é€ç‡: {push_rate:.1f}%')
"
```

### 2. æ•…éšœæ’æŸ¥

#### é—®é¢˜1: æ•°æ®æ›´æ–°å¤±è´¥

**ç—‡çŠ¶**: DataUpdateLogæ˜¾ç¤ºstatus=failed

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
python manage.py shell -c "
from grid_trading.django_models import DataUpdateLog
log = DataUpdateLog.objects.filter(status='failed').order_by('-started_at').first()
if log:
    print(f'é”™è¯¯æ—¶é—´: {log.started_at}')
    print(f'é”™è¯¯ä¿¡æ¯: {log.error_message}')
"

# 2. æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I https://fapi.binance.com/fapi/v1/time

# 3. æ£€æŸ¥APIé™æµ
# æŸ¥çœ‹æœ€è¿‘è¯·æ±‚é¢‘ç‡æ˜¯å¦è¿‡é«˜

# 4. æ‰‹åŠ¨é‡è¯•
python manage.py update_price_monitor_data --skip-lock
```

**å¸¸è§åŸå› **:
- Binance APIé™æµ(è¶…è¿‡1200è¯·æ±‚/åˆ†é’Ÿ)
- ç½‘ç»œè¶…æ—¶
- æ•°æ®åº“è¿æ¥å¤±è´¥
- Kçº¿æ•°æ®æ ¼å¼å¼‚å¸¸

#### é—®é¢˜2: ä»·æ ¼æ£€æµ‹æœªæ‰§è¡Œ

**ç—‡çŠ¶**: é•¿æ—¶é—´æ— è§¦å‘æ—¥å¿—

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„åˆçº¦
python manage.py shell -c "
from grid_trading.django_models import MonitoredContract
count = MonitoredContract.objects.filter(status='enabled').count()
print(f'å¯ç”¨çš„ç›‘æ§åˆçº¦: {count}')
"

# 2. æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„è§„åˆ™
python manage.py shell -c "
from grid_trading.django_models import PriceAlertRule
count = PriceAlertRule.objects.filter(enabled=True).count()
print(f'å¯ç”¨çš„è§„åˆ™: {count}')
"

# 3. æ£€æŸ¥è„šæœ¬é”çŠ¶æ€
python manage.py shell -c "
from grid_trading.services.script_lock import check_lock_status
status = check_lock_status('price_alert_check')
if status['is_locked']:
    print(f'âš ï¸ è„šæœ¬è¢«é”å®šï¼Œå‰©ä½™ {status[\"remaining_minutes\"]:.1f} åˆ†é’Ÿ')
else:
    print('âœ“ è„šæœ¬æœªé”å®š')
"

# 4. æ‰‹åŠ¨æ‰§è¡Œæ£€æµ‹
python manage.py check_price_alerts --skip-lock
```

#### é—®é¢˜3: æ¨é€å¤±è´¥

**ç—‡çŠ¶**: AlertTriggerLogæ˜¾ç¤ºpushed=False, skip_reason='æ¨é€å¤±è´¥'

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æµ‹è¯•æ¨é€æœåŠ¡è¿æ¥
python manage.py shell -c "
from grid_trading.services.alert_notifier import PriceAlertNotifier
notifier = PriceAlertNotifier()
if notifier.test_connection():
    print('âœ“ æ¨é€æœåŠ¡è¿æ¥æ­£å¸¸')
else:
    print('âœ— æ¨é€æœåŠ¡è¿æ¥å¤±è´¥')
"

# 2. æ£€æŸ¥æ¨é€é…ç½®
python manage.py shell -c "
from grid_trading.django_models import SystemConfig
token = SystemConfig.get_value('huicheng_push_token')
channel = SystemConfig.get_value('huicheng_push_channel')
print(f'Token: {token[:20]}...')
print(f'Channel: {channel}')
"

# 3. é‡è¯•å¤±è´¥çš„æ¨é€
python manage.py check_price_alerts --retry-failed --skip-lock
```

### 3. æ€§èƒ½ä¼˜åŒ–

#### ä¼˜åŒ–1: Kçº¿ç¼“å­˜é¢„çƒ­

```bash
# é¢„çƒ­ç¼“å­˜(æ‰¹é‡è·å–Kçº¿æ•°æ®)
python manage.py shell -c "
from grid_trading.django_models import MonitoredContract
from grid_trading.services.kline_cache import KlineCache
from grid_trading.services.binance_futures_client import BinanceFuturesClient

client = BinanceFuturesClient()
cache = KlineCache(api_client=client)

contracts = MonitoredContract.objects.filter(status='enabled')
print(f'å¼€å§‹é¢„çƒ­ {contracts.count()} ä¸ªåˆçº¦çš„Kçº¿ç¼“å­˜...')

for idx, contract in enumerate(contracts, 1):
    try:
        cache.get_klines(contract.symbol, '4h', 42, use_cache=True)
        if idx % 10 == 0:
            print(f'è¿›åº¦: {idx}/{contracts.count()}')
    except Exception as e:
        print(f'âœ— {contract.symbol}: {e}')

print('âœ“ ç¼“å­˜é¢„çƒ­å®Œæˆ')
"
```

#### ä¼˜åŒ–2: æ•°æ®åº“ç´¢å¼•

æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨:

```bash
python manage.py dbshell <<'SQL'
-- æ£€æŸ¥AlertTriggerLogç´¢å¼•
SELECT name FROM sqlite_master
WHERE type='index'
  AND tbl_name='grid_trading_alerttriggerlog';

-- é¢„æœŸç»“æœåº”åŒ…å«:
-- idx_alert_trigger_dedup (symbol, rule_id, pushed, pushed_at)
-- idx_alert_trigger_time (triggered_at)
SQL
```

#### ä¼˜åŒ–3: æ—¥å¿—æ¸…ç†

å®šæœŸæ¸…ç†å†å²æ—¥å¿—:

```bash
# æ¸…ç†30å¤©å‰çš„è§¦å‘æ—¥å¿—
python manage.py shell -c "
from grid_trading.django_models import AlertTriggerLog, DataUpdateLog
from datetime import timedelta
from django.utils import timezone

threshold = timezone.now() - timedelta(days=30)

# æ¸…ç†è§¦å‘æ—¥å¿—
deleted_triggers = AlertTriggerLog.objects.filter(
    triggered_at__lt=threshold
).delete()[0]

# æ¸…ç†æ•°æ®æ›´æ–°æ—¥å¿—
deleted_updates = DataUpdateLog.objects.filter(
    started_at__lt=threshold
).delete()[0]

print(f'âœ“ æ¸…ç† {deleted_triggers} æ¡è§¦å‘æ—¥å¿—')
print(f'âœ“ æ¸…ç† {deleted_updates} æ¡æ›´æ–°æ—¥å¿—')
"

# é…ç½®cronä»»åŠ¡(æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹æ‰§è¡Œ)
# 0 3 * * 0 www-data cd /path/to/project && /path/to/venv/bin/python manage.py shell -c "..."
```

## ğŸ” å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è°ƒæ•´è§„åˆ™å‚æ•°?

A: è§„åˆ™3ã€4(MAè§¦åŠ)å’Œè§„åˆ™5(ä»·æ ¼åˆ†å¸ƒ)æ”¯æŒå‚æ•°è°ƒæ•´:

```bash
# ä¿®æ”¹MA20è§¦åŠé˜ˆå€¼ä¸º1%(é»˜è®¤0.5%)
curl -X PATCH http://localhost:8000/grid_trading/price-monitor/api/rules/3/ \
  -H "Content-Type: application/json" \
  -d '{"parameters": {"ma_threshold": 1.0}}'

# ä¿®æ”¹ä»·æ ¼åˆ†å¸ƒåˆ†ä½æ•°ä¸º95%(é»˜è®¤90%)
curl -X PATCH http://localhost:8000/grid_trading/price-monitor/api/rules/5/ \
  -H "Content-Type: application/json" \
  -d '{"parameters": {"percentile": 95}}'
```

### Q2: å¦‚ä½•ä¸´æ—¶ç¦ç”¨æŸä¸ªè§„åˆ™?

A: ä½¿ç”¨APIæˆ–Django Admin:

```bash
# ç¦ç”¨è§„åˆ™4(MA99)
curl -X POST http://localhost:8000/grid_trading/price-monitor/api/rules/bulk_disable/ \
  -H "Content-Type: application/json" \
  -d '{"rule_ids": [4]}'

# é‡æ–°å¯ç”¨
curl -X POST http://localhost:8000/grid_trading/price-monitor/api/rules/bulk_enable/ \
  -H "Content-Type: application/json" \
  -d '{"rule_ids": [4]}'
```

### Q3: å¦‚ä½•ä¸´æ—¶æš‚åœæŸä¸ªåˆçº¦çš„ç›‘æ§?

A: å°†åˆçº¦çŠ¶æ€æ”¹ä¸ºdisabled:

```bash
curl -X POST http://localhost:8000/grid_trading/price-monitor/api/contracts/bulk_update/ \
  -H "Content-Type: application/json" \
  -d '{
    "symbols": ["BTCUSDT"],
    "status": "disabled"
  }'
```

### Q4: è‡ªåŠ¨åŒæ­¥ä¼šå½±å“æ‰‹åŠ¨æ·»åŠ çš„åˆçº¦å—?

A: ä¸ä¼šã€‚è‡ªåŠ¨åŒæ­¥åªå½±å“`source=auto`çš„åˆçº¦ï¼Œä¸ä¼šä¿®æ”¹æˆ–åˆ é™¤`source=manual`çš„åˆçº¦ã€‚

### Q5: å¦‚ä½•ä¿®æ”¹é˜²é‡å¤æ¨é€é—´éš”?

A: ä¿®æ”¹`duplicate_suppress_minutes`é…ç½®(é»˜è®¤60åˆ†é’Ÿ):

```bash
curl -X PATCH http://localhost:8000/grid_trading/price-monitor/api/configs/duplicate_suppress_minutes/ \
  -H "Content-Type: application/json" \
  -d '{"value": "120"}'
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¯åŠ¨æŒ‡å—](quickstart.md) - åŸºç¡€ä½¿ç”¨è¯´æ˜
- [APIæ¥å£æ–‡æ¡£](contracts/api.yaml) - REST APIå®Œæ•´æ–‡æ¡£
- [æ•°æ®æ¨¡å‹æ–‡æ¡£](data-model.md) - æ•°æ®åº“è¡¨ç»“æ„
- [ç³»ç»Ÿæ¶æ„æ–‡æ¡£](plan.md) - æŠ€æœ¯æ¶æ„è®¾è®¡
