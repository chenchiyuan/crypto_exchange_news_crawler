# 功能点清单: DDPS-Z做空策略扩展

**迭代编号**: 015
**创建日期**: 2026-01-06
**状态**: Draft

---

## MVP功能点（P0）

### 模块1：信号计算器扩展

| FP-ID | 功能点 | 优先级 | 验收标准 |
|-------|--------|--------|----------|
| FP-015-001 | 策略3信号计算（EMA斜率做空） | P0 | high>=P95 且 future_ema<close 时触发 |
| FP-015-002 | 策略4信号计算（惯性上涨做空） | P0 | β>0 且 mid>P95 且 high>(mid+P95)/2 时触发 |
| FP-015-003 | P95价格序列计算 | P0 | P95 = EMA × (1 + 1.645 × ewma_std) |
| FP-015-004 | 平空信号生成 | P0 | K线包含EMA25时生成平空信号 |

### 模块2：订单模型扩展

| FP-ID | 功能点 | 优先级 | 验��标准 |
|-------|--------|--------|----------|
| FP-015-005 | Order.direction字段 | P0 | 支持'long'/'short'，默认'long' |
| FP-015-006 | 做空盈亏计算 | P0 | 盈亏 = (open_price - close_price) × quantity |
| FP-015-007 | BacktestOrder.direction字段 | P0 | 数据库模型同步扩展 |

### 模块3：策略适配层

| FP-ID | 功能点 | 优先级 | 验收标准 |
|-------|--------|--------|----------|
| FP-015-008 | DDPSZStrategy做空信号生成 | P0 | generate_short_signals()方法实现 |
| FP-015-009 | DDPSZStrategy平空信号生成 | P0 | generate_cover_signals()方法实现 |
| FP-015-010 | 策略选择器 | P0 | 根据--strategies参数选择启用的策略 |

### 模块4：资金管理

| FP-ID | 功能点 | 优先级 | 验收标准 |
|-------|--------|--------|----------|
| FP-015-011 | 全局资金池管理 | P0 | 多空策略共用initial_cash |
| FP-015-012 | 做空开仓资金扣减 | P0 | 开空时扣减available_capital |
| FP-015-013 | 平空资金回流 | P0 | 平空时归还本金+盈亏 |

### 模块5：CLI扩展

| FP-ID | 功能点 | 优先级 | 验收标准 |
|-------|--------|--------|----------|
| FP-015-014 | --strategies参数 | P0 | 支持"1,2,3,4"格式指定策略组合 |
| FP-015-015 | 策略参数验证 | P0 | 无效策略ID报错 |
| FP-015-016 | 默认值向后兼容 | P0 | 默认"1,2"保持现有行为 |

### 模块6：回测报告

| FP-ID | 功能点 | 优先级 | 验收标准 |
|-------|--------|--------|----------|
| FP-015-017 | 多空订单分类统计 | P0 | 报告显示做多/做空订单数 |
| FP-015-018 | Web详情页direction显示 | P0 | 订单列表显示方向标签 |

---

## 延期功能（P1）

| FP-ID | 功能点 | 说明 |
|-------|--------|------|
| FP-015-P1-001 | 做空止损/止盈 | 基于价格波动自动平仓 |
| FP-015-P1-002 | 多空对冲管理 | 同时持有多空仓位时的净值计算 |
| FP-015-P1-003 | 策略权重配置 | 不同策略分配不同仓位比例 |
| FP-015-P1-004 | 保证金率配置 | 做空保证金要求配置 |

---

## 功能点依赖关系

```
FP-015-003 (P95计算)
    ↓
FP-015-001 (策略3) ─┬─→ FP-015-008 (做空信号)
FP-015-002 (策略4) ─┘         ↓
                        FP-015-005 (direction字段)
                              ↓
FP-015-004 (平空信号) ────→ FP-015-009 (平空方法)
                              ↓
                   ┌──────────┴──────────┐
                   ↓                      ↓
            FP-015-011~013          FP-015-006
            (资金管理)              (盈亏计算)
                   ↓                      ↓
            FP-015-014~016          FP-015-007
            (CLI参数)              (DB模型)
                   ↓                      ↓
                   └──────────┬──────────┘
                              ↓
                   FP-015-017~018 (报告显示)
```

---

## 测试覆盖要求

| 模块 | 测试类型 | 覆盖率要求 |
|------|----------|-----------|
| 信号计算器 | 单元测试 | 100% |
| 盈亏计算 | 单元测试 | 100% |
| 资金管理 | 单元测试 | 100% |
| CLI参数 | 集成测试 | 100% |
| 端到端回测 | E2E测试 | 核心路径覆盖 |
