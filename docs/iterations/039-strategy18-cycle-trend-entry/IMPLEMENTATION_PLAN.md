# 实现计划 - 策略18：周期趋势入场策略

## 文档信息
- **迭代编号**: 039
- **创建日期**: 2026-01-13
- **状态**: ✅ 已完成

---

## 阶段 1: 创建策略18核心框架

**目标**: 创建策略18类骨架，包含基础结构和指标计算

**验收标准**:
- [x] 创建 `strategy18_cycle_trend_entry.py` 文件
- [x] 实现 IStrategy 接口
- [x] 实现 `_calculate_indicators()` 方法（复用策略16逻辑）
- [x] 实现策略参数初始化

**测试**: 能成功导入策略类，参数初始化正确

**状态**: ✅ 已完成

---

## 阶段 2: 实现周期状态判断

**目标**: 实现FP-039-001、FP-039-002、FP-039-003

**验收标准**:
- [x] 实现 `_calculate_cycle_distribution()` - 42周期占比计算
- [x] 实现 `_calculate_ema_slopes()` - EMA25斜率计算
- [x] 实现 `_is_slope_highest()` / `_is_slope_lowest()` - 斜率比较
- [x] 实现 `_determine_cycle_state()` - 周期状态标记

**测试**: 周期状态判断逻辑正确

**状态**: ✅ 已完成

---

## 阶段 3: 实现双挂单买入机制

**目标**: 实现FP-039-004、FP-039-005

**验收标准**:
- [x] 实现 `_create_pending_orders()` - 创建EMA7/EMA25双挂单
- [x] 实现 `_process_pending_orders()` - 检查挂单成交
- [x] 实现 `_cancel_pending_orders()` - 取消未成交挂单
- [x] 资金冻结/释放逻辑正确

**测试**: 双挂单创建、成交、取消逻辑正确

**状态**: ✅ 已完成

---

## 阶段 4: 实现卖出策略

**目标**: 实现FP-039-006、FP-039-007、FP-039-008

**验收标准**:
- [x] 实现 `_check_stop_loss()` - 3%止损
- [x] 实现 `_check_take_profit()` - 10%止盈
- [x] 实现 `_check_cycle_exit()` - 周期状态止盈
- [x] 实现 `_process_pending_exits()` - 处理待卖出订单
- [x] 卖出优先级正确：止损 > 止盈 > 周期状态止盈

**测试**: 各止盈止损条件判断正确，优先级正确

**状态**: ✅ 已完成

---

## 阶段 5: 回测主循环与验证

**目标**: 实现回测主循环，验证策略正确性

**验收标准**:
- [x] 实现 `run_backtest()` 主循环
- [x] 实现 `_generate_result()` 结果生成
- [x] 创建策略配置文件 `strategy18_cycle_trend.json`
- [x] 在 `__init__.py` 中导出策略类
- [x] 运行回测验证基本功能

**测试**: 回测能正常执行，结果格式正确

**状态**: ✅ 已完成

---

## 回测验证结果

**测试数据**: BTCUSDT 4h K线，2025-01-01 ~ 2025-06-30，共1081根

**结果**:
| 指标 | 数值 |
|------|------|
| 总交易数 | 56 |
| 盈利交易 | 20 |
| 亏损交易 | 36 |
| 胜率 | 35.71% |
| 总盈亏 | +607.97 USDT |
| 收益率 | +6.08% |
| 未平仓持仓 | 0 |

**功能验证**:
- ✅ 双挂单机制（EMA7 + EMA25）正常工作
- ✅ 止损（3%）正确触发
- ✅ 止盈（10%）正确触发
- ✅ 周期状态止盈（非上涨周期+EMA7下穿EMA25→下根K线open卖出）正常工作
