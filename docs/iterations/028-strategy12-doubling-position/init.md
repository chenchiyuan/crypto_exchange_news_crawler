# P0: 快速初始化 - 策略12-倍增仓位限价挂单

## 文档信息

| 属性 | 值 |
|------|-----|
| 迭代编号 | 028 |
| 迭代名称 | strategy12-doubling-position |
| 状态 | In Progress |
| 创建日期 | 2026-01-11 |
| 预估工作量 | 1-2天 |

---

## 1. 需求背景

用户希望在策略11（限价挂单策略）的基础上新建策略12，核心变化：
1. **倍增仓位**：每笔挂单金额为上一笔的2倍（可配置），形成马丁格尔式建仓
2. **挂单数量**：默认5笔（策略11是10笔）
3. **卖出条件**：固定2%止盈（策略11是min(5%止盈, EMA25)）

**用户原始需求**：
```
买入条件：
  - mid < P5: 首笔 = (P5 + mid) / 2 × (1 - discount)
  - mid >= P5: 首笔 = P5 × (1 - discount)
  - 第N笔挂单价格 = 首笔 × (1 - (N-1) × interval)

每笔间隔订单为上笔挂单金额的2倍（可配置），举例：
  首单挂100U，第二弹200U，第三弹400U。总共5单（可配置）

卖出条件：2%止盈（可配置）
```

---

## 2. 可行性评估

### 2.1 架构兼容性

| 检查项 | 评估 | 说明 |
|--------|------|------|
| 代码复用 | ✅ 高度复用 | 复用策略11的LimitOrderManager、LimitOrderPriceCalculator等核心组件 |
| 新增模块 | ✅ 最小化 | 仅需新增DoublingPositionStrategy类和TakeProfitExit |
| 接口变更 | ✅ 无破坏性 | 通过新策略ID(12)路由，不影响现有策略 |
| 数据模型 | ✅ 无变更 | 复用PendingOrder、Order等现有模型 |

### 2.2 工作量估算

| 任务 | 预估时间 |
|------|----------|
| DoublingPositionStrategy类 | 2-3小时 |
| 倍增仓位计算逻辑 | 1-2小时 |
| TakeProfitExit（固定比例止盈） | 1-2小时 |
| 配置解析扩展 | 0.5小时 |
| 测试用例 | 1-2小时 |
| **总计** | **6-10小时（约1-2天）** |

### 2.3 可行性结论

✅ **适合快速流程**
- 工作量 ≤ 3天
- 基于现有策略11架构的增量开发
- 无架构变更，复用现有组件

---

## 3. 约束条件

### 3.1 技术约束

1. **复用策略11组件**：必须复用LimitOrderManager、LimitOrderPriceCalculator
2. **独立策略类**：遵循策略11的设计模式，创建独立的策略类
3. **配置驱动**：所有参数通过JSON配置文件指定

### 3.2 业务约束

1. **倍增系数可配置**：默认2倍，支持自定义
2. **挂单数量可配置**：默认5笔
3. **止盈比例可配置**：默认2%
4. **首单金额可配置**：默认100 USDT

---

## 4. 关键决策（待确认）

| 决策点 | 候选方案 | 初步建议 |
|--------|----------|----------|
| 策略实现方式 | A) 继承LimitOrderStrategy<br>B) 独立新策略类 | B) 独立策略类，清晰解耦 |
| 止盈方式 | A) 固定2%<br>B) 可选EMA25回归 | A) 固定2%，符合用户需求 |
| 总金额限制 | A) 不限制<br>B) 配置最大总金额 | A) 不限制，由资金决定 |

---

## 5. Q-Gate 0 检查清单

- [x] 需求背景已理解
- [x] 约束条件已明确
- [x] 可行性已评估（工作量≤3天）
- [x] 架构兼容性已初步评估
- [x] 关键风险已识别（无重大风险）

---

## 6. 下一步

✅ Q-Gate 0 通过，可进入 P1: 需求定稿制
