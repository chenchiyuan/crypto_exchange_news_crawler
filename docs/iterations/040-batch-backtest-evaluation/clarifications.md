# 需求澄清记录: 批量回测评估体系

## 文档信息
| 属性 | 值 |
|------|-----|
| 迭代编号 | 040 |
| 项目名称 | batch-backtest-evaluation |
| 创建日期 | 2026-01-13 |

## 澄清记录

### Q1: 资金静态APR计算公式
**问题**: 静态APR的具体计算方式？

**用户选择**:
```
静态APR = (账户总值 - 初始资金) / 初始资金 / 回测天数 × 365
```

**确认要点**:
- 基于账户总价值（含未实现盈亏）计算
- 线性年化，不考虑复利
- 单位：百分比（%）

---

### Q2: 资金综合年化APY计算方式
**问题**: 综合APY采用何种计算方法？

**用户选择**: 时间加权法

**确认要点**:
- 考虑每笔订单的持仓时间
- 年化收益率 = 单笔收益率 × (365 / 持仓天数)
- 最终APY = Σ(年化收益率_i × 金额_i) / Σ(金额_i)
- 持仓中订单按回测结束时间计算持仓天数，使用浮动盈亏

---

### Q3: 交易对指定方式
**问题**: 批量回测框架支持哪些交易对指定方式？

**用户选择**: 仅支持列表模式

**确认要点**:
- 支持指定单个交易对：`--symbols ETHUSDT`
- 支持指定多个交易对：`--symbols ETHUSDT,BTCUSDT,SOLUSDT`
- 支持指定全部交易对：`--symbols ALL`
- **不支持**前缀匹配（如`ETH*`）

---

## 隐式假设（已确认）

1. **数据源**: 使用现有`FuturesContract`模型获取交易对列表
2. **策略限定**: MVP阶段仅支持策略16（`Strategy16LimitEntry`）
3. **结果存储**: 仅CSV文件，不入库
4. **执行方式**: 同步串行执行，不并行
5. **回测配置**: 复用现有JSON配置文件格式

---

## 边界条件

| 场景 | 处理方式 |
|------|----------|
| 交易对无K线数据 | 跳过，记录日志，CSV标记为空 |
| 回测天数为0 | APR/APY设为0 |
| 无已平仓订单 | APY设为0（仅基于持仓） |
| 单笔订单持仓<1天 | 持仓天数最小为1天 |
| CSV文件已存在 | 覆盖写入 |
