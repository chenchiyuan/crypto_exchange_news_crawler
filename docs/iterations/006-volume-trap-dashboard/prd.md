# 产品需求文档 (PRD)

**项目名称**: Volume Trap Dashboard
**迭代编号**: 006
**文档版本**: v1.0.0
**创建日期**: 2025-12-25
**生命周期阶段**: P1 - 需求定义+澄清

---

## 第一部分：需求原始输入

### 产品背景
现有系统是一个加密货币交易监控系统，包含巨量诱多/弃盘检测系统、三阶段状态机（Discovery→Confirmation→Validation）、VolumeTrapMonitor模型（存储监控记录）和KLine数据模型（存储K线数据）。系统已实现历史扫描功能，扫描结果以JSON格式存储到data目录。

### 用户痛点
目前观察列表展示的是代币+K线，但缺乏一个直观的Dashboard来：
1. 集中展示每个阶段筛选的代币列表
2. 清晰显示代币的发现时刻
3. 便捷地查看代币的完整K线走势
4. 支持按阶段和时间范围进行筛选

### 核心目标
构建一个Dashboard，以代币列表的形式展示每个阶段筛选的代币，点击代币可展开全周期K线图，并标记发现时刻。支持按阶段（Discovery/Confirmation/Validation）和时间范围筛选。

### 用户价值
- **快速发现**：一屏查看所有异常事件代币，无需逐个查询
- **直观分析**：通过K线图直观分析异常事件发生前后的价格走势
- **高效筛选**：快速筛选特定阶段或时间范围内的异常事件
- **便捷操作**：点击即查看，操作简单直观

---

## 第二部分：功能规格框架

### 模块一：功能定义与拆解

#### 1.1 代币列表展示
- **功能描述**: 以列表形式展示所有异常事件代币，显示symbol、status、trigger_time、trigger_price四个核心字段
- **用户故事**: 作为交易员，我希望看到所有触发异常检测的代币列表，以便快速了解市场异常情况
- **功能点**:
  - F1.1: 代币列表页面展示
  - F1.2: 基础排序功能（按时间、符号、状态）
  - F1.3: 分页功能（每页20条）

#### 1.2 K线图展示
- **功能描述**: 点击代币后展示该代币的完整K线图，并在图上标记发现时刻
- **用户故事**: 作为交易员，我希望看到异常事件发生时的K线走势，以便分析价格变化规律
- **功能点**:
  - F2.1: K线图组件渲染
  - F2.2: 发现时刻标记
  - F2.3: 基础交互功能（展开/收起）

#### 1.3 筛选功能
- **功能描述**: 提供按阶段和时间范围的筛选功能，帮助用户快速定位感兴趣的异常事件
- **用户故事**: 作为交易员，我希望只查看特定阶段（如Discovery阶段）或特定时间范围内的异常事件
- **功能点**:
  - F3.1: 状态筛选器（Discovery/Confirmation/Validation）
  - F3.2: 时间范围筛选
  - F3.3: 筛选条件组合

#### 1.4 界面布局
- **功能描述**: 提供响应式、简洁美观的UI界面，适配桌面端和移动端
- **用户故事**: 作为交易员，我希望在不同设备上都能方便地使用Dashboard
- **功能点**:
  - F4.1: 响应式列表布局
  - F4.2: 基础样式设计
  - F4.3: 高级筛选器面板（价格范围、成交量）
  - F4.4: 数据导出功能（CSV/JSON）
  - F4.5: 增强图表交互（缩放、平移、十字光标）

### 模块二：交互流程与规则

#### 2.1 页面加载流程
1. 用户访问Dashboard页面
2. 系统加载VolumeTrapMonitor数据（默认显示所有状态，按时间倒序）
3. 渲染代币列表（包含symbol、status、trigger_time、trigger_price）
4. 加载分页控件（每页20条）

#### 2.2 筛选流程
1. 用户设置筛选条件（状态、时间范围）
2. 系统实时查询符合条件的代币数据
3. 更新代币列表显示
4. 保持当前分页状态（如可能）

#### 2.3 K线图查看流程
1. 用户点击代币项
2. 系统加载该代币的历史K线数据
3. 渲染K线图
4. 在图上标记trigger_time位置
5. 用户可收起/展开K线图

#### 2.4 交互规则
- **列表排序**: 默认按trigger_time倒序，支持点击列标题排序
- **筛选逻辑**: 状态筛选和时间范围筛选是AND关系，必须同时满足
- **分页规则**: 每页固定20条记录，支持跳转到指定页码
- **K线图**: 最多同时展开5个代币的K线图（避免性能问题）

### 模块三：范围边界

#### In-Scope（本期实现）
- ✅ 代币列表展示（symbol、status、trigger_time、trigger_price）
- ✅ K线图展示（使用历史数据）
- ✅ 发现时刻标记
- ✅ 状态筛选（Discovery/Confirmation/Validation）
- ✅ 时间范围筛选
- ✅ 基础排序和分页
- ✅ 响应式布局（桌面端/移动端）
- ✅ 简洁UI设计

#### Out-of-Scope（后续迭代）
- ❌ 实时数据监控（仅使用历史数据）
- ❌ 用户认证和权限管理（集成现有系统）
- ❌ 多周期K线切换（仅显示选中代币的默认周期）
- ❌ 高级技术指标（MA、MACD等）
- ❌ 异常事件预测功能
- ❌ 多语言支持
- ❌ 暗色主题切换

---

## 第三部分：AI分析与建议

### 1. 建议的MVP功能点清单

📊 **代币列表展示**
- [P0] F1.1 代币列表页面展示: 展示所有异常事件代币，包含symbol、status、trigger_time、trigger_price
- [P0] F1.2 基础排序功能: 按trigger_time、symbol、status排序，默认倒序
- [P0] F1.3 分页功能: 每页显示20个代币，支持翻页导航

📈 **K线图展示**
- [P0] F2.1 K线图组件渲染: 点击代币后展示该代币的完整K线图（使用历史数据）
- [P0] F2.2 发现时刻标记: 在K线图上标记trigger_time位置
- [P0] F2.3 基础交互功能: 代币列表点击展开/收起K线图

🔍 **筛选功能**
- [P0] F3.1 状态筛选器: 提供三个状态的单选或多选筛选
- [P0] F3.2 时间范围筛选: 支持按日期范围筛选异常事件
- [P0] F3.3 筛选条件组合: 状态和时间筛选可同时使用

🎨 **界面布局**
- [P0] F4.1 响应式列表布局: 桌面端表格，移动端卡片
- [P0] F4.2 基础样式设计: 简洁清晰的UI设计

[P1] 高级功能：
- [P1] F4.3 高级筛选器面板 - 添加价格范围、成交量等筛选条件
- [P1] F4.4 数据导出 - 支持将筛选结果导出为CSV/JSON
- [P1] F4.5 增强图表交互 - 支持缩放、平移等高级K线图操作

### 2. 待决策清单

**决策点 1：K线图数据来源**
- 逻辑阐述：需要确定K线数据是实时获取还是使用历史数据缓存
- 影响范围：影响数据加载速度、实时性和系统性能
- 建议方案：
  - 方案A：使用历史K线数据（复杂度：低，最适合MVP）
    - 优点：实现快速，无需实时数据接口
    - 缺点：数据可能不是最新的
  - 方案B：集成实时数据源（复杂度：高，功能更完善）
    - 优点：数据实时性强
    - 缺点：需要额外的API集成和复杂性
- ⭐ 推荐方案：方案A - 使用历史K线数据，因为它以最快的方式满足了MVP的核心需求，用户可以先查看历史异常事件的发生时刻和K线走势

**决策点 2：Dashboard部署方式**
- 逻辑阐述：需要确定是作为独立页面还是集成到现有系统中
- 影响范围：影响开发复杂度、用户体验和维护成本
- 建议方案：
  - 方案A：集成到现有monitor模块（复杂度：低，最适合MVP）
    - 优点：共享现有认证和权限体系，维护简单
    - 缺点：可能受现有架构限制
  - 方案B：独立Django应用（复杂度：高，功能更完善）
    - 优点：独立开发，灵活性高
    - 缺点：需要额外的部署和维护工作
- ⭐ 推荐方案：方案A - 集成到现有monitor模块，因为它以最快的方式满足了MVP的核心需求，且符合现有系统架构

**决策点 3：K线图技术选型**
- 逻辑阐述：需要选择合适的图表库来实现K线图
- 影响范围：影响开发效率、用户体验和性能
- 建议方案：
  - 方案A：使用轻量级图表库如Chart.js（复杂度：低，最适合MVP）
    - 优点：集成简单，依赖少
    - 缺点：K线图功能可能受限
  - 方案B：使用专业K线库如Lightweight Charts（复杂度：中，功能更完善）
    - 优点：专业的金融图表功能
    - 缺点：需要额外学习成本
- ⭐ 推荐方案：方案A - 使用轻量级图表库，因为它以最快的方式满足了MVP的核心需求，后续可根据需要升级到专业K线库

### 3. 现有能力分析报告

#### 现有功能清单
| 功能名称 | 模块 | 与新需求关联 | 复用可能性 | 备注 |
|---------|------|-------------|-----------|------|
| Volume Trap Detection System | volume_trap | 提供异常事件检测数据源 | 高 | 已实现完整的检测逻辑 |
| Three-Phase State Machine | volume_trap_fsm | 提供三阶段状态筛选能力 | 高 | 支持Discovery/Confirmation/Validation |
| VolumeTrapMonitor Model | volume_trap/models | 提供代币监控记录数据 | 高 | 包含symbol、interval、status、trigger_time等字段 |
| KLine Data Model | backtest/models | 提供K线图表数据源 | 高 | 包含open、high、low、close、volume等字段 |
| scan_volume_traps Command | management/commands | 提供数据扫描能力 | 中 | 可复用数据获取逻辑 |
| 历史扫描功能 | volume_trap_fsm | 提供历史异常事件数据 | 高 | 扫描结果已保存为JSON |
| API接口 | monitor/api | 提供数据查询接口 | 中 | 需要扩展以支持Dashboard需求 |

#### 复用建议
- **可直接复用**:
  - VolumeTrapMonitor Model - 作为代币列表数据源
  - KLine Data Model - 作为K线图数据源
  - Three-Phase State Machine - 提供状态筛选逻辑

- **可扩展复用**:
  - API接口 - 需要扩展以支持Dashboard的数据查询需求
  - 历史扫描功能 - 可扩展为实时数据获取

- **需全新开发**:
  - Dashboard前端界面
  - K线图表展示组件
  - 交互式筛选功能

#### 一致性建议
- **风格参考**: 遵循现有Django项目结构和API设计模式
- **交互模式**: 保持与现有管理系统一致的UI/UX风格
- **数据格式**: 使用现有的VolumeTrapMonitor和KLine数据模型

#### 集成路径建议
- **优先集成**: 在现有monitor模块中扩展Dashboard功能
- **扩展策略**: 复用现有的API接口和数据模型，避免重复开发

### 4. MVP核心价值定义

**一句话定义**: 为加密货币交易员提供一个直观的Dashboard界面，快速浏览和筛选所有巨量诱多/弃盘异常事件，并通过K线图分析价格变化规律。

**为什么是核心价值**:
1. **信息聚合**: 将分散的异常事件数据集中展示，提高信息获取效率
2. **直观分析**: 通过K线图直观展示异常事件发生前后的价格走势
3. **高效筛选**: 支持按阶段和时间快速定位感兴趣的异常事件
4. **操作简单**: 点击即查看，操作符合用户直觉

### 5. 成功标准

#### 用户验收标准
- 用户能在1分钟内找到感兴趣的异常事件代币
- 用户能在3次点击内查看任意代币的K线图
- 用户能通过筛选功能准确找到特定阶段或时间范围内的异常事件
- K线图上的发现时刻标记清晰可见
- 页面加载时间 < 2秒，筛选响应时间 < 500ms

#### 技术验收标准
- 兼容主流浏览器（Chrome、Firefox、Safari、Edge）
- 响应式布局适配桌面端和移动端
- 代码覆盖率 ≥ 80%
- API响应时间 < 500ms
- 数据库查询优化（使用索引）

---

## 最终交付确认

✅ MVP PRD内容已完全确认！

我已经为您生成了完整的MVP产品需求文档，保存在：
`docs/iterations/006-volume-trap-dashboard/prd.md`

此文档包含：
1. 完整的需求原始输入
2. 迭代完善的功能规格框架
3. 最终确认的AI分析与建议（MVP功能点清单 + 待决策清单）

您可以基于此PRD文档进入下一阶段的开发。
