# 任务清单: 策略15-分批止盈优化策略

## 文档信息
- **版本**: 1.0
- **创建日期**: 2026-01-11
- **迭代编号**: 031

---

## 任务汇总

| 任务ID | 任务名称 | 预计时间 | 依赖 | 状态 |
|--------|----------|----------|------|------|
| TASK-001 | 创建策略15基础框架 | 30min | - | ✅ 已完成 |
| TASK-002 | 实现持仓合并逻辑 | 30min | TASK-001 | ✅ 已完成 |
| TASK-003 | 实现分批止盈逻辑 | 45min | TASK-002 | ✅ 已完成 |
| TASK-004 | 实现快速止损逻辑 | 20min | TASK-001 | ✅ 已完成 |
| TASK-005 | 创建配置文件和回测验证 | 30min | TASK-003, TASK-004 | ✅ 已完成 |

---

## 任务详情

### TASK-001: 创建策略15基础框架

**目标**: 基于策略14创建策略15的基础代码结构

**具体步骤**:
1. 复制`optimized_entry_strategy.py`为`split_take_profit_strategy.py`
2. 修改类名为`SplitTakeProfitStrategy`
3. 更新STRATEGY_ID、STRATEGY_NAME
4. 添加新参数：`stop_loss_rate=0.03`, `tp_levels=5`, `first_tp_rate=0.02`, `tp_interval=0.01`
5. 扩展持仓数据结构

**验收标准**:
- [ ] 类可正常实例化
- [ ] 新参数可正确传入

---

### TASK-002: 实现持仓合并逻辑

**目标**: 实现同价持仓合并功能

**具体步骤**:
1. 实现`_merge_holdings()`方法
2. 按价格分组持仓
3. 合并同价持仓：数量相加，重新生成order_id
4. 合并后重新计算止盈档位数量
5. 在process_kline Step 2位置调用

**验收标准**:
- [ ] 同价持仓正确合并
- [ ] 合并后数量=原数量之和
- [ ] 止盈档位数量正确计算

---

### TASK-003: 实现分批止盈逻辑

**目标**: 实现5档分批止盈功能

**具体步骤**:
1. 实现`_calculate_tp_prices(buy_price)`：计算5档止盈价格
2. 实现`_create_tp_sell_orders(holding)`：创建止盈卖单
3. 实现`_check_tp_sell_fills(high)`：检查止盈卖单成交
4. 更新process_kline流程：
   - Step 3: 检查止盈卖单成交
   - Step 5: 更新/创建止盈卖单
5. 成交后更新`remaining_quantity`和`tp_levels_filled`

**验收标准**:
- [ ] 5档止盈价格正确(2%, 3%, 4%, 5%, 6%)
- [ ] 每档止盈20%仓位
- [ ] high >= tp_price时成交
- [ ] 全部止盈后从持仓移除

---

### TASK-004: 实现快速止损逻辑

**目标**: 实现3%快速止损

**具体步骤**:
1. 修改`_check_stop_loss()`方法
2. 止损价格 = buy_price × (1 - 0.03)
3. 触发条件：low <= stop_loss_price
4. 止损时全仓平仓，取消所有未成交止盈卖单

**验收标准**:
- [ ] 止损在3%时触发
- [ ] 止损时全仓平仓
- [ ] 相关止盈卖单被取消

---

### TASK-005: 创建配置文件和回测验证

**目标**: 创建配置文件并验证回测功能

**具体步骤**:
1. 创建`strategy15_split_take_profit.json`配置文件
2. 运行回测命令验证
3. 检查输出统计信息正确性

**验收标准**:
- [ ] 配置文件格式正确
- [ ] 回测可正常运行
- [ ] 输出包含分批止盈统计

---

## Q-Gate 5: 通过

- [x] 任务分解已完成（5个任务）
- [x] 任务粒度合适（每个任务30-45分钟）
- [x] 依赖关系已明确
- [x] 验收标准已定义
