# 需求澄清记录：滚动经验CDF信号策略

**迭代编号**: 034
**创建日期**: 2025-01-12
**状态**: Draft

---

## 澄清概要

本需求文档（PRD）由用户提供，内容已非常详尽完整，包含：
- 完整的数学定义
- 详细的执行模型
- 明确的验收标准
- 可执行的伪代码

以下记录需求理解过程中的关键确认点。

---

## 关键澄清点

### Q1: 经验CDF窗口是否包含当前样本？

**问题背景**: 经验CDF的计算需要明确窗口边界，是否包含当前样本X_t会影响信号的因果性。

**澄清结果**:
> ❌ **不包含当前样本**
>
> 窗口定义：W_t = {X_{t-1}, X_{t-2}, ..., X_{t-M}}
>
> 这确保了Prob_t的计算不会使用当时刻的信息，保持严格因果性。

**确认状态**: ✅ 已在PRD第5.4节明确定义

---

### Q2: 同一K线内买卖单撮合顺序如何处理？

**问题背景**: 如果同一根K线内既有待撮合的买单又有待撮合的卖单，撮合顺序会影响策略结果。

**澄清结果**:
> 固定顺序：**先卖后买**
>
> 1. 先撮合卖单（若持仓）
> 2. 再撮合买单（若空仓）
>
> 这避免了同bar"翻手套利"偏差。

**确认状态**: ✅ 已在PRD第9.3节明确定义

---

### Q3: 订单有效期如何定义？

**问题背景**: 限价单需要明确有效期，过长会累积风险，过短可能频繁未成交。

**澄清结果**:
> **GFOB (Good-for-One-Bar)**
>
> - 在bar t收盘挂出
> - 仅在bar t+1有效
> - 未成交则自动过期撤销

**确认状态**: ✅ 已在PRD第3节术语定义中明确

---

### Q4: 出场时使用哪种定价模式？

**问题背景**: PRD定义了两种出场价格（快速退出vs正常退出），需要明确选择逻辑。

**澄清结果**:
> **优先级判断**:
> 1. 若触发灾难止损或时间止损 → 使用快速退出价格（U_fast）
> 2. 否则若触发概率回归 → 使用正常退出价格（U_norm）
>
> 同一时刻最多挂出一张卖单，避免OCO复杂度。

**确认状态**: ✅ 已在PRD第8.2节明确定义

---

### Q5: 冷启动期如何处理？

**问题背景**: 经验CDF需要M个历史样本，冷启动期（t≤M）如何处理？

**澄清结果**:
> **边界条件**:
> - 当历史不足M时，Prob_t = NaN
> - 策略不得挂入场单
> - 需等待足够历史数据积累

**确认状态**: ✅ 已在PRD第5.4节明确定义

---

### Q6: 手续费和滑点如何处理？

**问题背景**: 实际交易需要考虑手续费和滑点成本。

**澄清结果**:
> **本迭代Out of Scope**
> - 预留配置项字段
> - 默认值为0
> - 后续迭代（Iteration 3）实现完整成本模型

**确认状态**: ✅ 已在PRD第2.2节Out of Scope中明确

---

## 隐含假设确认

### A1: 数据完整性假设
- 假设OHLC数据完整，无缺失
- 若缺少high/low，无法实现限价单撮合

### A2: 单仓位假设
- 同一时刻最多持有一个多头仓位
- 不支持加仓、分批建仓

### A3: 无做空假设
- 本迭代仅支持做多方向
- 做空逻辑在Out of Scope中

### A4: 执行价格假设
- 限价单成交价为限价本身
- 不考虑滑点（实际可能以更优价格成交）

---

## 遗留问题（Future Iterations）

| 问题 | 计划迭代 | 说明 |
|------|----------|------|
| 状态过滤（Regime Detection） | Iteration 2 | 趋势下跌期可能回撤大 |
| 赔率/期望值体系 | Iteration 3 | 完善风控报表 |
| 多品种组合 | Future | 资金分配策略 |
| 做空支持 | Future | 双向交易 |

---

## 需求确认签字

| 角色 | 状态 | 日期 |
|------|------|------|
| 产品经理 | ✅ 已确认 | 2025-01-12 |
| 技术负责人 | 待确认 | - |
| QA负责人 | 待确认 | - |

---

## 变更历史

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 1.0 | 2025-01-12 | 初始版本，基于用户详细PRD创建 | System |
