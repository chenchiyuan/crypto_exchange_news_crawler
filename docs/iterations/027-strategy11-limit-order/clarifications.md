# 需求澄清记录: 策略11 - 限价挂单买卖机制

## 文档信息

| 属性 | 值 |
|------|-----|
| 迭代编号 | 027 |
| 迭代名称 | strategy11-limit-order |
| 澄清日期 | 2026-01-10 |
| 参与者 | 用户、AI助手 |

---

## 澄清问题汇总

### Q1: 挂单策略 - 每根K线的挂单处理方式

**问题**：每根K线是取消之前所有挂单重新挂新单，还是保留未成交挂单累积？

**选项**：
- A) 重新挂单：每根K线取消所有未成交挂单，基于当前K线数据重新计算并挂10笔单
- B) 累积挂单：保留未成交挂单，仅补足数量差额
- C) 混合模式：超过一定K线数量未成交的挂单取消，其他保留

**用户选择**：**A) 重新挂单**

**影响**：
- 每根K线都需要清理上一根K线的未成交挂单
- 需要实现批量取消挂单功能
- 资金冻结/解冻逻辑需要在每根K线处理

---

### Q2: 资金占用 - 挂单的资金冻结时机

**问题**：每笔挂单立即占用资金（即使未成交），还是成交时才扣款？

**选项**：
- A) 挂单即占用：挂单时立即冻结资金，取消时解冻；符合真实交易所行为
- B) 成交时占用：仅在订单成交时扣除资金；可能导致后续挂单因资金不足失败

**用户选择**：**A) 挂单即占用**

**影响**：
- 需要维护"可用资金"和"冻结资金"两个状态
- 挂单失败时需要记录日志
- 取消挂单时需要解冻对应资金

---

### Q3: 单笔金额 - 挂单金额分配方式

**问题**：每笔挂单的金额如何分配？

**选项**：
- A) 固定金额：每笔挂单固定100 USDT，10笔共1000 USDT
- B) 平分资金：将可用资金平分给10笔挂单
- C) 配置指定：在JSON配置中指定单笔金额和挂单数量

**用户选择**：**C) 配置指定**

**影响**：
- 需要新增配置参数：`order_count`（挂单数量）、`order_interval`（挂单间隔）
- 复用现有的`position_size`参数作为单笔金额
- 配置解析器需要支持新参数

---

### Q4: 卖出逻辑 - 卖出价格计算方式

**问题**：用户描述中"在价格较低处挂100%买单"的具体含义？

**用户澄清**：计算5%止盈价格和EMA25价格，在较低的地方挂该订单的卖单。下根K线计算该卖价是否成交。

**最终逻辑**：
```python
卖出价格 = min(买入价 × 1.05, EMA25)
```

**影响**：
- 卖出价格取5%止盈价和EMA25的较低值
- 每根K线需要动态更新卖出价格（因为EMA25会变化）
- 成交判断：下根K线的 low <= 卖出价 <= high

---

### Q5: P5和mid数据来源

**问题**：计算挂单价格 `(P5 + mid) / 2` 时，P5和mid使用哪个数据源？

**用户澄清**：使用DDPS模块的算法计算概率分布和扇形面积：
- **P5**：概率分布的5%位置
- **mid**：扇形的中间位置

**影响**：
- 需要调用DDPS模块获取P5和mid值
- 与现有策略2、10使用的inertia_mid不同，需要确认具体计算方式

---

### Q6: 卖出挂单更新策略

**问题**：卖出挂单的价格是每根K线重新计算，还是挂单后固定？

**用户选择**：**动态更新** - 挂单价格按当前EMA25实时更新（每根K线重新计算）

**影响**：
- 每根K线需要重新计算所有持仓订单的卖出价格
- 卖出挂单需要更新而非取消重建

---

### Q7: 策略触发条件

**问题**：策略11是每根K线都尝试挂单，还是需要满足某个前置条件？

**用户选择**：**每根K线都挂单**（无前置条件）

**影响**：
- 简化策略逻辑，不需要额外的触发条件判断
- 每根K线固定执行挂单流程

---

### Q8: 回测数据配置

**问题**：回测ETHUSDT 1m CSV数据时的配置？

**用户确认**：
- **数据文件路径**：`/Users/chenchiyuan/projects/crypto_exchange_news_crawler/data/ETHUSDT-1m-2025-12.csv`
- **时间范围**：使用CSV文件的全部数据

**影响**：
- 配置文件中不需要指定start_date和end_date
- 复用现有的CSV数据源功能

---

## 核心决策汇总

| 决策项 | 最终决策 | 说明 |
|--------|----------|------|
| 挂单策略 | 每根K线重新挂单 | 取消未成交挂单，重新计算并挂新单 |
| 资金占用 | 挂单即冻结 | 符合真实交易所行为 |
| 金额分配 | 配置指定 | order_count, order_interval, position_size |
| 卖出价格 | min(5%止盈, EMA25) | 取较低价格挂卖单 |
| P5/mid来源 | DDPS模块 | 概率分布P5 + 扇形mid |
| 卖单更新 | 动态更新 | 每根K线重新计算 |
| 触发条件 | 无（每根K线挂单） | 简化策略逻辑 |
| 回测数据 | CSV全部数据 | ETHUSDT-1m-2025-12.csv |

---

## 后续确认事项

无待确认事项，需求已完整澄清。
