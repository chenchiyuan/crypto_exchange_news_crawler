# 需求澄清记录: 买卖订单追踪系统

**迭代编号**: 012
**文档版本**: 1.0
**创建日期**: 2026-01-06

---

## 澄清问题与决策

### Q1: 买入金额如何确定？

**用户原始描述**:
> 购买金额支持多策略，目前的策略是每次策略触发固定100U

**澄清决策**:
- MVP阶段：固定100 USDT
- 买入数量 = 100 / 买入价格
- 未来可扩展为多种金额策略

**状态**: ✅ 已确认

---

### Q2: 卖出策略的具体逻辑是什么？

**用户原始描述**:
> 买入之后的k线检查low到high之间的价格包含4h ema25均线价格，则以ema25均线价格卖出，按照第一个满足条件的k线卖出

**澄清决策**:
- 检查条件：`low <= EMA25 <= high`
- 卖出价格：当根K线的EMA25值
- 检查范围：从买入后的下一根K线开始
- 触发规则：第一个满足条件的K线即卖出
- 止损策略：MVP不带止损

**状态**: ✅ 已确认

---

### Q3: 如何处理未卖出的订单？

**隐含问题**: 买入后到当前时间未触发卖出条件

**澄清决策**:
- 状态标记为 `holding`（持仓中）
- 使用最新K线close计算浮动盈亏
- UI显示"持仓中"状态和浮动盈亏
- 统计面板单独显示持仓订单数

**状态**: ✅ 已确认

---

### Q4: 订单数据是否需要持久化？

**隐含问题**: 订单数据存储方式

**澄清决策**:
- MVP阶段：纯内存计算，不持久化
- 每次页面加载重新计算所有订单
- 与现有DDPS-Z架构保持一致
- 未来可扩展为数据库存储

**状态**: ✅ 已确认

---

### Q5: 统计面板需要展示哪些指标？

**用户原始描述**:
> 在/ddps-z/detail/ETHUSDT/ 中也有一个最简单的盈亏和胜率统计

**澄清决策**:
MVP统计面板包含6项指标：
1. 总订单数
2. 已卖出订单数
3. 持仓中订单数
4. 胜率（盈利订单/已卖出订单）
5. 总收益（已卖出订单盈亏之和）
6. 浮动盈亏（持仓订单浮动盈亏之和）

**状态**: ✅ 已确认

---

### Q6: 多买入策略的订单如何区分？

**隐含问题**: 策略1和策略2触发的订单

**澄清决策**:
- 每个订单记录 `buy_strategy_id`
- MVP阶段统一汇总统计
- 未来可按策略分组显示胜率

**状态**: ✅ 已确认

---

### Q7: 卖出点如何可视化？

**隐含问题**: 卖出K线的标记方式

**澄清决策**:
- 使用红色向下箭头 ↓
- 颜色：#dc3545（Bootstrap danger）
- 位置：K线上方（aboveBar）
- 文字：S（Sell）

**状态**: ✅ 已确认

---

### Q8: 是否显示订单连接线？

**隐含问题**: 买入点到卖出点的视觉连接

**澄清决策**:
- MVP阶段不实现连接线
- P1功能，后续可扩展
- 理由：增加复杂度，非核心功能

**状态**: ✅ 已确认（P1推迟）

---

### Q9: 是否需要操作日志功能？

**用户补充需求**:
> 需要有地方就按照时间展示所有的操作日志：买入，卖出事件

**澄清决策**:
- 新增操作日志面板，位于详情页底部
- 按时间倒序展示所有买卖事件
- 买入事件：绿色标识，显示时间、价格、数量
- 卖出事件：红色标识，显示时间、价格、数量、盈亏
- 支持筛选：全部/买入/卖出

**状态**: ✅ 已确认

---

### Q10: 操作日志的数据来源？

**隐含问题**: 如何生成操作日志数据

**澄清决策**:
- 从订单列表生成TradeEvent事件
- 每个订单生成1个买入事件
- 已卖出的订单额外生成1个卖出事件
- 所有事件按时间戳排序（倒序）
- 与订单数据一起在后端计算

**状态**: ✅ 已确认

---

## 边界条件处理

| 场景 | 处理方式 |
|------|----------|
| 买入信号为空 | 不创建订单，统计显示0 |
| 所有订单都未卖出 | 胜率显示"-"或"N/A" |
| K线数据不足 | 只计算可计算的订单 |
| 同一K线多个买入信号 | 分别创建独立订单 |
| EMA25值缺失 | 跳过该K线检查 |

---

## 需求变更记录

| 日期 | 变更内容 | 影响范围 | 状态 |
|------|----------|----------|------|
| 2026-01-06 | 初始需求定义 | - | ✅ 完成 |
| 2026-01-06 | 新增操作日志功能 | 后端+前端 | ✅ 完成 |

---

**文档状态**: ✅ 需求澄清完成
**遗留问题**: 无
