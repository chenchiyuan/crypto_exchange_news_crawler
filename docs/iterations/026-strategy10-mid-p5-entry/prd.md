# PRD: 策略10 - 中值P5突破做多策略

## 文档信息

| 属性 | 值 |
|------|-----|
| 迭代编号 | 026 |
| 迭代名称 | strategy10-mid-p5-entry |
| 版本 | 1.0 |
| 状态 | Draft |
| 创建日期 | 2026-01-09 |
| 关联任务 | TASK-026-xxx |

---

## 1. 背景与目标

### 1.1 业务背景

在现有的DDPS-Z策略体系中（策略1~8），已有多种做多和做空策略。用户希望新增**策略10**，采用中值与P5的平均值作为入场条件，配合简单的止盈规则，实现低位买入的保守型做多策略。

### 1.2 核心目标

构建策略10，实现以下功能：
1. **入场逻辑**：当close价格 >= (P5 + mid) / 2 时做多
2. **出场逻辑**：EMA25回归止盈 或 0.3%利润止盈
3. **风险控制**：不设置止损

### 1.3 策略定位

- **策略类型**：做多策略
- **入场特征**：价格处于中值与P5之间的相对低位
- **出场特征**：保守止盈，快速兑现利润

---

## 2. 核心功能需求

### 2.1 策略入场条件

| 条件ID | 条件描述 | 公式 |
|--------|----------|------|
| ENTRY-1 | 中值P5平均突破 | close >= (P5 + inertia_mid) / 2 |

**逻辑说明**：
- **P5**：价格分布的第5百分位，表示历史低位支撑
- **inertia_mid**：惯性中值，表示当前趋势的中心位置
- **(P5 + mid) / 2**：中值与P5的平均值，作为入场阈值
- 当收盘价达到或超过此阈值时，认为价格在低位区间反弹，触发做多

### 2.2 策略出场条件

| 条件ID | 条件描述 | 触发规则 | 优先级 |
|--------|----------|----------|--------|
| EXIT-1 | EMA25回归止盈 | low <= EMA25 <= high | 1 |
| EXIT-2 | 0.3%利润止盈 | (close - open_price) / open_price >= 0.3% | 2 |

**出场逻辑**：
- **EMA25回归**：当K线触及EMA25（穿过或触碰）时止盈
- **0.3%止盈**：当浮动盈利达到0.3%时止盈
- **止损**：无止损设置
- **优先级**：先到先触发原则

### 2.3 策略配置

```json
{
  "id": "strategy_10",
  "name": "中值P5突破做多",
  "type": "ddps-z",
  "enabled": true,
  "entry": {
    "strategy_id": 10,
    "description": "close >= (P5 + mid) / 2 时做多"
  },
  "exits": [
    {
      "type": "ema_reversion",
      "params": {},
      "description": "EMA25回归止盈"
    },
    {
      "type": "take_profit",
      "params": {
        "profit_rate": 0.003
      },
      "description": "0.3%利润止盈"
    }
  ]
}
```

---

## 3. 系统影响分析

### 3.1 需修改模块

| 模块 | 文件 | 修改类型 | 说明 |
|------|------|----------|------|
| SignalCalculator | `ddps_z/calculators/signal_calculator.py` | 扩展 | 新增策略10买入信号计算 |
| DDPSZAdapter | `strategy_adapter/adapters/ddpsz_adapter.py` | 扩展 | 支持strategy_id=10 |
| Exit配置 | `strategy_adapter/exits/` | 可能新增 | 如需新增0.3%止盈Exit |

### 3.2 复用现有组件

- **EMA25回归止盈**：复用现有 `ema_reversion` Exit
- **利润止盈**：可能复用或扩展现有止盈逻辑
- **配置系统**：复用JSON配置框架

---

## 4. 验收标准

### 4.1 功能验收

| 验收项 | 验收标准 |
|--------|----------|
| AC-1 | 策略10配置文件可正常加载 |
| AC-2 | 当close >= (P5 + mid)/2时正确触发买入信号 |
| AC-3 | EMA25回归时正确触发卖出 |
| AC-4 | 利润达到0.3%时正确触发卖出 |
| AC-5 | 回测结果可保存到数据库 |
| AC-6 | Web界面可查看回测结果 |

### 4.2 性能验收

| 指标 | 目标值 |
|------|--------|
| 信号计算延迟 | < 50ms（单币种） |
| 回测速度 | 1年数据 < 30秒 |

---

## 5. 技术约束

1. **向后兼容**：不破坏现有策略1~8的功能
2. **配置驱动**：策略参数通过JSON配置
3. **复用优先**：优先复用现有Exit组件

---

## 6. 排期建议

| 阶段 | 任务 | 复杂度 |
|------|------|--------|
| P4 | 架构设计 | 低 |
| P5 | 任务规划 | 低 |
| P6 | 实现开发 | 中 |
| P7 | 测试验收 | 低 |

预估工作量：约4小时

---

## 附录

### A. 策略对比

| 策略ID | 入场条件 | 方向 | 主要特点 |
|--------|----------|------|----------|
| 策略1 | low < P5 & 未来EMA上涨 | 做多 | EMA斜率预测 |
| 策略2 | mid < P5 & low < (mid+P5)/2 | 做多 | 惯性中值突破 |
| 策略7 | low <= P5 | 做多 | 动态Exit |
| **策略10** | **close >= (P5+mid)/2** | **做多** | **保守止盈** |

### B. 相关文档

- 策略框架：`docs/iterations/017-multi-strategy-backtest/`
- 策略7参考：`docs/iterations/021-adaptive-exit-strategy/`
- 做空策略：`docs/iterations/015-short-strategies/`
