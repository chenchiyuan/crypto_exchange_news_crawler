# 迭代005: Discovery历史扫描优化 - 快速初始化

**迭代
**迭代名称编号**: 005**: Discovery历史扫描优化
**开始日期**: 2025-12-25
**生命周期阶段**: P0 - 快速初始化

---

## 1. 需求背景

### 1.1 问题现状
当前Discovery阶段只检查最新K线数据，导致历史异常事件无法被回溯发现。用户希望Discovery能扫描全历史时期的数据，以捕捉类似ALLO/USDT在2025年11月26日的弃盘事件。

### 1.2 业务价值
- **历史回溯**: 能够发现遗漏的历史异常事件
- **策略完善**: 提升巨量诱多/弃盘检测的覆盖率
- **数据挖掘**: 发掘历史数据中的潜在交易机会

---

## 2. 约束条件

### 2.1 技术约束
- 基于现有架构增量开发
- 保持向后兼容性
- 现有8个检测器无需修改
- 不影响实时扫描功能

### 2.2 性能约束
- 批量扫描需要控制资源消耗
- 数据库查询需要优化
- 避免影响生产环境性能

### 2.3 时间约束
- 预估工作量: ≤ 3天
- 总时间: ≤ 5小时（P0-P5快速流程）

---

## 3. 可行性评估

### 3.1 架构兼容性
✅ **高兼容性**: 基于现有状态机架构
- VolumeTrapStateMachine已支持market_type参数
- 8个检测器逻辑独立，易于复用
- KLine模型支持market_type和symbol查询

### 3.2 技术实现难度
✅ **中等难度**: 需要修改核心组件
- 修改_volume_trap_fsm.py中的_discovery_condition方法
- 增加日期范围筛选参数
- 优化批量查询性能

### 3.3 数据模型影响
✅ **无破坏性变更**: 现有数据保持完整
- 不修改现有模型结构
- 仅增加查询参数和逻辑

---

## 4. 范围界定

### 4.1 In-Scope (范围内)
- [ ] Discovery阶段支持历史扫描
- [ ] scan_volume_traps命令支持start/end参数
- [ ] 默认行为：all（全部历史）
- [ ] 支持指定日期范围扫描
- [ ] 性能优化：批量查询和分页

### 4.2 Out-Scope (范围外)
- [ ] 修改检测器内部逻辑
- [ ] 新增数据库表或字段
- [ ] 前端界面修改
- [ ] 实时监控告警功能
- [ ] 数据可视化

---

## 5. Q-Gate 0检查

### 5.1 检查清单
- [x] 需求背景已理解
- [x] 约束条件已明确
- [x] 可行性已评估（工作量≤3天）
- [x] 架构兼容性已初步评估

### 5.2 评估结果
✅ **通过**: 需求清晰，技术可行，预计工作量2-3天

---

## 6. 下一步

进入P1阶段：需求定稿制
- 生成PRD文档
- 创建功能点清单
- 识别并澄清模糊点

---

**P0完成时间**: 2025-12-25
**P0状态**: ✅ 通过
