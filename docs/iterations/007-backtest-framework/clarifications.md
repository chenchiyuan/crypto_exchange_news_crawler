# Volume Trap 策略回测框架 - 需求澄清记录

## 澄清过程

### 澄清问题 1: 持仓周期的确定
**问题**: 持仓周期应该固定还是可配置？
**澄清结果**: 采用持续持仓策略，不做主动平仓。观察期默认分析全部历史数据，可配置截止时间。

### 澄清问题 2: 反弹的定义标准
**问题**: 什么样的涨幅算作"反弹"？需要设定阈值吗？
**澄清结果**: 反弹定义为从最低点后，价格上涨超过20%视为显著反弹。阈值可配置，默认为20%。

### 澄清问题 3: 最低点的有效范围
**问题**: 最低点必须在入场后多少根K线内才有效？
**澄清结果**: 最低点需要至少间隔1根K线（避免异常值），建议在有效数据范围内寻找。

### 澄清问题 4: 整体统计的分组维度
**问题**: 整体统计应该按哪些维度进行分组？
**澄清结果**: 支持按以下维度分组：
- 市场类型（现货/合约）
- K线周期（1h/4h/1d）
- 异常事件状态（疑似弃盘/确定弃盘）
- 时间范围（按季度/月度）

### 澄清问题 5: 数据不足的处理
**问题**: 如果某个异常事件后续K线数据不足怎么办？
**澄清结果**: 标记为"数据不足"状态，不参与统计，在API和页面中明确提示。

### 澄清问题 6: 最大回撤的计算
**问题**: 最大回撤应该按什么视角计算？
**澄清结果**: 做空视角下的最大回撤，即持仓期间价格上涨导致的最大浮亏幅度。

### 澄清问题 7: 入场价格的选择
**问题**: 入场价格用开盘价还是收盘价？
**澄清结果**: 使用触发后下一根K线的收盘价作为入场价格。

### 澄清问题 8: 出场价格的选择
**问题**: 出场价格如何确定？
**澄清结果**: 以固定持仓周期结束时的收盘价作为出场价格。

### 澄清问题 9: 盈亏比的计算
**问题**: 盈亏比如何计算？
**澄清结果**: 盈亏比 = 总盈利金额 / 总亏损金额，所有盈利交易的平均收益 / 所有亏损交易的平均亏损。

### 澄清问题 10: 前端展示需求
**问题**: 前端页面需要支持哪些交互功能？
**澄清结果**:
- 单个事件详情页：支持K线图表查看，关键点标注
- 整体统计面板：支持筛选条件，数据导出
- 批量回测：支持进度显示，错误提示

---

## 需求确认

### 已确认的模糊点
- [x] 持续持仓策略，不做主动平仓
- [x] 反弹阈值默认20%，可配置
- [x] 最低点需至少间隔1根K线
- [x] 支持多维度统计分组
- [x] 数据不足时标记状态
- [x] 做空视角计算最大回撤
- [x] 入场/出场价格使用收盘价
- [x] 盈亏比计算公式明确
- [x] 前端交互需求明确

### 待确认的细节
- [ ] 是否需要支持实时回测（基于最新数据持续更新）
- [ ] 是否需要添加基准对比（如BTC表现）
- [ ] 报告导出格式是否有特殊要求
- [ ] 是否需要添加策略优化建议功能

---

## 变更记录

### 版本 v1.0 (2024-12-26)
- 初始版本创建
- 完成需求澄清
- 确定P0/P1/P2功能范围
