# 验收检查清单 - K线图买入点标记系统

**迭代编号**: 011
**分支**: 011-buy-signal-markers
**创建日期**: 2026-01-06
**验收阶段**: P7 - 代码审查与验收

---

## 验收概览

| 验收类别 | 检查项数 | 通过标准 |
|---------|---------|----------|
| 功能验收 | 15 | 全部通过 |
| 性能验收 | 4 | 全部通过 |
| 代码质量 | 8 | 全部通过 |
| 回归测试 | 8 | 全部通过 |
| **总计** | **35** | **100%** |

---

## 1. 功能验收

### 1.1 策略1计算（F1.1）

| # | 检查项 | 通过 | 备注 |
|---|--------|-----|------|
| 1.1.1 | 当 low < P5 且 未来EMA > close 时正确触发 | [ ] | |
| 1.1.2 | 当 low >= P5 时不触发 | [ ] | |
| 1.1.3 | 当 未来EMA <= close 时不触发 | [ ] | |
| 1.1.4 | β斜率计算正确（β = EMA[t] - EMA[t-1]） | [ ] | |
| 1.1.5 | 未来EMA预测正确（未来EMA = EMA[t] + β × 6） | [ ] | |

### 1.2 策略2计算（F1.2）

| # | 检查项 | 通过 | 备注 |
|---|--------|-----|------|
| 1.2.1 | 当 β < 0 且 惯性mid < P5 且 low < 中值线 时正确触发 | [ ] | |
| 1.2.2 | 当 β >= 0 时不触发 | [ ] | |
| 1.2.3 | 当 惯性mid >= P5 时不触发 | [ ] | |
| 1.2.4 | 当 low >= 中值线 时不触发 | [ ] | |
| 1.2.5 | 中值线计算正确（中值线 = (惯性mid + P5) / 2） | [ ] | |

### 1.3 可视化（F2.1 - F2.4）

| # | 检查项 | 通过 | 备注 |
|---|--------|-----|------|
| 1.3.1 | 买入点标记正确渲染（绿色向上箭头） | [ ] | |
| 1.3.2 | Hover悬浮Card正确显示（触发时间、买入价格、策略原因） | [ ] | |
| 1.3.3 | Click固定Card正确工作（点击固定、ESC关闭） | [ ] | |
| 1.3.4 | 策略筛选控件正确工作（全部/策略1/策略2） | [ ] | |
| 1.3.5 | 筛选状态持久化（刷新页面后保持） | [ ] | |

---

## 2. 性能验收

| # | 检查项 | 目标值 | 实际值 | 通过 | 测试方法 |
|---|--------|--------|--------|-----|----------|
| 2.1 | 买入信号计算延迟（增量） | < 50ms | __ms | [ ] | Django Debug Toolbar |
| 2.2 | 500个标记渲染时间 | < 100ms | __ms | [ ] | Chrome Performance |
| 2.3 | Card显示延迟 | < 10ms | __ms | [ ] | 肉眼观察 |
| 2.4 | API响应时间增量 | < 50ms | __ms | [ ] | Network Panel |

---

## 3. 代码质量

### 3.1 代码规范

| # | 检查项 | 通过 | 备注 |
|---|--------|-----|------|
| 3.1.1 | 代码通过black格式化检查 | [ ] | `black --check ddps_z/` |
| 3.1.2 | 代码通过isort导入排序检查 | [ ] | `isort --check ddps_z/` |
| 3.1.3 | 代码通过flake8静态检查 | [ ] | `flake8 ddps_z/` |
| 3.1.4 | 无硬编码魔法数字（除配置文件） | [ ] | |

### 3.2 测试覆盖

| # | 检查项 | 通过 | 备注 |
|---|--------|-----|------|
| 3.2.1 | BuySignalCalculator单元测试通过 | [ ] | `pytest ddps_z/tests/test_buy_signal_calculator.py` |
| 3.2.2 | API集成测试通过 | [ ] | `pytest ddps_z/tests/test_chart_data_api.py` |
| 3.2.3 | 单元测试覆盖率 >= 90% | [ ] | `pytest --cov=ddps_z/calculators/buy_signal_calculator` |
| 3.2.4 | 所有边界条件有测试覆盖 | [ ] | |

---

## 4. 回归测试

### 4.1 现有功能回归

| # | 检查项 | 通过 | 备注 |
|---|--------|-----|------|
| 4.1.1 | EMA曲线正常显示 | [ ] | |
| 4.1.2 | P5/P95概率带正常显示 | [ ] | |
| 4.1.3 | Z-Score指标正常显示 | [ ] | |
| 4.1.4 | 惯性扇面正常显示 | [ ] | |
| 4.1.5 | 四象限信号正常显示 | [ ] | |

### 4.2 交互功能回归

| # | 检查项 | 通过 | 备注 |
|---|--------|-----|------|
| 4.2.1 | 时间范围切换正常（1周/1月/3月） | [ ] | |
| 4.2.2 | K线周期切换正常（1h/4h/1d） | [ ] | |
| 4.2.3 | 交易对切换正常（BTC/ETH/SOL...） | [ ] | |

---

## 5. 异常场景验收

| # | 检查项 | 通过 | 备注 |
|---|--------|-----|------|
| 5.1 | 数据不足时优雅降级（返回空数组，不报错） | [ ] | |
| 5.2 | 无买入点时页面正常显示 | [ ] | |
| 5.3 | 大量买入点（>100）时性能可接受 | [ ] | |
| 5.4 | Card不超出图表边界（边界检测） | [ ] | |

---

## 6. 验收测试执行记录

### 6.1 测试环境

| 项目 | 值 |
|-----|---|
| 测试日期 | 2026-__-__ |
| 测试人员 | |
| 测试环境 | local / staging |
| 浏览器 | Chrome __ / Safari __ |
| 测试交易对 | BTCUSDT / ETHUSDT |

### 6.2 测试数据

| 项目 | 值 |
|-----|---|
| K线数量 | __ 根 |
| 策略1触发次数 | __ 次 |
| 策略2触发次数 | __ 次 |
| 双策略触发次数 | __ 次 |

### 6.3 执行命令

```bash
# 运行所有测试
python manage.py test ddps_z.tests.test_buy_signal_calculator --verbosity=2

# 运行集成测试
python manage.py test ddps_z.tests.test_chart_data_api -k buy_signal --verbosity=2

# 代码质量检查
black --check ddps_z/calculators/buy_signal_calculator.py
isort --check ddps_z/calculators/buy_signal_calculator.py
flake8 ddps_z/calculators/buy_signal_calculator.py

# 测试覆盖率
pytest ddps_z/tests/test_buy_signal_calculator.py --cov=ddps_z/calculators/buy_signal_calculator --cov-report=term-missing
```

---

## 7. 验收结论

### 7.1 验收结果

| 类别 | 通过 | 失败 | 跳过 | 通过率 |
|-----|-----|-----|-----|-------|
| 功能验收 | __/15 | __ | __ | __% |
| 性能验收 | __/4 | __ | __ | __% |
| 代码质量 | __/8 | __ | __ | __% |
| 回归测试 | __/8 | __ | __ | __% |
| **总计** | __/35 | __ | __ | __% |

### 7.2 问题清单

| # | 问题描述 | 严重程度 | 状态 | 责任人 |
|---|---------|---------|-----|-------|
| | | 高/中/低 | 待修复/已修复 | |

### 7.3 验收意见

- [ ] **通过**：所有检查项通过，可以合并到主分支
- [ ] **有条件通过**：存在低优先级问题，修复后可合并
- [ ] **不通过**：存在关键问题，需返工修复

**验收人签字**: ____________
**验收日期**: 2026-__-__

---

## 8. 附录

### 8.1 测试截图

> 请在此处粘贴关键测试截图

### 8.2 性能报告

> 请在此处粘贴性能测试报告

### 8.3 代码审查记录

> 请在此处记录代码审查意见

---

**文档版本**: v1.0.0
**创建时间**: 2026-01-06
**状态**: 待验收
