# æ¶æ„è®¾è®¡: Kçº¿å›¾ä¹°å…¥ç‚¹æ ‡è®°ç³»ç»Ÿ

**è¿­ä»£ç¼–å·**: 011
**åˆ†æ”¯**: 011-buy-signal-markers
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**åˆ›å»ºæ—¥æœŸ**: 2026-01-06
**ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ**: P4 - æ¶æ„è®¾è®¡

---

## âš ï¸ å¢é‡æ›´æ–°å£°æ˜

**æœ¬è¿­ä»£æ˜¯å¢é‡æ›´æ–°ï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š**

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **å®Œå…¨å…¼å®¹** | ç°æœ‰ DDPS-Z æ‰€æœ‰åŠŸèƒ½ä¿æŒä¸å˜ï¼ˆEMAã€æ¦‚ç‡å¸¦ã€æƒ¯æ€§é¢„æµ‹ã€Z-Scoreä¿¡å·ï¼‰ |
| **åŠŸèƒ½å åŠ ** | ä¹°å…¥ç‚¹æ ‡è®°æ˜¯**æ–°å¢**åŠŸèƒ½ï¼Œä½œä¸ºç‹¬ç«‹çš„ç­–ç•¥éªŒè¯å·¥å…· |
| **å¤ç”¨ä¼˜å…ˆ** | å……åˆ†å¤ç”¨ç°æœ‰è®¡ç®—èƒ½åŠ›ï¼ˆP5ã€æƒ¯æ€§midã€EMAã€Î²ç­‰ï¼‰ |
| **UI æ‰©å±•** | å‰ç«¯æ–°å¢ä¹°å…¥ç‚¹æ ‡è®°å’Œæ‚¬æµ®Cardï¼Œä¸ä¿®æ”¹ç°æœ‰å›¾è¡¨å…ƒç´  |

---

## 1. éœ€æ±‚æ¦‚è¿°

### 1.1 æ ¸å¿ƒä¸šåŠ¡ç›®æ ‡

ä¸ºDDPS-Zç³»ç»Ÿæ·»åŠ ä¹°å…¥ç‚¹æ ‡è®°åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·**éªŒè¯ä¹°å…¥ç­–ç•¥çš„æœ‰æ•ˆæ€§**ï¼Œé€šè¿‡å†å²å›æµ‹å¿«é€Ÿè¯†åˆ«ç­–ç•¥è§¦å‘é¢‘ç‡å’Œå‡†ç¡®æ€§ã€‚

### 1.2 å…³é”®åŠŸèƒ½ç‚¹ï¼ˆP0çº§åˆ«ï¼‰

**ä¹°å…¥ç­–ç•¥è®¡ç®—å¼•æ“**ï¼š
- [P0] F1.1 ç­–ç•¥1è®¡ç®—å™¨ï¼šEMAæ–œç‡æœªæ¥é¢„æµ‹
  - è§¦å‘æ¡ä»¶ï¼šKçº¿low < P5 ä¸” æœªæ¥6å‘¨æœŸEMAé¢„æµ‹ä»·æ ¼ > å½“å‰close
  - ä¹°å…¥ä»·æ ¼ï¼šKçº¿close
- [P0] F1.2 ç­–ç•¥2è®¡ç®—å™¨ï¼šæƒ¯æ€§ä¸‹è·Œä¸­å€¼çªç ´
  - å‰ç½®æ¡ä»¶ï¼šÎ² < 0ï¼ˆä¸‹è·Œè¶‹åŠ¿ï¼‰
  - è§¦å‘æ¡ä»¶ï¼šæƒ¯æ€§mid < P5 ä¸” Kçº¿low < (æƒ¯æ€§mid + P5)/2
  - ä¹°å…¥ä»·æ ¼ï¼šKçº¿close
- [P0] F1.3 ä¹°å…¥ä¿¡å·æ•°æ®ç»“æ„ï¼šç­–ç•¥æ•°ç»„ç»“æ„ï¼Œæ”¯æŒå¤šç­–ç•¥å¹¶å­˜

**å¯è§†åŒ–ä¸äº¤äº’**ï¼š
- [P0] F2.1 æ—¶é—´è½´ä¹°å…¥ç‚¹æ ‡è®°ï¼šLightweightCharts Markers APIï¼Œç»¿è‰²å‘ä¸Šç®­å¤´
- [P0] F2.2 Hoveræ‚¬æµ®Cardï¼šæ˜¾ç¤ºè§¦å‘æ—¶é—´ã€ä¹°å…¥ä»·æ ¼ã€æ‰€æœ‰è§¦å‘ç­–ç•¥åŠåŸå› 
- [P0] F2.3 ç‚¹å‡»å›ºå®šCardï¼šç‚¹å‡»ä¹°å…¥ç‚¹æ ‡è®°å›ºå®šæ˜¾ç¤ºCard
- [P0] F2.4 ç­–ç•¥ç­›é€‰æ§ä»¶ï¼šBootstrapæŒ‰é’®ç»„ï¼ˆå…¨éƒ¨/ç­–ç•¥1/ç­–ç•¥2ï¼‰

**å†å²å›æº¯ä¸æ€§èƒ½**ï¼š
- [P0] F3.1 å†å²ä¹°å…¥ç‚¹æ˜¾ç¤ºï¼šä¸å›¾è¡¨æ•°æ®èŒƒå›´ä¸€è‡´ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½
- [P0] F3.2 æ€§èƒ½ä¼˜åŒ–æœºåˆ¶ï¼šåç«¯è®¡ç®—ã€æ‰¹é‡æ¸²æŸ“ã€å¢é‡åŠ è½½

**åç«¯API**ï¼š
- [P0] F4.1 åç«¯APIæ‰©å±•ï¼šåœ¨`/ddps-z/api/chart/`å“åº”ä¸­æ–°å¢`buy_signals`å­—æ®µ

### 1.3 å…³é”®ç”¨æˆ·æµç¨‹

1. ç”¨æˆ·æ‰“å¼€DDPS-Zè¯¦æƒ…é¡µï¼ŒæŸ¥çœ‹Kçº¿å›¾
2. ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—å¹¶æ ‡è®°å†å²ä¹°å…¥ç‚¹ï¼ˆç»¿è‰²å‘ä¸Šç®­å¤´ï¼‰
3. ç”¨æˆ·æ‚¬åœåœ¨ä¹°å…¥ç‚¹æ ‡è®°ä¸Šï¼ŒæŸ¥çœ‹è¯¦ç»†è§¦å‘ä¿¡æ¯
4. ç”¨æˆ·ç‚¹å‡»ä¹°å…¥ç‚¹æ ‡è®°ï¼Œå›ºå®šæ˜¾ç¤ºCard
5. ç”¨æˆ·ä½¿ç”¨ç­›é€‰æ§ä»¶åˆ‡æ¢ä¸åŒç­–ç•¥çš„ä¹°å…¥ç‚¹æ˜¾ç¤º

---

## 2. æ ¸å¿ƒæŠ€æœ¯é€‰å‹

### 2.1 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Python | 3.x | æ ¸å¿ƒç¼–ç¨‹è¯­è¨€ |
| Django | 4.x | Webæ¡†æ¶ |
| Django REST Framework | 3.x | APIæ¡†æ¶ |
| NumPy | 1.x | **ä¹°å…¥ä¿¡å·å‘é‡åŒ–è®¡ç®—** |

**é€‰å‹ç†ç”±**ï¼š
- âœ… ä¸ç°æœ‰DDPS-Zç³»ç»Ÿå®Œå…¨ä¸€è‡´ï¼Œé›¶å­¦ä¹ æˆæœ¬
- âœ… NumPyå‘é‡åŒ–è®¡ç®—æ€§èƒ½ä¼˜å¼‚ï¼ˆå¤„ç†5000æ ¹Kçº¿<50msï¼‰
- âœ… å¯ç›´æ¥å¤ç”¨EMAã€Inertiaã€ZScoreè®¡ç®—å™¨

### 2.2 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| LightweightCharts | 4.x | **ä¹°å…¥ç‚¹Markersæ¸²æŸ“** |
| Bootstrap | 5.x | **UIç»„ä»¶ï¼ˆCardã€æŒ‰é’®ç»„ï¼‰** |
| Vanilla JavaScript | ES6+ | å‰ç«¯é€»è¾‘ |

**é€‰å‹ç†ç”±**ï¼š
- âœ… LightweightChartsåŸç”Ÿæ”¯æŒMarkers APIï¼Œæ€§èƒ½æœ€ä¼˜ï¼ˆ500ä¸ªæ ‡è®°<100msï¼‰
- âœ… Bootstrap Cardç»„ä»¶å¼€ç®±å³ç”¨ï¼Œæ ·å¼ç»Ÿä¸€
- âœ… Crosshairå’ŒClickäº‹ä»¶åŸç”Ÿæ”¯æŒï¼Œå®ç°ç®€å•

### 2.3 æ–°å¢ä¾èµ–

âœ… **æ— éœ€å¼•å…¥ä»»ä½•æ–°ä¾èµ–**ï¼Œå®Œå…¨å¤ç”¨ç°æœ‰æŠ€æœ¯æ ˆ

---

## 3. æ ¸å¿ƒæ¶æ„è®¾è®¡

### 3.1 ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç°æœ‰æ¶æ„ï¼ˆå®Œå…¨å¤ç”¨ï¼‰"
        EMA["EMACalculator<br/>âœ… å¤ç”¨"]
        Inertia["InertiaCalculator<br/>âœ… å¤ç”¨"]
        ZScore["ZScoreCalculator<br/>âœ… å¤ç”¨"]
        EWMA["EWMACalculator<br/>âœ… å¤ç”¨"]
    end

    subgraph "æ–°å¢æ¨¡å—"
        BuySignal["ğŸ†• BuySignalCalculator<br/>ï¼ˆä¹°å…¥ä¿¡å·è®¡ç®—å™¨ï¼‰"]
    end

    subgraph "æ‰©å±•æ¨¡å—"
        ChartService["ğŸ“ ChartDataService<br/>æ‰©å±•: +buy_signalså­—æ®µ"]
        DetailHTML["ğŸ“ detail.html<br/>æ‰©å±•: +Markers +Card +ç­›é€‰"]
    end

    EMA --> BuySignal
    Inertia --> BuySignal
    ZScore --> BuySignal
    EWMA --> ZScore

    BuySignal --> ChartService
    ChartService --> DetailHTML

    style BuySignal fill:#90EE90
    style ChartService fill:#FFD700
    style DetailHTML fill:#87CEEB
```

### 3.2 æ¶æ„è¯´æ˜

#### 3.2.1 ç°æœ‰æ¶æ„ï¼ˆå®Œå…¨å¤ç”¨ï¼‰

| è®¡ç®—å™¨ | æä¾›èƒ½åŠ› | æœ¬è¿­ä»£ç”¨é€” |
|--------|---------|-----------|
| **EMACalculator** | EMAåºåˆ—è®¡ç®— | ç­–ç•¥1: è®¡ç®—Î²æ–œç‡å’Œæœªæ¥EMAé¢„æµ‹ |
| **InertiaCalculator** | Î²åºåˆ—ã€æƒ¯æ€§mid | ç­–ç•¥1: è·å–Î²<br/>ç­–ç•¥2: åˆ¤æ–­ä¸‹è·Œè¶‹åŠ¿+è·å–æƒ¯æ€§mid |
| **ZScoreCalculator** | P5/P95é™æ€é˜ˆå€¼ | ç­–ç•¥1å’Œç­–ç•¥2: è·å–P5ä»·æ ¼é˜ˆå€¼ |
| **EWMACalculator** | EWMA Î¼/Ïƒè®¡ç®— | é€šè¿‡ZScoreCalculatoré—´æ¥ä½¿ç”¨ï¼ˆP5è®¡ç®—ï¼‰ |

#### 3.2.2 æ–°å¢æ¨¡å—

**BuySignalCalculatorï¼ˆä¹°å…¥ä¿¡å·è®¡ç®—å™¨ï¼‰**ï¼š
- **æ–‡ä»¶è·¯å¾„**ï¼š`ddps_z/calculators/buy_signal_calculator.py`
- **æœåŠ¡å±‚çº§**ï¼šAtomicï¼ˆåŸå­çº§æœåŠ¡ï¼‰
- **å”¯ä¸€èŒè´£**ï¼šå®ç°ç­–ç•¥1å’Œç­–ç•¥2çš„è§¦å‘é€»è¾‘ï¼Œè¿”å›ä¹°å…¥ä¿¡å·æ•°ç»„

**æ¥å£å¥‘çº¦**ï¼š
```python
class BuySignalCalculator:
    def calculate(
        self,
        klines: List[Dict],      # Kçº¿OHLCæ•°æ®
        ema_series: np.ndarray,  # EMAåºåˆ—
        p5_series: np.ndarray,   # P5ä»·æ ¼åºåˆ—
        beta_series: np.ndarray, # Î²æ–œç‡åºåˆ—
        inertia_mid_series: np.ndarray  # æƒ¯æ€§midåºåˆ—
    ) -> List[Dict]:
        """
        è®¡ç®—ä¹°å…¥ä¿¡å·

        Returns:
            [
                {
                    'timestamp': int,          # æ¯«ç§’æ—¶é—´æˆ³
                    'kline_index': int,        # Kçº¿ç´¢å¼•
                    'strategies': [
                        {
                            'id': 'strategy_1',
                            'name': 'EMAæ–œç‡æœªæ¥é¢„æµ‹',
                            'triggered': bool,
                            'reason': str,
                            'details': {
                                'current_low': float,
                                'p5': float,
                                'future_ema': float,
                                'current_close': float,
                                'beta': float
                            }
                        },
                        {
                            'id': 'strategy_2',
                            'name': 'æƒ¯æ€§ä¸‹è·Œä¸­å€¼çªç ´',
                            'triggered': bool,
                            'reason': str,
                            'details': {
                                'beta': float,
                                'inertia_mid': float,
                                'p5': float,
                                'mid_line': float,
                                'current_low': float
                            }
                        }
                    ],
                    'buy_price': float         # ä¹°å…¥ä»·æ ¼ï¼ˆKçº¿closeï¼‰
                },
                ...
            ]
        """
```

**æ ¸å¿ƒè®¡ç®—é€»è¾‘**ï¼š

**ç­–ç•¥1: EMAæ–œç‡æœªæ¥é¢„æµ‹**
```python
# 1. è®¡ç®—Î²æ–œç‡
Î² = ema_series[t] - ema_series[t-1]

# 2. é¢„æµ‹æœªæ¥6å‘¨æœŸEMA
future_ema = ema_series[t] + (Î² Ã— 6)

# 3. åˆ¤æ–­è§¦å‘
if (kline['low'] < p5_series[t]) and (future_ema > kline['close']):
    triggered = True
    buy_price = kline['close']
```

**ç­–ç•¥2: æƒ¯æ€§ä¸‹è·Œä¸­å€¼çªç ´**
```python
# 1. åˆ¤æ–­ä¸‹è·Œè¶‹åŠ¿
if beta_series[t] < 0:
    # 2. è®¡ç®—ä¸­å€¼çº¿
    mid_line = (inertia_mid_series[t] + p5_series[t]) / 2

    # 3. åˆ¤æ–­è§¦å‘
    if (inertia_mid_series[t] < p5_series[t]) and (kline['low'] < mid_line):
        triggered = True
        buy_price = kline['close']
```

**å¼‚å¸¸è¾¹ç•Œ**ï¼š
- `ERR_DATA_INSUFFICIENT`: å½“EMAæˆ–P5åºåˆ—é•¿åº¦ä¸è¶³æ—¶è§¦å‘
- `ERR_INVALID_BETA`: å½“Î²åºåˆ—åŒ…å«NaNæˆ–Infæ—¶è§¦å‘
- `ERR_INVALID_KLINE`: å½“Kçº¿æ•°æ®ç¼ºå°‘å¿…è¦å­—æ®µæ—¶è§¦å‘

**æµ‹è¯•é‡ç‚¹**ï¼š
- [ ] æ­£å¸¸åœºæ™¯ï¼šç­–ç•¥1æ­£ç¡®è§¦å‘ï¼ˆlow < P5 ä¸” æœªæ¥EMA > closeï¼‰
- [ ] è¾¹ç•Œåœºæ™¯ï¼šç­–ç•¥2åœ¨Î²=0æ—¶ä¸è§¦å‘
- [ ] å¼‚å¸¸åœºæ™¯ï¼šæ•°æ®ä¸è¶³æ—¶æŠ›å‡ºERR_DATA_INSUFFICIENT

**æ˜ å°„éœ€æ±‚**ï¼šå¯¹åº”PRD [P0] ä¹°å…¥ç­–ç•¥è®¡ç®—å¼•æ“æ¨¡å—

**ä¸šåŠ¡æ”¯æ’‘**ï¼š
- æ”¯æ’‘æµç¨‹1: å†å²ä¹°å…¥ç‚¹æ ‡è®°
- æ”¯æ’‘æµç¨‹2: Hover/Clickæ‚¬æµ®Card
- æ”¯æ’‘æµç¨‹3: ç­–ç•¥ç­›é€‰åŠŸèƒ½

#### 3.2.3 æ‰©å±•æ¨¡å—

**ChartDataServiceæ‰©å±•**ï¼š
- **æ‰©å±•ä½ç½®**ï¼š`get_chart_data()` æ–¹æ³•çš„è¿”å›å€¼`chart`å¯¹è±¡
- **æ‰©å±•æ–¹å¼**ï¼šæ–°å¢ `buy_signals` å­—æ®µï¼ˆä¸ `fan` å­—æ®µå¹¶åˆ—ï¼‰
- **å‚è€ƒæ¨¡å¼**ï¼š`_generate_fan_data()` æ–¹æ³•ï¼ˆline 634-818ï¼‰çš„è®¾è®¡æ¨¡å¼

**æ‰©å±•æ¥å£**ï¼š
```python
def get_chart_data(self, symbol, interval, range, ...):
    # ... ç°æœ‰é€»è¾‘ä¿æŒä¸å˜ ...

    # ğŸ†• ç”Ÿæˆä¹°å…¥ä¿¡å·æ•°æ®
    buy_signals_data = self._generate_buy_signals_data(
        klines=klines,
        ema_series=ema_result['ema'],
        p5_series=p5_series,
        beta_series=beta_series,
        inertia_mid_series=inertia_mid_series
    )

    return {
        'success': True,
        'chart': {
            'candles': klines,
            'ema': ema_data,
            'bands': bands,
            'zscore': zscore_data,
            'fan': fan_data,
            'buy_signals': buy_signals_data  # ğŸ†• æ–°å¢å­—æ®µ
        },
        'meta': {...}
    }
```

**detail.htmlå‰ç«¯æ‰©å±•**ï¼š
- **æ‰©å±•1ï¼šä¹°å…¥ç‚¹æ ‡è®°æ¸²æŸ“**
  ```javascript
  const markers = buySignals.map(signal => ({
      time: signal.timestamp / 1000,
      position: 'belowBar',
      color: '#28a745',
      shape: 'arrowUp',
      text: 'B',
      size: 1
  }));
  candleSeries.setMarkers(markers);
  ```

- **æ‰©å±•2ï¼šHoveræ‚¬æµ®Card**
  ```javascript
  chart.subscribeCrosshairMove((param) => {
      const buySignal = findBuySignalByTime(param.time);
      if (buySignal) {
          showCard(buySignal, param.point);
      }
  });
  ```

- **æ‰©å±•3ï¼šClickå›ºå®šCard**
  ```javascript
  chart.subscribeClick((param) => {
      if (isBuySignalMarker(param)) {
          showFixedCard(buySignal);
      } else {
          hideFixedCard();
      }
  });
  ```

- **æ‰©å±•4ï¼šç­–ç•¥ç­›é€‰æ§ä»¶**
  ```html
  <div class="btn-group" role="group">
      <button class="btn btn-outline-success btn-sm active" data-filter="all">å…¨éƒ¨</button>
      <button class="btn btn-outline-success btn-sm" data-filter="strategy_1">ç­–ç•¥1</button>
      <button class="btn btn-outline-success btn-sm" data-filter="strategy_2">ç­–ç•¥2</button>
  </div>
  ```

### 3.3 åº•å±‚åŸå­æœåŠ¡å®šä¹‰ (Critical Foundation)

âš ï¸ **æ³¨æ„**: æ­¤éƒ¨åˆ†å®šä¹‰çš„ç»„ä»¶æ˜¯ç³»ç»Ÿçš„åŸºçŸ³ï¼Œä»»ä½•å˜æ›´å¿…é¡»ç»è¿‡ä¸¥æ ¼çš„å›å½’æµ‹è¯•ã€‚

#### [Core-Atomic] BuySignalCalculator - æ ¸å¿ƒåŸå­æœåŠ¡

**æœåŠ¡å±‚çº§**: Atomic

**èŒè´£**:
è´Ÿè´£è®¡ç®—ä¹°å…¥ç­–ç•¥çš„è§¦å‘ä¿¡å·ï¼Œä¸æ¶‰åŠæ•°æ®è·å–å’ŒAPIå“åº”ç»„è£…

**æ¥å£å¥‘çº¦**:
- **Input**:
  - klines (List[Dict], Kçº¿OHLCæ•°æ®ï¼Œå¿…é¡»åŒ…å«open_timeã€highã€lowã€closeå­—æ®µ)
  - ema_series (np.ndarray, EMAåºåˆ—ï¼Œé•¿åº¦å¿…é¡»ä¸klinesä¸€è‡´)
  - p5_series (np.ndarray, P5ä»·æ ¼åºåˆ—ï¼Œé•¿åº¦å¿…é¡»ä¸klinesä¸€è‡´)
  - beta_series (np.ndarray, Î²æ–œç‡åºåˆ—ï¼Œé•¿åº¦å¿…é¡»ä¸klinesä¸€è‡´)
  - inertia_mid_series (np.ndarray, æƒ¯æ€§midåºåˆ—ï¼Œé•¿åº¦å¿…é¡»ä¸klinesä¸€è‡´)

- **Output**:
  - signals (List[Dict]: ä¹°å…¥ä¿¡å·æ•°ç»„)
    - timestamp (int: æ¯«ç§’æ—¶é—´æˆ³)
    - kline_index (int: Kçº¿ç´¢å¼•)
    - strategies (List[Dict]: ç­–ç•¥è§¦å‘ä¿¡æ¯æ•°ç»„)
    - buy_price (float: ä¹°å…¥ä»·æ ¼)

- **å¼‚å¸¸**:
  - ERR_DATA_INSUFFICIENT: å½“è¾“å…¥åºåˆ—é•¿åº¦ä¸è¶³æˆ–ä¸ä¸€è‡´æ—¶è§¦å‘
  - ERR_INVALID_BETA: å½“Î²åºåˆ—åŒ…å«NaNæˆ–Infæ—¶è§¦å‘
  - ERR_INVALID_KLINE: å½“Kçº¿æ•°æ®ç¼ºå°‘å¿…è¦å­—æ®µæ—¶è§¦å‘

**æ ¸å¿ƒä¿éšœç­–ç•¥**:
æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆæ‰€æœ‰è¾“å…¥åºåˆ—é•¿åº¦å¿…é¡»ä¸€è‡´ï¼‰ã€NaNå€¼æ˜¾å¼å¤„ç†ã€è¾¹ç•Œæ¡ä»¶éªŒè¯

**æµ‹è¯•é‡ç‚¹**:
å¿…é¡»é€šè¿‡ç­–ç•¥1å’Œç­–ç•¥2çš„æ­£ç¡®è§¦å‘æµ‹è¯•ã€è¾¹ç•Œæ¡ä»¶æµ‹è¯•ï¼ˆÎ²=0ã€P5=0ã€æ•°æ®ä¸è¶³ï¼‰ã€å¼‚å¸¸æµ‹è¯•

**æ˜ å°„éœ€æ±‚**:
å¯¹åº”PRD [P0] ä¹°å…¥ç­–ç•¥è®¡ç®—å¼•æ“æ¨¡å—

**ä¸šåŠ¡æ”¯æ’‘**:
- æ”¯æ’‘æµç¨‹1: å†å²ä¹°å…¥ç‚¹æ ‡è®°
- æ”¯æ’‘æµç¨‹2: Hover/Clickæ‚¬æµ®Card
- æ”¯æ’‘æµç¨‹3: ç­–ç•¥ç­›é€‰åŠŸèƒ½
- [æ ‡è®°ä¸º**Core-Atomic**ï¼šæ”¯æ’‘>3ä¸ªä¸šåŠ¡æµ]

### 3.4 ç»„ä»¶ä¸éœ€æ±‚æ˜ å°„

| ç»„ä»¶ | è´Ÿè´£åŠŸèƒ½ç‚¹ | ä¼˜å…ˆçº§ |
|------|-----------|-------|
| **BuySignalCalculator** | F1.1 ç­–ç•¥1è®¡ç®—å™¨<br/>F1.2 ç­–ç•¥2è®¡ç®—å™¨<br/>F1.3 ä¹°å…¥ä¿¡å·æ•°æ®ç»“æ„ | P0 |
| **ChartDataServiceæ‰©å±•** | F4.1 åç«¯APIæ‰©å±• | P0 |
| **detail.html Markers** | F2.1 æ—¶é—´è½´ä¹°å…¥ç‚¹æ ‡è®° | P0 |
| **detail.html Card** | F2.2 Hoveræ‚¬æµ®Card<br/>F2.3 ç‚¹å‡»å›ºå®šCard | P0 |
| **detail.html ç­›é€‰** | F2.4 ç­–ç•¥ç­›é€‰æ§ä»¶ | P0 |
| **ChartDataServiceåŠ¨æ€åŠ è½½** | F3.1 å†å²ä¹°å…¥ç‚¹æ˜¾ç¤º<br/>F3.2 æ€§èƒ½ä¼˜åŒ–æœºåˆ¶ | P0 |

---

## 4. å˜æ›´ç‚¹è¯´æ˜

### 4.1 å˜æ›´æ¦‚è¿°

åŸºäºPRDä¸­çš„åŠŸèƒ½éœ€æ±‚åˆ†æï¼Œå½“å‰æ¶æ„éœ€è¦è¿›è¡Œä»¥ä¸‹ä¸»è¦å˜æ›´ï¼š
- **æ–°å¢ä¹°å…¥ä¿¡å·è®¡ç®—èƒ½åŠ›**ï¼šåˆ›å»ºç‹¬ç«‹çš„BuySignalCalculatoråŸå­æœåŠ¡
- **æ‰©å±•APIå“åº”ç»“æ„**ï¼šåœ¨ChartDataServiceçš„chartå“åº”ä¸­æ–°å¢buy_signalså­—æ®µ
- **æ‰©å±•å‰ç«¯å¯è§†åŒ–**ï¼šåœ¨detail.htmlä¸­æ–°å¢Markersæ¸²æŸ“ã€Cardæ˜¾ç¤ºã€ç­›é€‰æ§ä»¶

### 4.2 æ¶æ„å˜æ›´å¯¹æ¯”

#### å½“å‰æ¶æ„ï¼ˆç°çŠ¶ï¼‰

```
ddps_z/
â”œâ”€â”€ calculators/
â”‚   â”œâ”€â”€ ema_calculator.py        âœ… å¤ç”¨
â”‚   â”œâ”€â”€ inertia_calculator.py    âœ… å¤ç”¨
â”‚   â”œâ”€â”€ zscore_calculator.py     âœ… å¤ç”¨
â”‚   â””â”€â”€ ewma_calculator.py       âœ… å¤ç”¨
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ddps_service.py          âœ… ä¸ä¿®æ”¹
â”‚   â””â”€â”€ chart_data_service.py    âœ… ç°æœ‰åŠŸèƒ½
â””â”€â”€ templates/ddps_z/
    â””â”€â”€ detail.html              âœ… ç°æœ‰åŠŸèƒ½
```

#### ç›®æ ‡æ¶æ„ï¼ˆå˜æ›´åï¼‰

```
ddps_z/
â”œâ”€â”€ calculators/
â”‚   â”œâ”€â”€ ema_calculator.py        âœ… å¤ç”¨
â”‚   â”œâ”€â”€ inertia_calculator.py    âœ… å¤ç”¨
â”‚   â”œâ”€â”€ zscore_calculator.py     âœ… å¤ç”¨
â”‚   â”œâ”€â”€ ewma_calculator.py       âœ… å¤ç”¨
â”‚   â””â”€â”€ buy_signal_calculator.py ğŸ†• æ–°å¢
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ddps_service.py          âœ… ä¸ä¿®æ”¹
â”‚   â””â”€â”€ chart_data_service.py    ğŸ“ æ‰©å±•ï¼ˆ+buy_signalså­—æ®µï¼‰
â””â”€â”€ templates/ddps_z/
    â””â”€â”€ detail.html              ğŸ“ æ‰©å±•ï¼ˆ+Markers +Card +ç­›é€‰ï¼‰
```

### 4.3 å…·ä½“å˜æ›´ç‚¹æ¸…å•

| å˜æ›´ç±»å‹ | ç»„ä»¶/æ¨¡å— | å˜æ›´æè¿° | å½±å“èŒƒå›´ | é£é™©ç­‰çº§ |
|---------|---------|---------|---------|---------|
| NEW | BuySignalCalculator | æ–°å¢ä¹°å…¥ä¿¡å·è®¡ç®—å™¨ï¼Œå®ç°ç­–ç•¥1å’Œç­–ç•¥2 | å…¨æ–°æ¨¡å—ï¼Œæ— å½±å“ç°æœ‰åŠŸèƒ½ | ä½ |
| MODIFIED | ChartDataService | åœ¨get_chart_data()è¿”å›ä¸­æ–°å¢buy_signalså­—æ®µ | APIå“åº”æ‰©å±•ï¼Œå‘åå…¼å®¹ | ä¸­ |
| MODIFIED | detail.html | æ–°å¢Markersæ¸²æŸ“ã€Hover/Click Cardã€ç­›é€‰æ§ä»¶ | å‰ç«¯UIæ‰©å±•ï¼Œä¸å½±å“ç°æœ‰å›¾è¡¨ | ä½ |

### 4.4 æŠ€æœ¯å½±å“åˆ†æ

#### æ–°å¢æŠ€æœ¯æ ˆ
æ— ï¼ˆå®Œå…¨å¤ç”¨ç°æœ‰æŠ€æœ¯æ ˆï¼‰

#### æ€§èƒ½å½±å“
- **æ”¹è¿›ç‚¹**ï¼šä¹°å…¥ä¿¡å·è®¡ç®—åœ¨åç«¯å®Œæˆï¼ŒNumPyå‘é‡åŒ–è®¡ç®—æ€§èƒ½ä¼˜å¼‚ï¼ˆ<50msï¼‰
- **é£é™©ç‚¹**ï¼š
  - APIå“åº”ä½“ç§¯å¢åŠ ï¼šæ¯ä¸ªä¹°å…¥ç‚¹çº¦200-300å­—èŠ‚ï¼Œ100ä¸ªä¹°å…¥ç‚¹çº¦20-30KBï¼ˆå¯æ¥å—ï¼‰
  - å‰ç«¯æ ‡è®°æ¸²æŸ“ï¼šLightweightCharts Markers APIæ€§èƒ½ä¼˜å¼‚ï¼ˆ500ä¸ªæ ‡è®°<100msï¼‰

#### ä¾èµ–å˜æ›´
- **æ–°å¢ä¾èµ–**ï¼šæ— 
- **å‡çº§ä¾èµ–**ï¼šæ— 

### 4.5 é£é™©è¯„ä¼°

| é£é™©ç±»åˆ« | é£é™©ç­‰çº§ | è¯´æ˜ |
|---------|---------|------|
| **Core-AtomicæœåŠ¡å˜æ›´** | âš ï¸ ä¸­ | BuySignalCalculatoræ”¯æ’‘>3ä¸ªä¸šåŠ¡æµï¼Œéœ€ä¸¥æ ¼æµ‹è¯• |
| **APIå“åº”æ‰©å±•** | âš¡ ä½ | å‘åå…¼å®¹ï¼Œç°æœ‰å­—æ®µå®Œå…¨ä¸å˜ |
| **å‰ç«¯UIæ‰©å±•** | âœ… ä½ | æ–°å¢å…ƒç´ ï¼Œä¸ä¿®æ”¹ç°æœ‰å›¾è¡¨ |

**æ ¸å¿ƒä¿éšœç­–ç•¥**ï¼š
- æ‰€æœ‰Core-AtomicæœåŠ¡å¿…é¡»é€šè¿‡å¹¶å‘è®¡ç®—æµ‹è¯•ï¼ˆå¤šäº¤æ˜“å¯¹å¹¶è¡Œï¼‰
- æ•°æ®ä¸€è‡´æ€§ä¿éšœï¼šæ‰€æœ‰è¾“å…¥åºåˆ—é•¿åº¦å¿…é¡»ä¸€è‡´
- å¼‚å¸¸åœºæ™¯ä¸‹çš„é˜²å¾¡æ€§è®¾è®¡ï¼šæ˜¾å¼æŠ›å‡ºå¼‚å¸¸ï¼Œä¸é™é»˜å¤±è´¥

---

## 5. æ•°æ®æµå›¾

```mermaid
flowchart TD
    subgraph "æ•°æ®æ¥æº"
        KLine[("KLineæ•°æ®åº“")]
    end

    subgraph "ç°æœ‰è®¡ç®—å™¨ï¼ˆå¤ç”¨ï¼‰"
        EMA["EMACalculator<br/>æä¾›: EMAåºåˆ—"]
        Inertia["InertiaCalculator<br/>æä¾›: Î²åºåˆ—ã€æƒ¯æ€§mid"]
        ZScore["ZScoreCalculator<br/>æä¾›: P5åºåˆ—"]
    end

    subgraph "æ–°å¢è®¡ç®—å™¨"
        BuySignal["ğŸ†• BuySignalCalculator<br/>è®¡ç®—: ç­–ç•¥1ã€ç­–ç•¥2è§¦å‘"]
    end

    subgraph "æœåŠ¡ç¼–æ’å±‚"
        ChartService["ChartDataService<br/>ç¼–æ’: è·å–Kçº¿ â†’ è°ƒç”¨è®¡ç®—å™¨ â†’ ç»„è£…å“åº”"]
    end

    subgraph "å‰ç«¯æ¸²æŸ“å±‚"
        DetailHTML["detail.html<br/>æ¸²æŸ“: Markers + Card + ç­›é€‰"]
    end

    KLine --> EMA
    KLine --> Inertia
    KLine --> ZScore

    EMA --> BuySignal
    Inertia --> BuySignal
    ZScore --> BuySignal
    KLine --> BuySignal

    EMA --> ChartService
    Inertia --> ChartService
    ZScore --> ChartService
    BuySignal --> ChartService

    ChartService --> DetailHTML

    style BuySignal fill:#90EE90
    style ChartService fill:#FFD700
    style DetailHTML fill:#87CEEB
```

**æ•°æ®æµè¯´æ˜**ï¼š
1. **æ•°æ®è·å–é˜¶æ®µ**ï¼šChartDataServiceä»KLineæ•°æ®åº“è·å–Kçº¿æ•°æ®
2. **è®¡ç®—é˜¶æ®µ**ï¼š
   - EMACalculatorè®¡ç®—EMAåºåˆ—
   - InertiaCalculatorè®¡ç®—Î²åºåˆ—å’Œæƒ¯æ€§mid
   - ZScoreCalculatorè®¡ç®—P5åºåˆ—
   - **BuySignalCalculatoræ¥æ”¶ä¸Šè¿°åºåˆ—ï¼Œè®¡ç®—ä¹°å…¥ä¿¡å·**
3. **å“åº”ç»„è£…é˜¶æ®µ**ï¼šChartDataServiceç»„è£…å®Œæ•´çš„chartå“åº”ï¼ŒåŒ…å«buy_signalså­—æ®µ
4. **å‰ç«¯æ¸²æŸ“é˜¶æ®µ**ï¼šdetail.htmlè§£æbuy_signalsæ•°æ®ï¼Œæ¸²æŸ“Markersã€Cardã€ç­›é€‰æ§ä»¶

---

## 6. APIè®¾è®¡

### 6.1 APIå“åº”æ‰©å±•

**è·¯å¾„**: `GET /ddps-z/api/chart/`

**è¯·æ±‚å‚æ•°**ï¼ˆå®Œå…¨ä¸å˜ï¼‰:
- symbol: äº¤æ˜“å¯¹ï¼ˆå¦‚BTCUSDTï¼‰
- interval: Kçº¿å‘¨æœŸï¼ˆå¦‚4hï¼‰
- range: æ—¶é—´èŒƒå›´ï¼ˆå¦‚3mï¼‰
- market_type: å¸‚åœºç±»å‹ï¼ˆfutures/spotï¼‰

**å“åº”ç»“æ„æ‰©å±•**:
```json
{
  "success": true,
  "chart": {
    // âœ… ç°æœ‰å­—æ®µä¿æŒä¸å˜
    "candles": [...],
    "ema": [...],
    "bands": {...},
    "zscore": [...],
    "fan": {...},

    // ğŸ†• æ–°å¢ buy_signals å­—æ®µ
    "buy_signals": [
      {
        "timestamp": 1736078400000,
        "kline_index": 123,
        "strategies": [
          {
            "id": "strategy_1",
            "name": "EMAæ–œç‡æœªæ¥é¢„æµ‹",
            "triggered": true,
            "reason": "ä»·æ ¼è·Œç ´P5 ($48,234)ï¼Œä½†æœªæ¥6å‘¨æœŸEMAé¢„æµ‹ ($50,456) é«˜äºå½“å‰æ”¶ç›˜ä»·",
            "details": {
              "current_low": 48000.0,
              "p5": 48234.0,
              "future_ema": 50456.0,
              "current_close": 49876.54,
              "beta": 0.0012
            }
          },
          {
            "id": "strategy_2",
            "name": "æƒ¯æ€§ä¸‹è·Œä¸­å€¼çªç ´",
            "triggered": false
          }
        ],
        "buy_price": 49876.54
      }
    ]
  },
  "meta": {...}
}
```

---

## 7. å…³é”®æŠ€æœ¯å†³ç­–

### å†³ç­–ç‚¹1: ä¹°å…¥ä¿¡å·è®¡ç®—ä½ç½®ï¼ˆåç«¯ vs å‰ç«¯ï¼‰

- **é€‰å®šæ–¹æ¡ˆ**: åç«¯è®¡ç®—
- **å†³ç­–æ—¥æœŸ**: 2026-01-06
- **ç†ç”±**:
  - è®¡ç®—é€»è¾‘é›†ä¸­ç®¡ç†ï¼Œæ˜“äºæµ‹è¯•å’Œç»´æŠ¤
  - NumPyå‘é‡åŒ–è®¡ç®—æ€§èƒ½ä¼˜å¼‚ï¼ˆå¤„ç†5000æ ¹Kçº¿<50msï¼‰
  - å‰ç«¯åªè´Ÿè´£æ¸²æŸ“ï¼Œé€»è¾‘ç®€å•
  - å®‰å…¨æ€§é«˜ï¼ˆç­–ç•¥é€»è¾‘ä¸æš´éœ²ç»™å‰ç«¯ï¼‰
- **é£é™©ä¸ç¼“è§£æªæ–½**:
  - é£é™©ï¼šAPIå“åº”ä½“ç§¯å¢åŠ 
  - ç¼“è§£ï¼šæ¯ä¸ªä¹°å…¥ç‚¹çº¦200-300å­—èŠ‚ï¼Œå¯æ¥å—
- **åç»­å½±å“**: å‰ç«¯ä»£ç å¤æ‚åº¦å¤§å¹…é™ä½ï¼Œæ˜“äºç»´æŠ¤

### å†³ç­–ç‚¹2: ç­–ç•¥1çš„æœªæ¥EMAé¢„æµ‹æ–¹æ³•

- **é€‰å®šæ–¹æ¡ˆ**: ç®€å•çº¿æ€§å¤–æ¨
- **å†³ç­–æ—¥æœŸ**: 2026-01-06
- **å…¬å¼**: `æœªæ¥EMA = EMA[t] + (Î² Ã— 6)`
- **ç†ç”±**:
  - å®ç°æå…¶ç®€å•ï¼Œä¸€è¡Œä»£ç 
  - è®¡ç®—é€Ÿåº¦å¿«
  - æ˜“äºç†è§£å’Œè°ƒè¯•
  - ä¸ç°æœ‰æƒ¯æ€§é¢„æµ‹å…¬å¼ä¸€è‡´ï¼ˆä¿æŒæ¶æ„ä¸€è‡´æ€§ï¼‰
- **é£é™©ä¸ç¼“è§£æªæ–½**:
  - é£é™©ï¼šå‡è®¾Î²ä¿æŒæ’å®šï¼Œå¯èƒ½ä¸å¤Ÿç²¾ç¡®
  - ç¼“è§£ï¼šåŠ å¯†è´§å¸å¸‚åœºéšæœºæ€§é«˜ï¼Œå¤æ‚é¢„æµ‹ä¸ä¸€å®šæ›´å‡†ç¡®
- **åç»­å½±å“**: å¦‚éœ€ä¼˜åŒ–ï¼Œå¯åœ¨ä¸ä¿®æ”¹æ¥å£çš„æƒ…å†µä¸‹è°ƒæ•´é¢„æµ‹ç®—æ³•

### å†³ç­–ç‚¹3: å¤šç­–ç•¥å¹¶å­˜æ—¶çš„æ•°æ®ç»“æ„

- **é€‰å®šæ–¹æ¡ˆ**: ç­–ç•¥æ•°ç»„ç»“æ„
- **å†³ç­–æ—¥æœŸ**: 2026-01-06
- **ç»“æ„**: æ¯ä¸ªä¹°å…¥ç‚¹åŒ…å«strategiesæ•°ç»„ï¼Œæ¯ä¸ªç­–ç•¥æœ‰ç‹¬ç«‹çš„triggeredçŠ¶æ€
- **ç†ç”±**:
  - æ”¯æŒå¤šç­–ç•¥å¹¶å­˜ï¼Œæ‰©å±•æ€§å¼º
  - æ¯ä¸ªç­–ç•¥å¯ç‹¬ç«‹æ˜¾ç¤ºè§¦å‘çŠ¶æ€å’ŒåŸå› 
  - ä¸ºæœªæ¥ç­–ç•¥3ã€4é¢„ç•™ç©ºé—´
  - Cardä¸­å¯ä»¥åˆ—å‡ºæ‰€æœ‰è§¦å‘ç­–ç•¥
- **é£é™©ä¸ç¼“è§£æªæ–½**:
  - é£é™©ï¼šæ•°æ®ç»“æ„ç¨å¤æ‚
  - ç¼“è§£ï¼šå‰ç«¯éå†strategiesæ•°ç»„é€»è¾‘ç®€å•
- **åç»­å½±å“**: æ˜“äºæ‰©å±•æ–°ç­–ç•¥ï¼Œæ— éœ€ä¿®æ”¹æ•°æ®ç»“æ„

### å†³ç­–ç‚¹4: å†å²å›æº¯æ•°æ®èŒƒå›´

- **é€‰å®šæ–¹æ¡ˆ**: ä¸å›¾è¡¨æ•°æ®èŒƒå›´ä¸€è‡´
- **å†³ç­–æ—¥æœŸ**: 2026-01-06
- **ç†ç”±**:
  - å®ç°æœ€ç®€å•ï¼Œé›¶é¢å¤–é€»è¾‘
  - è‡ªåŠ¨æ”¯æŒæ—¶é—´èŒƒå›´é€‰æ‹©å™¨ï¼ˆ1å‘¨/1æœˆ/3æœˆç­‰ï¼‰
  - è‡ªåŠ¨æ”¯æŒåŠ¨æ€åŠ è½½ï¼ˆæ»šåŠ¨åˆ°æ›´æ—©æ—¶é—´è‡ªåŠ¨åŠ è½½ï¼‰
  - æ€§èƒ½å¯æ§ï¼ˆéšKçº¿æ•°æ®èŒƒå›´è‡ªåŠ¨é™åˆ¶ï¼‰
- **é£é™©ä¸ç¼“è§£æªæ–½**: æ— æ˜æ˜¾é£é™©
- **åç»­å½±å“**: ç”¨æˆ·å¯ä»¥é€šè¿‡æ—¶é—´èŒƒå›´é€‰æ‹©å™¨æ§åˆ¶æ•°æ®é‡

### å†³ç­–ç‚¹5: ç­›é€‰åŠŸèƒ½çš„å®ç°æ–¹å¼

- **é€‰å®šæ–¹æ¡ˆ**: å‰ç«¯ç­›é€‰
- **å†³ç­–æ—¥æœŸ**: 2026-01-06
- **ç†ç”±**:
  - å®ç°æœ€ç®€å•
  - ç­›é€‰åˆ‡æ¢æ— éœ€è¯·æ±‚åç«¯ï¼Œå“åº”å³æ—¶ï¼ˆ<10msï¼‰
  - ç”¨æˆ·ä½“éªŒæœ€ä½³ï¼ˆæ— åŠ è½½å»¶è¿Ÿï¼‰
  - APIé€»è¾‘ç®€å•ï¼ˆæ— éœ€å¤„ç†ç­›é€‰å‚æ•°ï¼‰
- **é£é™©ä¸ç¼“è§£æªæ–½**:
  - é£é™©ï¼šè¿”å›æ‰€æœ‰ç­–ç•¥æ•°æ®ï¼Œå“åº”ä½“ç§¯ç¨å¤§
  - ç¼“è§£ï¼š100ä¸ªä¹°å…¥ç‚¹çº¦20-30KBï¼Œå¯æ¥å—
- **åç»­å½±å“**: ç­›é€‰çŠ¶æ€æŒä¹…åŒ–åˆ°localStorageï¼Œåˆ·æ–°é¡µé¢åä¿æŒ

---

## 8. æ‰©å±•æ€§è€ƒè™‘

### 8.1 æœªæ¥ç­–ç•¥æ‰©å±•

**é¢„ç•™è®¾è®¡**:
- ç­–ç•¥æ•°ç»„ç»“æ„æ”¯æŒåŠ¨æ€æ‰©å±•ï¼ˆç­–ç•¥3ã€4ã€5...ï¼‰
- æ¯ä¸ªç­–ç•¥æœ‰ç‹¬ç«‹çš„idã€nameã€triggeredã€reasonã€detailså­—æ®µ
- ç­›é€‰æ§ä»¶å¯åŠ¨æ€ç”ŸæˆæŒ‰é’®ï¼ˆåŸºäºstrategiesæ•°ç»„ï¼‰

**æ‰©å±•ç¤ºä¾‹**:
```python
# æœªæ¥ç­–ç•¥3ï¼šMACDé‡‘å‰ä¹°å…¥
{
    'id': 'strategy_3',
    'name': 'MACDé‡‘å‰ä¹°å…¥',
    'triggered': True,
    'reason': 'MACD DIFçº¿ä¸Šç©¿DEAçº¿ï¼Œå½¢æˆé‡‘å‰',
    'details': {
        'dif': 120.5,
        'dea': 118.2,
        'histogram': 2.3
    }
}
```

### 8.2 å–å‡ºç­–ç•¥æ‰©å±•

**é¢„ç•™è®¾è®¡**:
- æ•°æ®ç»“æ„å¯æ‰©å±•ä¸º`buy_signals`å’Œ`sell_signals`ä¸¤ä¸ªæ•°ç»„
- Markeré¢œè‰²åŒºåˆ†ï¼ˆä¹°å…¥ç»¿è‰²ã€å–å‡ºçº¢è‰²ï¼‰
- Cardæ ·å¼åŒºåˆ†ï¼ˆä¹°å…¥ç»¿è‰²è¾¹æ¡†ã€å–å‡ºçº¢è‰²è¾¹æ¡†ï¼‰

### 8.3 æ€§èƒ½ä¼˜åŒ–é¢„ç•™

**åç»­ä¼˜åŒ–ç‚¹**:
- ä¹°å…¥ä¿¡å·ç¼“å­˜æœºåˆ¶ï¼ˆRedisï¼‰
- å‰ç«¯è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§é‡æ ‡è®°æ—¶ï¼‰
- WebWorkerå¼‚æ­¥è®¡ç®—ï¼ˆå‰ç«¯ç­›é€‰ï¼‰

---

## 9. éåŠŸèƒ½éœ€æ±‚

### 9.1 æ€§èƒ½è¦æ±‚

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | éªŒè¯æ–¹æ³• |
|------|--------|----------|
| ä¹°å…¥ä¿¡å·è®¡ç®—å»¶è¿Ÿ | < 50msï¼ˆå¢é‡ï¼‰ | å•å…ƒæµ‹è¯• + æ€§èƒ½åˆ†æ |
| æ ‡è®°æ¸²æŸ“æ€§èƒ½ | 500ä¸ªæ ‡è®° < 100ms | å‰ç«¯æ€§èƒ½æµ‹è¯• |
| Cardæ˜¾ç¤ºå»¶è¿Ÿ | < 10ms | å‰ç«¯æ€§èƒ½æµ‹è¯• |
| APIå“åº”æ—¶é—´å¢é‡ | < 50ms | APIæ€§èƒ½æµ‹è¯• |

### 9.2 å®‰å…¨è¦æ±‚

- âœ… ç­–ç•¥é€»è¾‘åœ¨åç«¯ï¼Œä¸æš´éœ²ç»™å‰ç«¯
- âœ… APIå‚æ•°éªŒè¯ï¼ˆsymbolã€intervalã€market_typeï¼‰
- âœ… å¼‚å¸¸å¤„ç†å®Œæ•´ï¼ˆæ•°æ®ä¸è¶³ã€è®¡ç®—å¤±è´¥ç­‰ï¼‰

### 9.3 å¯é æ€§è¦æ±‚

- âœ… æ•°æ®ä¸è¶³æ—¶ä¼˜é›…é™çº§ï¼ˆè¿”å›ç©ºæ•°ç»„ï¼Œä¸æŠ›å‡ºå¼‚å¸¸ï¼‰
- âœ… è®¡ç®—å¼‚å¸¸æ—¶è®°å½•æ—¥å¿—ï¼ˆlogger.exceptionï¼‰
- âœ… å‰ç«¯é”™è¯¯å¤„ç†ï¼ˆæ•°æ®æ ¼å¼å¼‚å¸¸æ—¶ä¸æ¸²æŸ“æ ‡è®°ï¼‰

---

## 10. æ–‡ä»¶å˜æ›´æ¸…å•

| æ–‡ä»¶ | æ“ä½œ | å˜æ›´å†…å®¹ |
|------|------|----------|
| `ddps_z/calculators/buy_signal_calculator.py` | ğŸ†• æ–°å»º | ä¹°å…¥ä¿¡å·è®¡ç®—å™¨å®ç° |
| `ddps_z/services/chart_data_service.py` | ğŸ“ æ‰©å±• | `get_chart_data()` è¿”å›æ–°å¢ `buy_signals` å­—æ®µ |
| `ddps_z/templates/ddps_z/detail.html` | ğŸ“ æ‰©å±• | æ–°å¢Markersæ¸²æŸ“ã€Cardæ˜¾ç¤ºã€ç­›é€‰æ§ä»¶ |
| `ddps_z/calculators/__init__.py` | ğŸ“ æ‰©å±• | å¯¼å‡º `BuySignalCalculator` |

---

## 11. æµ‹è¯•ç­–ç•¥

### 11.1 å•å…ƒæµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ |
|----------|----------|
| `test_buy_signal_calculator.py` | ç­–ç•¥1å’Œç­–ç•¥2çš„è§¦å‘é€»è¾‘ã€è¾¹ç•Œæ¡ä»¶ã€å¼‚å¸¸å¤„ç† |

**æµ‹è¯•ç”¨ä¾‹**:
- [ ] ç­–ç•¥1æ­£å¸¸è§¦å‘ï¼šlow < P5 ä¸” æœªæ¥EMA > close
- [ ] ç­–ç•¥1ä¸è§¦å‘ï¼šlow >= P5
- [ ] ç­–ç•¥1ä¸è§¦å‘ï¼šæœªæ¥EMA <= close
- [ ] ç­–ç•¥2æ­£å¸¸è§¦å‘ï¼šÎ² < 0 ä¸” æƒ¯æ€§mid < P5 ä¸” low < ä¸­å€¼çº¿
- [ ] ç­–ç•¥2ä¸è§¦å‘ï¼šÎ² >= 0ï¼ˆéä¸‹è·Œè¶‹åŠ¿ï¼‰
- [ ] ç­–ç•¥2ä¸è§¦å‘ï¼šæƒ¯æ€§mid >= P5
- [ ] ç­–ç•¥2ä¸è§¦å‘ï¼šlow >= ä¸­å€¼çº¿
- [ ] æ•°æ®ä¸è¶³æ—¶æŠ›å‡ºERR_DATA_INSUFFICIENT
- [ ] Î²åºåˆ—åŒ…å«NaNæ—¶æŠ›å‡ºERR_INVALID_BETA

### 11.2 é›†æˆæµ‹è¯•

| æµ‹è¯•åœºæ™¯ | éªŒè¯ç‚¹ |
|----------|--------|
| ç°æœ‰åŠŸèƒ½å›å½’ | EMAã€Z-Scoreã€æ¦‚ç‡å¸¦ã€æƒ¯æ€§æ‰‡é¢ä¸å—å½±å“ |
| æ–°å¢å­—æ®µéªŒè¯ | APIå“åº”åŒ…å« `buy_signals` |
| å‰ç«¯æ¸²æŸ“ | Markersæ­£ç¡®æ¸²æŸ“åœ¨Kçº¿å›¾ä¸Š |

---

## 12. å›æ»šæ–¹æ¡ˆ

ç”±äºé‡‡ç”¨å¢é‡æ‰©å±•ç­–ç•¥ï¼Œå›æ»šæ–¹æ¡ˆç®€å•ï¼š

1. **åç«¯**: æ³¨é‡Šæ‰ `chart_data_service.py` ä¸­çš„ä¹°å…¥ä¿¡å·è®¡ç®—è°ƒç”¨
2. **å‰ç«¯**: åˆ é™¤Markersæ¸²æŸ“å’ŒCardç›¸å…³ä»£ç 
3. **API**: å“åº”è‡ªåŠ¨ä¸åŒ…å« `buy_signals` å­—æ®µ

æ— éœ€ä¿®æ”¹æ•°æ®åº“ï¼Œæ— éœ€å›æ»šè¿ç§»ã€‚

---

## 13. Gate 4 æ£€æŸ¥ç»“æœ

### æ£€æŸ¥æ¸…å•

#### æ¶æ„è®¾è®¡å®Œæ•´æ€§
- [x] æ¶æ„å›¾æ¸…æ™°è¡¨è¾¾äº†ç³»ç»Ÿç»“æ„
- [x] æ¯ä¸ªç»„ä»¶çš„èŒè´£æ˜ç¡®ä¸”æœ‰éœ€æ±‚æ˜ å°„
- [x] æ‰€æœ‰å…³é”®æŠ€æœ¯å†³ç­–å·²å®Œæˆå¹¶è®°å½•
- [x] æ¶æ„è®¾è®¡ç¬¦åˆPRDè¦æ±‚
- [x] éåŠŸèƒ½éœ€æ±‚ï¼ˆæ€§èƒ½ã€å®‰å…¨ç­‰ï¼‰å·²è€ƒè™‘

#### åŸå­æœåŠ¡å¥‘çº¦å®Œæ•´æ€§ â­
- [x] æ˜¯å¦å·²è¯†åˆ«æ‰€æœ‰åŸå­çº§æœåŠ¡ï¼ˆBuySignalCalculatorï¼‰
- [x] æ˜¯å¦å·²åŒºåˆ†ç¼–æ’çº§æœåŠ¡ï¼ˆChartDataServiceï¼‰
- [x] æ¯ä¸ªåŸå­æœåŠ¡æ˜¯å¦åŒ…å«å”¯ä¸€èŒè´£æè¿°
- [x] æ¯ä¸ªåŸå­æœåŠ¡æ˜¯å¦åŒ…å«å®Œæ•´çš„Inputå®šä¹‰
- [x] æ¯ä¸ªåŸå­æœåŠ¡æ˜¯å¦åŒ…å«å®Œæ•´çš„Outputå®šä¹‰
- [x] æ¯ä¸ªåŸå­æœåŠ¡æ˜¯å¦åŒ…å«å¼‚å¸¸è¾¹ç•Œå®šä¹‰
- [x] æ¯ä¸ªåŸå­æœåŠ¡æ˜¯å¦åŒ…å«ç¡®å®šæ€§æµ‹è¯•å»ºè®®
- [x] Core-AtomicæœåŠ¡ï¼ˆæ”¯æ’‘>3ä¸ªä¸šåŠ¡æµï¼‰æ˜¯å¦å·²ç‰¹åˆ«æ ‡è®°
- [x] Core-AtomicæœåŠ¡æ˜¯å¦å·²æå‡æµ‹è¯•ä¼˜å…ˆçº§

#### å˜æ›´ç‚¹è¯´æ˜å®Œæ•´æ€§ â­
- [x] æ˜¯å¦æœ‰å…³é”®æ¦‚è¿°è¯´æ˜ä¸ºä»€ä¹ˆéœ€è¦å˜æ›´
- [x] æ˜¯å¦æœ‰Mermaidæ¶æ„å˜æ›´å‰åå¯¹æ¯”å›¾
- [x] æ˜¯å¦æœ‰NEW/MODIFIEDå˜æ›´ç‚¹æ¸…å•è¡¨æ ¼
- [x] æ˜¯å¦æœ‰æŠ€æœ¯å½±å“åˆ†æ(æŠ€æœ¯æ ˆã€æ€§èƒ½ã€ä¾èµ–)
- [x] æ˜¯å¦æœ‰é£é™©ç­‰çº§è¯„ä¼°(é«˜/ä¸­/ä½ï¼ŒåŒ…å«Core-AtomicæœåŠ¡è¯„ä¼°)

**Gate 4 æ£€æŸ¥ç»“æœ**: âœ… **é€šè¿‡** - å¯ä»¥è¿›å…¥P5é˜¶æ®µï¼ˆå¼€å‘è§„åˆ’ï¼‰

---

## 14. ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… **P3æŠ€æœ¯è°ƒç ”å·²å®Œæˆ**
2. âœ… **P4æ¶æ„è®¾è®¡å·²å®Œæˆ**
3. â­ï¸ **è¿›å…¥P5-P6é˜¶æ®µ**ï¼šä½¿ç”¨ `powerby-engineer` skill è¿›è¡Œå¼€å‘è§„åˆ’å’Œå®ç°

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**ç”Ÿæˆæ—¶é—´**: 2026-01-06
**çŠ¶æ€**: âœ… å·²å®Œæˆï¼ˆGate 4é€šè¿‡ï¼‰
