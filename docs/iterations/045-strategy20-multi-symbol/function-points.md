# 策略20 功能点清单

## 概述

本文档列出策略20（多交易对共享资金池）的所有功能点，按优先级分类。

---

## P0 核心功能（MVP）

### 模块1：多交易对数据管理

| ID | 功能点 | 描述 | 验收标准 |
|----|--------|------|----------|
| F-001 | 多交易对K线加载 | 加载多个交易对的K线数据 | 支持同时加载4个交易对数据 |
| F-002 | 时间戳对齐 | 按时间戳对齐处理K线 | 同一时间戳的K线同步处理 |
| F-003 | 交易对配置 | 默认配置ETH/BTC/HYPE/BNB | 支持命令行参数覆盖 |

### 模块2：全局资金池管理

| ID | 功能点 | 描述 | 验收标准 |
|----|--------|------|----------|
| F-004 | 共享资金池 | 所有交易对共用资金池 | available_cash全局统一 |
| F-005 | 资金冻结/解冻 | 挂单冻结资金，成交/取消解冻 | 资金变动正确记录 |
| F-006 | 持仓价值跟踪 | 跟踪所有持仓的当前价值 | 浮动盈亏实时计算 |

### 模块3：全局持仓限制

| ID | 功能点 | 描述 | 验收标准 |
|----|--------|------|----------|
| F-007 | 全局持仓计数 | 跟踪所有交易对的持仓总数 | 持仓数正确统计 |
| F-008 | 持仓上限控制 | 达到max_positions停止新挂单 | 不超过限制 |
| F-009 | 动态仓位计算 | 单笔=available/(max-holdings) | 金额正确计算 |

### 模块4：独立交易对逻辑

| ID | 功能点 | 描述 | 验收标准 |
|----|--------|------|----------|
| F-010 | 指标独立计算 | 每个交易对独立计算P5/EMA25等 | 指标值正确 |
| F-011 | 买入条件复用 | 复用策略16买入条件 | 与策略16一致 |
| F-012 | 卖出挂单复用 | 复用策略16动态挂单止盈 | 与策略16一致 |
| F-013 | bear_warning跳过 | 复用策略16的周期跳过逻辑 | 正确跳过 |

### 模块5：统计输出

| ID | 功能点 | 描述 | 验收标准 |
|----|--------|------|----------|
| F-014 | 分交易对统计 | 每个交易对独立统计 | 订单数/胜率/盈亏正确 |
| F-015 | 全局合并统计 | 合并汇总所有交易对 | 总收益/APR/APY正确 |
| F-016 | 最大回撤计算 | 基于全局资金曲线 | 计算正确 |
| F-017 | 订单列表输出 | 输出所有订单详情 | 包含symbol字段 |

### 模块6：回测集成

| ID | 功能点 | 描述 | 验收标准 |
|----|--------|------|----------|
| F-018 | 策略工厂注册 | 注册到strategy_factory | 可通过名称创建 |
| F-019 | CLI命令支持 | run_strategy_backtest集成 | 命令正常执行 |
| F-020 | symbols参数 | 支持--symbols参数 | 可指定交易对 |

---

## P1 延期功能

| ID | 功能点 | 描述 | 延期原因 |
|----|--------|------|----------|
| F-P1-001 | 动态交易对配置 | 运行时指定任意交易对 | MVP固定4个交易对 |
| F-P1-002 | 信号优先级机制 | 多信号时按优先级分配 | MVP先到先得 |
| F-P1-003 | 单交易对持仓限制 | 可配置单交易对最大持仓 | MVP仅全局限制 |
| F-P1-004 | CSV批量导出 | 导出分交易对CSV报告 | MVP仅控制台输出 |

---

## 功能点统计

| 优先级 | 数量 | 状态 |
|--------|------|------|
| P0 | 20 | 待开发 |
| P1 | 4 | 延期 |
| **总计** | **24** | - |

---

## 依赖关系

```
F-001 (K线加载)
    ↓
F-002 (时间戳对齐)
    ↓
F-010~F-013 (独立交易对逻辑)
    ↓
F-004~F-006 (资金池管理) ←→ F-007~F-009 (持仓限制)
    ↓
F-014~F-017 (统计输出)
    ↓
F-018~F-020 (回测集成)
```

---

## 验收检查清单

### MVP完成标准

- [ ] 所有P0功能点实现
- [ ] 单元测试覆盖核心逻辑
- [ ] 4交易对回测正常执行
- [ ] 统计结果正确
- [ ] 与现有系统兼容
