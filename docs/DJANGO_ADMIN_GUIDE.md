# Django Admin 管理后台使用指南

## 访问 Admin 后台

### 1. 创建超级用户

首次使用需要创建管理员账号：

```bash
python manage.py createsuperuser
```

按提示输入：
- 用户名（Username）
- 邮箱（Email，可选）
- 密码（Password）

### 2. 启动开发服务器

```bash
python manage.py runserver
```

### 3. 访问管理后台

在浏览器中打开：`http://127.0.0.1:8000/admin/`

使用创建的超级用户账号登录。

---

## 管理功能

### 📊 交易所管理 (Exchanges)

**功能**：
- 查看所有交易所
- 启用/禁用交易所
- 查看每个交易所的公告数量
- 快速跳转到交易所的公告列表

**列表字段**：
- 名称
- 代码
- 状态（✓ 已启用 / ✗ 已禁用）
- 公告数量（可点击查看）
- 公告页面链接
- 创建时间

**过滤器**：
- 启用状态
- 创建时间

**搜索**：支持按名称、代码搜索

---

### 📰 公告管理 (Announcements)

**功能**：
- 查看所有公告
- 按交易所、分类、时间过滤
- 搜索公告内容
- 标记为已处理/未处理
- 查看识别出的新币数量
- 查看原文链接

**列表字段**：
- 标题（缩略60字符）
- 交易所
- 分类
- 发布时间
- 处理状态（✓ 已处理 / ⏳ 待处理）
- 识别新币数量（可点击查看）
- 原文链接

**过滤器**：
- 交易所
- 分类
- 处理状态
- 发布时间

**搜索**：支持按标题、描述、news_id 搜索

**日期层级**：按发布时间的年/月/日浏览

**批量操作**：
- 标记为已处理
- 标记为未处理

---

### 🪙 新币上线管理 (Listings)

**功能**：
- 查看所有识别出的新币
- 按类型、状态、交易所过滤
- 搜索币种
- 确认上线
- 查看通知记录

**列表字段**：
- 币种符号
- 币种名称
- 类型（现货/合约）
- 交易所
- 置信度（颜色区分：绿≥90%, 橙≥70%, 红<70%）
- 状态（✓ 已确认 / ? 待审核 / ✗ 已拒绝）
- 识别时间
- 通知次数（可点击查看）

**过滤器**：
- 上线类型（现货/合约）
- 状态
- 交易所
- 识别时间

**搜索**：支持按币种符号、名称搜索

**日期层级**：按识别时间的年/月/日浏览

**批量操作**：
- 确认上线
- 标记为待审核

---

### 📨 通知记录管理 (Notification Records)

**功能**：
- 查看所有推送通知记录
- 按渠道、状态过滤
- 查看失败原因
- 追踪重试次数

**列表字段**：
- 新币信息（可点击查看详情）
- 推送渠道
- 状态（绿=成功 / 红=失败 / 橙=待发送）
- 重试次数
- 发送时间
- 创建时间

**过滤器**：
- 推送渠道
- 状态
- 发送时间
- 创建时间

**搜索**：支持按币种符号、错误信息搜索

**日期层级**：按创建时间的年/月/日浏览

---

## 常见操作

### 查看某个交易所的所有公告

1. 进入 **交易所管理**
2. 点击交易所的 **公告数量** 链接
3. 自动跳转到该交易所的公告列表

### 查看某条公告识别出的新币

1. 进入 **公告管理**
2. 点击公告的 **识别新币** 数量链接
3. 自动跳转到该公告识别出的新币列表

### 批量确认新币上线

1. 进入 **新币上线管理**
2. 勾选需要确认的新币
3. 在"操作"下拉菜单中选择 **确认上线**
4. 点击"执行"按钮

### 查看新币的推送记录

1. 进入 **新币上线管理**
2. 点击新币的 **通知次数** 链接
3. 自动跳转到该新币的推送记录列表

### 批量标记公告为已处理

1. 进入 **公告管理**
2. 勾选需要标记的公告
3. 在"操作"下拉菜单中选择 **标记为已处理**
4. 点击"执行"按钮

---

## 提示

### 颜色说明

**置信度**：
- 🟢 绿色：≥90% - 高置信度
- 🟠 橙色：70-89% - 中等置信度
- 🔴 红色：<70% - 低置信度

**状态**：
- 🟢 绿色：已确认/成功
- 🟠 橙色：待处理/待审核
- 🔴 红色：已禁用/失败/已拒绝

### 字段说明

**只读字段**：
- `news_id`（公告）
- `identified_at`（新币）
- `created_at`（创建时间）
- `updated_at`（更新时间）

这些字段由系统自动生成，不可编辑。

### 数据关系

```
Exchange (交易所)
    └── Announcement (公告)
            └── Listing (新币上线)
                    └── NotificationRecord (通知记录)
```

点击关联字段可在不同模型间快速跳转。

---

## 高级功能

### 自定义管理后台标题

编辑 `listing_monitor_project/urls.py`：

```python
from django.contrib import admin

admin.site.site_header = "新币上线监控系统"
admin.site.site_title = "监控管理"
admin.site.index_title = "欢迎使用监控管理后台"
```

### 修改列表每页显示数量

编辑 `monitor/admin.py`，在对应的 Admin 类中添加：

```python
class AnnouncementAdmin(admin.ModelAdmin):
    list_per_page = 50  # 默认100
```

---

## 安全建议

1. **生产环境**：使用强密码创建超级用户
2. **限制访问**：配置防火墙仅允许特定IP访问 admin
3. **HTTPS**：生产环境必须使用 HTTPS
4. **日志审计**：定期检查 admin 操作日志

---

## 故障排查

### 无法访问 admin

1. 检查服务器是否运行：
```bash
python manage.py runserver
```

2. 确认 URL 正确：`http://127.0.0.1:8000/admin/`

3. 检查 `INSTALLED_APPS` 中是否包含：
```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'monitor',
]
```

### 忘记密码

重置超级用户密码：
```bash
python manage.py changepassword <username>
```

### 样式丢失

收集静态文件：
```bash
python manage.py collectstatic
```
