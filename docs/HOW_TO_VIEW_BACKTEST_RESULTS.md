# å¦‚ä½•æŸ¥çœ‹å›æµ‹ç»“æœ - å®Œæ•´æŒ‡å—

## ğŸ“Š ä¸‰ç§æŸ¥çœ‹æ–¹å¼å¯¹æ¯”

| æ–¹å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|---------|------|------|
| **Webæ’­æ”¾å™¨** | å¯è§†åŒ–åˆ†æã€æ¼”ç¤º | ç›´è§‚ã€äº¤äº’å¼ã€åŠ¨ç”»æ’­æ”¾ | éœ€è¦å¯åŠ¨æœåŠ¡ |
| **å‘½ä»¤è¡ŒæŸ¥è¯¢** | å¿«é€ŸæŸ¥çœ‹ã€è„šæœ¬ä½¿ç”¨ | å¿«é€Ÿã€çµæ´»ã€å¯ç¼–ç¨‹ | ä¸å¤Ÿç›´è§‚ |
| **ç”ŸæˆæŠ¥å‘Š** | æ·±åº¦åˆ†æã€å­˜æ¡£ | å®Œæ•´ã€ä¸“ä¸šã€å¯åˆ†äº« | ç”Ÿæˆæ—¶é—´è¾ƒé•¿ |

---

## æ–¹å¼1ï¼šWebå¯è§†åŒ–æ’­æ”¾å™¨ï¼ˆæ¨èï¼‰â­â­â­â­â­

### 1.1 å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨DjangoæœåŠ¡ï¼ˆå¦‚æœè¿˜æ²¡å¯åŠ¨ï¼‰
python manage.py runserver 8001
```

### 1.2 è®¿é—®æ’­æ”¾å™¨

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š**http://127.0.0.1:8001/backtest/player/**

### 1.3 ä½¿ç”¨æ­¥éª¤

1. **é€‰æ‹©å›æµ‹è®°å½•**
   - åœ¨é¡¶éƒ¨ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ä¸€ä¸ªå›æµ‹è®°å½•
   - æ˜¾ç¤ºç­–ç•¥åç§°ã€äº¤æ˜“å¯¹ã€æ”¶ç›Šç‡ç­‰åŸºæœ¬ä¿¡æ¯

2. **æŸ¥çœ‹æ ¸å¿ƒæŒ‡æ ‡**
   - é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºå…³é”®æŒ‡æ ‡å¡ç‰‡
   - åŒ…æ‹¬ï¼šæ”¶ç›Šç‡ã€æœ€å¤§å›æ’¤ã€èƒœç‡ã€äº¤æ˜“æ¬¡æ•°ç­‰

3. **è§‚çœ‹å›æµ‹æ’­æ”¾**
   - ç‚¹å‡»"æ’­æ”¾"æŒ‰é’®
   - ç³»ç»Ÿä¼šé€Kçº¿æ’­æ”¾æ•´ä¸ªå›æµ‹è¿‡ç¨‹
   - å®æ—¶æ˜¾ç¤ºï¼š
     - Kçº¿å›¾å’Œä»·æ ¼èµ°åŠ¿
     - ä¹°å…¥/å–å‡ºä¿¡å·
     - æŒä»“æƒ…å†µ
     - è´¦æˆ·ä»·å€¼å˜åŒ–
     - ç›ˆäºæƒ…å†µ

4. **äº¤äº’åŠŸèƒ½**
   - â¯ï¸ æ’­æ”¾/æš‚åœ
   - â© å¿«è¿›ï¼ˆè°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼‰
   - ğŸ“Š åˆ‡æ¢å›¾è¡¨è§†å›¾
   - ğŸ” ç¼©æ”¾å’Œæ‹–åŠ¨

### 1.4 æ’­æ”¾å™¨ç•Œé¢è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Grid V3 - ETHUSDT 4h                         [é€‰æ‹©å™¨]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ˆ æ”¶ç›Šç‡: +0.32%   ğŸ’° æœ€ç»ˆä»·å€¼: $10,032   ğŸ“Š äº¤æ˜“: 40  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚              [Kçº¿å›¾ + äº¤æ˜“ä¿¡å·]                           â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ·ï¸ æŒä»“åˆ—è¡¨         ğŸ’¼ è´¦æˆ·ä»·å€¼æ›²çº¿                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â®ï¸ â¯ï¸ â­ï¸   è¿›åº¦æ¡: â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â—‹â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 60%          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ–¹å¼2ï¼šå‘½ä»¤è¡ŒæŸ¥è¯¢ï¼ˆå¿«é€ŸæŸ¥çœ‹ï¼‰

### 2.1 æŸ¥çœ‹æœ€æ–°å›æµ‹ç»“æœ

```bash
python manage.py shell -c "
from backtest.models import BacktestResult

result = BacktestResult.objects.latest('created_at')

print(f'ç­–ç•¥: {result.name}')
print(f'æ”¶ç›Šç‡: {float(result.total_return)*100:.2f}%')
print(f'æœ€å¤§å›æ’¤: {float(result.max_drawdown)*100:.2f}%')
print(f'å¤æ™®æ¯”ç‡: {float(result.sharpe_ratio):.2f}' if result.sharpe_ratio else 'N/A')
print(f'äº¤æ˜“æ¬¡æ•°: {result.total_trades}')
print(f'èƒœç‡: {float(result.win_rate):.2f}%')
"
```

### 2.2 åˆ—å‡ºæ‰€æœ‰å›æµ‹ç»“æœ

```bash
python manage.py shell -c "
from backtest.models import BacktestResult

results = BacktestResult.objects.all().order_by('-created_at')

for r in results:
    print(f'{r.id}. {r.name} - æ”¶ç›Šç‡: {float(r.total_return)*100:.2f}%')
"
```

### 2.3 æŸ¥çœ‹ç‰¹å®šIDçš„å›æµ‹è¯¦æƒ…

```bash
python manage.py shell -c "
from backtest.models import BacktestResult
import json

result = BacktestResult.objects.get(id=2)  # ä¿®æ”¹ID

print('='*80)
print(f'å›æµ‹ID: {result.id}')
print(f'ç­–ç•¥: {result.name}')
print('='*80)

# æ ¸å¿ƒæŒ‡æ ‡
print('\nã€æ ¸å¿ƒæŒ‡æ ‡ã€‘')
print(f'  æ€»æ”¶ç›Šç‡: {float(result.total_return)*100:.2f}%')
print(f'  å¹´åŒ–æ”¶ç›Šç‡: {float(result.annual_return)*100:.2f}%' if result.annual_return else '  å¹´åŒ–æ”¶ç›Šç‡: N/A')
print(f'  æœ€å¤§å›æ’¤: {float(result.max_drawdown)*100:.2f}%')
print(f'  å¤æ™®æ¯”ç‡: {float(result.sharpe_ratio):.2f}' if result.sharpe_ratio else '  å¤æ™®æ¯”ç‡: N/A')
print(f'  ç´¢æè¯ºæ¯”ç‡: {float(result.sortino_ratio):.2f}' if result.sortino_ratio else '  ç´¢æè¯ºæ¯”ç‡: N/A')
print(f'  å¡ç›æ¯”ç‡: {float(result.calmar_ratio):.2f}' if result.calmar_ratio else '  å¡ç›æ¯”ç‡: N/A')

# äº¤æ˜“ç»Ÿè®¡
print('\nã€äº¤æ˜“ç»Ÿè®¡ã€‘')
print(f'  æ€»äº¤æ˜“æ¬¡æ•°: {result.total_trades}')
print(f'  ç›ˆåˆ©äº¤æ˜“: {result.profitable_trades}')
print(f'  äºæŸäº¤æ˜“: {result.losing_trades}')
print(f'  èƒœç‡: {float(result.win_rate):.2f}%')
print(f'  ç›ˆäºæ¯”: {float(result.profit_factor):.2f}' if result.profit_factor else '  ç›ˆäºæ¯”: N/A')

# æŸ¥çœ‹å‰5ç¬”äº¤æ˜“
if result.trades_detail:
    print('\nã€å‰5ç¬”äº¤æ˜“ã€‘')
    trades = result.trades_detail[:5]
    for i, trade in enumerate(trades, 1):
        print(f'  {i}. ç›ˆäº: {trade.get(\"PnL\", \"N/A\")}')
"
```

### 2.4 æ¯”è¾ƒå¤šä¸ªå›æµ‹ç»“æœ

```bash
python manage.py shell -c "
from backtest.models import BacktestResult

results = BacktestResult.objects.all().order_by('-total_return')[:5]

print('å›æµ‹ç»“æœæ’å (æŒ‰æ”¶ç›Šç‡)')
print('-'*80)
for i, r in enumerate(results, 1):
    print(f'{i}. {r.name:40} {float(r.total_return)*100:>6.2f}%')
"
```

---

## æ–¹å¼3ï¼šç”Ÿæˆä¸“ä¸šåˆ†ææŠ¥å‘Š

### 3.1 ç”Ÿæˆç»¼åˆæŠ¥å‘Šï¼ˆæ¨èï¼‰

```bash
# ç”Ÿæˆæœ€æ–°10ä¸ªå›æµ‹çš„ç»¼åˆæŠ¥å‘Š
python manage.py generate_report --latest 10
```

**ç”Ÿæˆçš„æ–‡ä»¶**ï¼š
- `backtest_reports/backtest_report_YYYYMMDD_HHMMSS.csv` - æ±‡æ€»è¡¨
- `backtest_reports/backtest_report_YYYYMMDD_HHMMSS.md` - MarkdownæŠ¥å‘Š
- `backtest_reports/backtest_report_YYYYMMDD_HHMMSS_equity.png` - æƒç›Šæ›²çº¿å›¾
- `backtest_reports/backtest_report_YYYYMMDD_HHMMSS_returns.png` - æ”¶ç›Šåˆ†å¸ƒå›¾
- `backtest_reports/backtest_report_YYYYMMDD_HHMMSS_drawdown_best.png` - æœ€ä½³ç­–ç•¥å›æ’¤å›¾

### 3.2 ç”Ÿæˆç‰¹å®šå›æµ‹çš„æŠ¥å‘Š

```bash
# æ ¹æ®IDç”ŸæˆæŠ¥å‘Šï¼ˆå¤šä¸ªIDç”¨é€—å·åˆ†éš”ï¼‰
python manage.py generate_report --ids 1,2,3
```

### 3.3 ç­›é€‰æ¡ä»¶ç”ŸæˆæŠ¥å‘Š

```bash
# åªçœ‹ETHUSDTçš„å›æµ‹
python manage.py generate_report --symbol ETHUSDT --latest 5

# åªçœ‹4hå‘¨æœŸçš„å›æµ‹
python manage.py generate_report --interval 4h --latest 5

# ç»„åˆæ¡ä»¶
python manage.py generate_report --symbol ETHUSDT --interval 4h --latest 10
```

### 3.4 æŠ¥å‘Šå†…å®¹ç¤ºä¾‹

ç”Ÿæˆçš„MarkdownæŠ¥å‘ŠåŒ…å«ï¼š

```markdown
# å›æµ‹åˆ†ææŠ¥å‘Š

## å›æµ‹ç»“æœæ±‡æ€»

| ID | ç­–ç•¥ | äº¤æ˜“å¯¹ | æ”¶ç›Šç‡ | å¤æ™®æ¯”ç‡ | æœ€å¤§å›æ’¤ | èƒœç‡ | äº¤æ˜“æ¬¡æ•° |
|----|------|--------|--------|---------|---------|------|---------|
| 2  | Grid V3 | ETHUSDT 4h | 0.32% | N/A | 0.00% | 60.00% | 40 |

## ç­–ç•¥åˆ†æ

### æœ€ä½³ç­–ç•¥: Grid V3 - ETHUSDT 4h
- æ”¶ç›Šç‡: 0.32%
- é£é™©æ§åˆ¶: ä¼˜ç§€ï¼ˆæœ€å¤§å›æ’¤0.00%ï¼‰
- äº¤æ˜“æ•ˆç‡: è‰¯å¥½ï¼ˆèƒœç‡60%ï¼‰

## å›¾è¡¨

[æƒç›Šæ›²çº¿å›¾]
[æ”¶ç›Šåˆ†å¸ƒå›¾]
[å›æ’¤åˆ†æå›¾]
```

---

## å¿«é€Ÿå‚è€ƒå‘½ä»¤

### æ—¥å¸¸ä½¿ç”¨å‘½ä»¤

```bash
# 1. æŸ¥çœ‹æœ€æ–°å›æµ‹ç»“æœæ‘˜è¦
python manage.py shell -c "from backtest.models import BacktestResult; r=BacktestResult.objects.latest('created_at'); print(f'{r.name}: {float(r.total_return)*100:.2f}%')"

# 2. åˆ—å‡ºæ‰€æœ‰å›æµ‹ï¼ˆç®€æ´ç‰ˆï¼‰
python manage.py shell -c "from backtest.models import BacktestResult; [print(f'{r.id}. {r.name} - {float(r.total_return)*100:.2f}%') for r in BacktestResult.objects.all().order_by('-created_at')]"

# 3. ç”Ÿæˆæœ€æ–°å›æµ‹çš„æŠ¥å‘Š
python manage.py generate_report --latest 1

# 4. å¯åŠ¨Webæ’­æ”¾å™¨
python manage.py runserver 8001
# ç„¶åè®¿é—®: http://127.0.0.1:8001/backtest/player/
```

---

## å½“å‰ç³»ç»ŸçŠ¶æ€

### ç°æœ‰å›æµ‹è®°å½•

è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š
```bash
python manage.py shell -c "from backtest.models import BacktestResult; print(f'å…±æœ‰ {BacktestResult.objects.count()} æ¡å›æµ‹è®°å½•')"
```

ä½ å½“å‰æœ‰ **2æ¡** Grid V3å›æµ‹è®°å½•ï¼š

| ID | ç­–ç•¥ | æ”¶ç›Šç‡ | äº¤æ˜“æ¬¡æ•° | èƒœç‡ |
|----|------|--------|---------|------|
| 2  | Grid V3 - ETHUSDT 4h | +0.32% | 40 | 60% |
| 1  | Grid V3 - ETHUSDT 4h | +0.32% | 40 | 60% |

### æ³¨æ„äº‹é¡¹

âš ï¸ **å¢å¼ºæŒ‡æ ‡ç¼ºå¤±**ï¼š
è¿™ä¸¤æ¡å›æµ‹è®°å½•æ˜¯åœ¨å®æ–½å¢å¼ºæŒ‡æ ‡ä¹‹å‰åˆ›å»ºçš„ï¼Œæ‰€ä»¥æ²¡æœ‰ï¼š
- å¹´åŒ–æ”¶ç›Šç‡
- ç´¢æè¯ºæ¯”ç‡
- å¡ç›æ¯”ç‡
- ç›ˆäºæ¯”
- ç­‰å…¶ä»–æ–°å¢æŒ‡æ ‡

**è§£å†³æ–¹æ¡ˆ**ï¼šé‡æ–°è¿è¡Œå›æµ‹ä»¥è·å¾—å®Œæ•´æŒ‡æ ‡

```bash
python manage.py run_backtest \
  --symbol ETHUSDT \
  --interval 4h \
  --strategy grid_v3 \
  --start-date 2025-01-01 \
  --end-date 2025-11-30 \
  --initial-cash 10000 \
  --executor simple
```

---

## é«˜çº§ç”¨æ³•

### å¯¼å‡ºå›æµ‹æ•°æ®åˆ°CSV

```bash
python manage.py shell -c "
from backtest.models import BacktestResult
import csv

with open('backtest_export.csv', 'w', newline='') as f:
    writer = csv.writer(f)
    writer.writerow(['ID', 'ç­–ç•¥', 'äº¤æ˜“å¯¹', 'æ”¶ç›Šç‡', 'å¤æ™®æ¯”ç‡', 'æœ€å¤§å›æ’¤', 'äº¤æ˜“æ¬¡æ•°', 'èƒœç‡'])

    for r in BacktestResult.objects.all():
        writer.writerow([
            r.id,
            r.name,
            f'{r.symbol} {r.interval}',
            f'{float(r.total_return)*100:.2f}%',
            f'{float(r.sharpe_ratio):.2f}' if r.sharpe_ratio else 'N/A',
            f'{float(r.max_drawdown)*100:.2f}%',
            r.total_trades,
            f'{float(r.win_rate):.2f}%'
        ])

print('å¯¼å‡ºå®Œæˆ: backtest_export.csv')
"
```

### Pythonè„šæœ¬ä¸­ä½¿ç”¨

```python
from backtest.models import BacktestResult

# è·å–æœ€ä½³ç­–ç•¥ï¼ˆæŒ‰å¤æ™®æ¯”ç‡ï¼‰
best_strategy = BacktestResult.objects.filter(
    sharpe_ratio__isnull=False
).order_by('-sharpe_ratio').first()

# è·å–æ”¶ç›Šæœ€é«˜çš„ç­–ç•¥
best_return = BacktestResult.objects.order_by('-total_return').first()

# è·å–ç‰¹å®šæ—¶é—´èŒƒå›´çš„å›æµ‹
from datetime import datetime
recent_backtests = BacktestResult.objects.filter(
    created_at__gte=datetime(2025, 12, 1)
)
```

---

## æ¨èå·¥ä½œæµ

### æ—¥å¸¸å›æµ‹åˆ†ææµç¨‹

1. **è¿è¡Œå›æµ‹**
   ```bash
   python manage.py run_backtest [å‚æ•°]
   ```

2. **å¿«é€ŸæŸ¥çœ‹ç»“æœ**ï¼ˆå‘½ä»¤è¡Œï¼‰
   ```bash
   python manage.py shell -c "from backtest.models import BacktestResult; r=BacktestResult.objects.latest('created_at'); print(f'æ”¶ç›Š: {float(r.total_return)*100:.2f}%, å¤æ™®: {float(r.sharpe_ratio):.2f}' if r.sharpe_ratio else f'æ”¶ç›Š: {float(r.total_return)*100:.2f}%')"
   ```

3. **å¯è§†åŒ–åˆ†æ**ï¼ˆWebæ’­æ”¾å™¨ï¼‰
   - å¯åŠ¨æœåŠ¡
   - åœ¨æ’­æ”¾å™¨ä¸­é€æ­¥è§‚å¯Ÿäº¤æ˜“è¿‡ç¨‹
   - ç†è§£ç­–ç•¥è¡Œä¸º

4. **ç”Ÿæˆä¸“ä¸šæŠ¥å‘Š**ï¼ˆå­˜æ¡£/åˆ†äº«ï¼‰
   ```bash
   python manage.py generate_report --latest 5
   ```

5. **å¯¹æ¯”åˆ†æ**
   - æ¯”è¾ƒä¸åŒå‚æ•°çš„ç­–ç•¥
   - æ‰¾å‡ºæœ€ä¼˜é…ç½®

---

## æ•…éšœæ’æŸ¥

### Q: Webæ’­æ”¾å™¨æ— æ³•è®¿é—®ï¼Ÿ
A: ç¡®ä¿DjangoæœåŠ¡å·²å¯åŠ¨
```bash
python manage.py runserver 8001
```

### Q: çœ‹ä¸åˆ°å¢å¼ºæŒ‡æ ‡ï¼Ÿ
A: æ—§çš„å›æµ‹è®°å½•æ²¡æœ‰å¢å¼ºæŒ‡æ ‡ï¼Œéœ€è¦é‡æ–°è¿è¡Œå›æµ‹

### Q: æŠ¥å‘Šç”Ÿæˆå¤±è´¥ï¼Ÿ
A: æ£€æŸ¥æ˜¯å¦æœ‰å›æµ‹æ•°æ®
```bash
python manage.py shell -c "from backtest.models import BacktestResult; print(BacktestResult.objects.count())"
```

### Q: å¦‚ä½•åˆ é™¤æ—§çš„å›æµ‹è®°å½•ï¼Ÿ
A: ä½¿ç”¨Django shell
```bash
python manage.py shell -c "from backtest.models import BacktestResult; BacktestResult.objects.filter(id__in=[1,2]).delete()"
```

---

**Happy Backtesting! ğŸš€**
