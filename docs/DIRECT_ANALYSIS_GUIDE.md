# 直接分析模式 - 使用指南

## 🎯 功能概述

直接分析模式使用固定的提示词模板，调用 DeepSeek AI 进行分析，并**直接返回 AI 的原始响应**，不做任何修改或解析。

## 📝 提示词文档

**文件位置**: `twitter/prompts/pro_investment_analysis_direct.txt`

**提示词内容**:
```
你是资深加密投研员 + 量化交易员，请仅基于「推文原文区」内容完成下列任务，禁止凭空猜测或引用外部信息。

输出格式必须严格遵守「交付格式区」的分节、表格与字段顺序。

——————【推文原文区】——————
{tweet_content}

——————【分析要求区】——————
A. 目标资产：BTC、ETH、SOL、SUI、其他山寨（可自行细分）

B. 时间窗口：①观点统计——最近 7 天；②实盘操作——最近 48 小时

C. 逻辑深度：
观点须提取支撑论据，并形成「因→果→验证」闭环
操作须给出：建仓价、短/中期止盈止损、仓位规模（绝对值+占比）、杠杆倍数（若有）
判定"大资金"门槛：单笔 ≥1000 BTC / ≥1 万 ETH / ≥1000 万美元等值
D. 一致性统计：按资产分多空人数及仓位方向，给出占比%并列出主要理由
E. 建议输出：结合统计结果，给出你自己的「进场价区间 / 止盈止损 / 仓位建议（分三档：保守-平衡-激进）」

——————【交付格式区】——————
0️⃣ 多空一致性统计（优先展示结论）
| 资产 | 看多人数 | 看空人数 | 中立人数 | 多空差值(%) | 主流看法 & 核心理由 |

1️⃣ 观点提炼（闭环逻辑表）
| 发布时间 | KOL | 资产 | 观点方向 | 关键论据(摘录) | 推理链路(因→果→验证) | 可信度(高/中/低) |

2️⃣ 操作解析（大资金列表优先）
| 发生时间 | KOL | 资产 & 合约 | 建仓价 | 当前/平仓价 | 多空方向 | 杠杆 | 仓位规模 | 短期 TP/SL | 中期 TP/SL | 备注 |

3️⃣ 即时信号流（≤48h）
• [时间]—@user：方向【多/空/买入/卖出】，资产 XXX，价格 YYY，逻辑 …，置信度【高/中/低】

（按时间倒序罗列，最多 15 条关键信号）

4️⃣ 综合研判 & 交易计划（你的独立观点）
4.1 市场温度计：整体情绪（过热/中性/恐慌） + 资金流向
4.2 资产级别展望：
• BTC ——
• ETH ——
• SOL ——
• SUI ——
• 山寨热点 ——
4.3 行动建议（分档位）
| 档位 | 目标资产 | 建议开仓区间 | 止损 | 第一目标位 | 第二目标位 | 建议仓位占比 | 适合人群 |

5️⃣ 风险提示
• 宏观风险 …
• 链上安全 …
• 流动性风险 …

6️⃣ 附录：原始推文索引
(编号-推文链接)
```

## 🚀 使用方法

### 基本命令

```bash
# 直接分析最近24小时的推文
python manage.py run_analysis 1939614372311302186 --direct-analysis

# 自定义时间窗口
python manage.py run_analysis 1939614372311302186 --direct-analysis --hours 12

# 禁用缓存，获取最新数据
python manage.py run_analysis 1939614372311302186 --direct-analysis --hours 24 --no-cache

# 试运行模式
python manage.py run_analysis 1939614372311302186 --direct-analysis --hours 24 --dry-run

# 仅在新推文时发送推送（节省通知成本）
python manage.py run_analysis 1939614372311302186 --direct-analysis --hours 24 --push-only-on-new
```

## 📋 参数说明

| 参数 | 类型 | 说明 | 示例 |
|------|------|------|------|
| `--direct-analysis` | 开关 | 启用直接分析模式（返回AI原始响应） | `--direct-analysis` |
| `--hours` | 整数 | 时间窗口（小时，默认24） | `--hours 48` |
| `--dry-run` | 开关 | 试运行（不保存到数据库） | `--dry-run` |
| `--no-cache` | 开关 | 禁用缓存（获取最新推文） | `--no-cache` |
| `--push-only-on-new` | 开关 | 仅在获取到新推文时发送推送（节省通知成本） | `--push-only-on-new` |

## 📊 输出说明

### 控制台输出
- ✅ 显示分析进度
- ✅ **直接输出 AI 的完整原始响应**
- ✅ 显示保存路径

### 文件输出
- **文件名**: `direct_analysis_result_{list_id}_{timestamp}.txt`
- **文件内容**: AI 的原始响应（未修改）
- **文件格式**: 纯文本

### 示例输出
```
============================================================
📊 DeepSeek 分析结果（原始响应）
============================================================
0️⃣ 多空一致性统计（优先展示结论）

| 资产 | 看多人数 | 看空人数 | 中立人数 | 多空差值(%) | 主流看法 & 核心理由 |
|------|----------|----------|----------|-------------|---------------------|
| BTC  | 3        | 5        | 2        | -25%        | 空头主导，理由...   |

1️⃣ 观点提炼（闭环逻辑表）
...
```

## ⚠️ 注意事项

1. **推文数量限制**：
   - 最多分析 200 条推文（超过则截取最新的）
   - 内容过多可能导致 AI 输出不完整

2. **成本控制**：
   - 时间窗口越大，推文越多，成本越高
   - 建议使用 `--dry-run` 先测试

3. **响应完整性**：
   - AI 可能因 max_tokens 限制而输出不完整
   - 如需完整分析，请减少时间窗口或推文数量

4. **原始响应**：
   - 系统**不做任何修改**，直接返回 AI 响应
   - 响应格式完全由 AI 决定
   - 可能包含 Markdown 表格、特殊字符等

## 💡 新功能：智能推送控制

### `--push-only-on-new` 参数

新增 **智能推送控制** 功能，可避免无意义的重复推送：

#### 使用场景

1. **定期运行脚本**：
   - 每天自动执行分析任务
   - 只有获取到新推文时才发送推送通知
   - 避免每天发送"无新内容"的重复通知

2. **节省通知成本**：
   - 推送服务通常有成本或频率限制
   - 只在有意义的时候推送
   - 提高通知的效率和价值

#### 使用方法

```bash
# 启用智能推送控制
python manage.py run_analysis 1939614372311302186 --direct-analysis --push-only-on-new

# 组合使用：禁用缓存 + 智能推送
python manage.py run_analysis 1939614372311302186 --direct-analysis --no-cache --push-only-on-new
```

#### 运行效果

**有新推文时**：
```
✅ 允许推送：有新推文
📤 正在发送推送...
✅ 推送成功
```

**无新推文时**：
```
ℹ️ 跳过推送：无新推文
```

#### 默认行为

- **不添加参数**：总是发送推送（向后兼容）
- **添加 `--push-only-on-new`**：仅新推文时推送

## 📈 使用场景

1. **专业投研**：
   - 获得结构化的市场分析
   - 多空一致性统计
   - 观点和操作解析

2. **快速决策**：
   - 基于 AI 原始分析制定交易计划
   - 提取关键信号和观点

3. **学习研究**：
   - 了解 AI 如何解读推文
   - 分析市场情绪和趋势

## 🎉 优势

- ✅ **零修改**：直接返回 AI 原始响应
- ✅ **结构化**：遵循严格的分析框架
- ✅ **专业性**：投研员 + 量化交易员视角
- ✅ **灵活性**：可调整时间窗口
- ✅ **可追溯**：保存完整原始响应

## ❓ 常见问题

### Q: 如何获得更完整的分析？
A: 减少时间窗口（如 12 小时）或推文数量（如 50 条）。

### Q: 输出格式不规整怎么办？
A: 这是 AI 的原始响应，属正常现象。如需规整格式，请自行处理。

### Q: 可以修改提示词吗？
A: 提示词文档 `twitter/prompts/pro_investment_analysis_direct.txt` 是固定的，不建议修改。

### Q: 如何控制成本？
A: 使用较小的 `--hours` 值，或使用 `--dry-run` 测试。

---

**直接分析模式，让您获得最原始、最真实的 AI 分析结果！** 🚀
