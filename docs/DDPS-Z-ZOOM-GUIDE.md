# DDPS-Z K线图 Zoom 与拖动功能使用指南

## 功能概述

K线图现已支持缩放（Zoom）和拖动（Pan）功能，让您能够查看更长范围的历史数据并进行精细分析。

---

## 主要特性

### 1. 缩放功能 (Zoom)
- **鼠标滚轮缩放**：在图表上滚动鼠标滚轮可放大/缩小图表
- **触摸板双指缩放**：支持触摸板的双指缩放手势
- **仅X轴缩放**：只缩放时间轴，价格轴自动适应

### 2. 拖动功能 (Pan)
- **鼠标拖动**：按住鼠标左键拖动图表可查看历史数据
- **仅X轴拖动**：只能水平拖动，防止误操作

### 3. 重置功能
- **重置缩放按钮**：点击图表右上角的"重置缩放"按钮恢复原始视图
- **自动适配**：重置后自动显示全部数据范围

---

## 使用方法

### 访问详情页
```
http://127.0.0.1:8000/ddps-z/detail/ETHUSDT/
```

### 操作步骤

#### 缩放操作
1. 将鼠标移动到K线图上
2. 向上滚动鼠标滚轮 → 放大（查看更细节）
3. 向下滚动鼠标滚轮 → 缩小（查看更广范围）

#### 拖动操作
1. 在图表上按住鼠标左键
2. 左右拖动鼠标
3. 查看不同时间段的历史数据

#### 重置视图
1. 点击右上角"重置缩放"按钮
2. 图表恢复到原始显示范围

---

## 技术实现

### 前端依赖
- **Chart.js**: v4.4.1 - 图表库
- **Chart.js Zoom Plugin**: v2.0.1 - 缩放插件
- **Hammer.js**: v2.0.8 - 触摸手势支持

### 配置参数
```javascript
zoom: {
    zoom: {
        wheel: {
            enabled: true,    // 启用鼠标滚轮缩放
            speed: 0.1        // 缩放速度
        },
        pinch: {
            enabled: true     // 启用触摸板缩放
        },
        mode: 'x'             // 仅X轴缩放
    },
    pan: {
        enabled: true,        // 启用拖动
        mode: 'x'             // 仅X轴拖动
    },
    limits: {
        x: {min: 'original', max: 'original'}  // 限制范围
    }
}
```

### 数据范围
- **默认加载**: 500根K线
- **4h周期**: 覆盖约83天历史数据
- **1h周期**: 覆盖约20天历史数据
- **1d周期**: 覆盖约500天历史数据

---

## 应用图表

支持zoom和拖动的图表：
1. ✅ K线图与概率带
2. ✅ Z-Score时序图

---

## 使用场景

### 场景1: 精细分析近期走势
1. 使用滚轮放大最近几天的K线
2. 查看详细的价格波动和概率带位置
3. 分析当前Z-Score在历史中的位置

### 场景2: 对比历史相似位置
1. 拖动图表查看过去的类似Z-Score区间
2. 对比当时的价格表现
3. 评估当前信号的可靠性

### 场景3: 长期趋势观察
1. 缩小图表查看整体趋势
2. 观察EMA和价格的长期关系
3. 识别大周期的超买超卖区间

---

## 性能优化

### 数据加载
- 初始加载500条K线数据
- 前端缓存，无需重复请求
- 切换周期时重新加载

### 渲染优化
- 使用Canvas渲染，性能优异
- 数据点优化，避免过度绘制
- 响应式设计，自动适配屏幕

---

## 注意事项

1. **数据范围限制**: 最多查看500根K线的历史数据
2. **缩放边界**: 缩放范围受原始数据限制，超出范围会自动停止
3. **浏览器兼容**: 推荐使用Chrome、Firefox、Safari等现代浏览器
4. **性能建议**: 数据量较大时，缩放和拖动可能有轻微延迟

---

## 快捷提示

页面上方有操作提示条：
```
操作提示：鼠标滚轮缩放 | 按住拖动查看历史数据 | 点击"重置缩放"恢复原始视图
```

可以关闭提示条以获得更大的图表显示区域。

---

## 常见问题

**Q: 为什么我滚动鼠标滚轮页面也在滚动？**
A: 将鼠标移到图表区域内再滚动，确保焦点在图表上。

**Q: 如何恢复到原始视图？**
A: 点击右上角的"重置缩放"按钮即可。

**Q: 能否查看更多历史数据？**
A: 当前限制为500根K线。如需更多数据，请联系管理员调整后端limit参数。

**Q: 拖动时为什么只能水平移动？**
A: 为了防止误操作，设计为只能水平拖动查看时间维度的历史数据。

---

## 更新日志

### v1.1 (2026-01-05)
- ✅ 添加Chart.js Zoom插件支持
- ✅ 启用鼠标滚轮缩放
- ✅ 启用鼠标拖动功能
- ✅ 添加重置缩放按钮
- ✅ 增加默认数据范围至500根K线
- ✅ 添加操作提示信息
- ✅ K线图和Z-Score图均支持zoom

---

**享受更强大的数据分析体验！** 🚀
