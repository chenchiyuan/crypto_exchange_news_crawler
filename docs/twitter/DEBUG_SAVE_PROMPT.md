# ğŸ” è°ƒè¯•åŠŸèƒ½ï¼šä¿å­˜æ¨é€ç»™AIå‰çš„åŸå§‹å†…å®¹

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æ–°å¢ `--save-prompt` å‚æ•°ï¼Œç”¨äºä¿å­˜æ¨é€ç»™AIå‰çš„åŸå§‹å†…å®¹ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œå¯¹ç…§åˆ†æã€‚

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼Œä¿å­˜åŸå§‹prompt
python manage.py run_analysis 1939614372311302186 --hours 24 --save-prompt

# å¹²è·‘æ¨¡å¼ + ä¿å­˜promptï¼ˆæ¨èç”¨äºè°ƒè¯•ï¼‰
python manage.py run_analysis 1939614372311302186 --hours 24 --dry-run --save-prompt
```

### ç¼–ç¨‹è°ƒç”¨

```python
from twitter.services.orchestrator import TwitterAnalysisOrchestrator

orchestrator = TwitterAnalysisOrchestrator()

task = orchestrator.run_analysis(
    twitter_list=twitter_list,
    start_time=start_time,
    end_time=end_time,
    save_prompt=True  # å¯ç”¨è°ƒè¯•ä¿å­˜
)
```

## ğŸ“ ä¿å­˜ä½ç½®

è°ƒè¯•ä¿¡æ¯ä¿å­˜åœ¨ `debug_prompts/` ç›®å½•ä¸‹ï¼š

```
debug_prompts/
â”œâ”€â”€ prompt_{task_id}_{timestamp}.txt  # ä¸€æ¬¡æ€§åˆ†æ
â””â”€â”€ prompt_{task_id}_batch_1_{timestamp}.txt  # æ‰¹æ¬¡åˆ†æï¼ˆä»…ç¬¬ä¸€æ‰¹ï¼‰
```

## ğŸ“ ä¿å­˜å†…å®¹

æ¯ä¸ªè°ƒè¯•æ–‡ä»¶åŒ…å«ä¸‰éƒ¨åˆ†å†…å®¹ï¼š

### 1. æç¤ºè¯æ¨¡æ¿
```
ã€1. æç¤ºè¯æ¨¡æ¿ã€‘
--------------------------------------------------------------------------------
ä½ æ˜¯èµ„æ·±åŠ å¯†æŠ•ç ”å‘˜ + é‡åŒ–äº¤æ˜“å‘˜ï¼Œè¯·ä»…åŸºäºã€Œæ¨æ–‡åŸæ–‡åŒºã€å†…å®¹å®Œæˆä¸‹åˆ—ä»»åŠ¡...

â€”â€”â€”â€”â€”â€”ã€äº¤ä»˜æ ¼å¼åŒºã€‘â€”â€”â€”â€”â€”â€”

0ï¸âƒ£ å¤šç©ºä¸€è‡´æ€§ç»Ÿè®¡ï¼ˆä¼˜å…ˆå±•ç¤ºç»“è®ºï¼‰
...
```

### 2. æ¨æ–‡åŸæ–‡å†…å®¹
```
ã€2. æ¨æ–‡åŸæ–‡å†…å®¹ã€‘
--------------------------------------------------------------------------------
1. [@NachoTrades] (2025-11-14 08:34)
   å†…å®¹: Even in these shitty conditions there's still good trade opportunities...
   äº’åŠ¨: ğŸ‘12 ğŸ”„3 ğŸ’¬5
   Tweet ID: 1989250535497887901

2. [@RunnerXBT] (2025-11-14 09:17)
   å†…å®¹: Altszn starts in few hrs when americans wake up
   ...
```

### 3. æœ€ç»ˆå‘é€ç»™AIçš„å®Œæ•´Prompt
```
ã€3. æœ€ç»ˆå‘é€ç»™AIçš„å®Œæ•´Promptã€‘
--------------------------------------------------------------------------------
ä½ æ˜¯èµ„æ·±åŠ å¯†æŠ•ç ”å‘˜ + é‡åŒ–äº¤æ˜“å‘˜ï¼Œè¯·ä»…åŸºäºã€Œæ¨æ–‡åŸæ–‡åŒºã€å†…å®¹å®Œæˆä¸‹åˆ—ä»»åŠ¡...

â€”â€”â€”â€”â€”â€”ã€æ¨æ–‡åŸæ–‡åŒºã€‘â€”â€”â€”â€”â€”â€”

1. [@NachoTrades] (2025-11-14 08:34)
   å†…å®¹: Even in these shitty conditions...
   ...

â€”â€”â€”â€”â€”â€”ã€åˆ†æè¦æ±‚åŒºã€‘â€”â€”â€”â€”â€”â€”

A. ç›®æ ‡èµ„äº§ï¼šBTCã€ETHã€SOLã€SUIã€å…¶ä»–å±±å¯¨...
...
```

## ğŸ” è°ƒè¯•ç”¨é€”

### 1. å¯¹ç…§åˆ†æç»“æœ
```bash
# æŸ¥çœ‹ä¿å­˜çš„æ–‡ä»¶
cat debug_prompts/prompt_{task_id}_{timestamp}.txt

# åˆ†æAIä¸ºä»€ä¹ˆè¿”å›ç‰¹å®šç»“æœ
# æ£€æŸ¥æ¨æ–‡å†…å®¹æ˜¯å¦æ­£ç¡®
# æ£€æŸ¥æç¤ºè¯æ˜¯å¦æ­£ç¡®åŠ è½½
```

### 2. éªŒè¯æç¤ºè¯ä¼˜åŒ–
```bash
# ä¿®æ”¹æç¤ºè¯å
python manage.py run_analysis <list_id> --save-prompt

# å¯¹æ¯”ä¿®æ”¹å‰åçš„prompt
diff debug_prompts/prompt_old_*.txt debug_prompts/prompt_new_*.txt
```

### 3. è¯Šæ–­AIç†è§£åå·®
- **æŸ¥çœ‹æ¨æ–‡åŸæ–‡**ï¼šç¡®è®¤AIæ”¶åˆ°äº†æ­£ç¡®çš„æ¨æ–‡å†…å®¹
- **æŸ¥çœ‹æç¤ºè¯**ï¼šç¡®è®¤æç¤ºè¯å®Œæ•´ä¸”æ ¼å¼æ­£ç¡®
- **æŸ¥çœ‹æœ€ç»ˆprompt**ï¼šç¡®è®¤æ¨¡æ¿ä¸æ¨æ–‡æ­£ç¡®åˆå¹¶

## ğŸ“Š ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šAIè¿”å›ç»“æœä¸æ­£ç¡®

```bash
# ä¿å­˜è°ƒè¯•ä¿¡æ¯
python manage.py run_analysis 1939614372311302186 --save-prompt

# æŸ¥çœ‹ä¿å­˜çš„æ–‡ä»¶
cat debug_prompts/prompt_*.txt

# æ£€æŸ¥ï¼š
# 1. æ¨æ–‡å†…å®¹æ˜¯å¦æ­£ç¡®æ ¼å¼åŒ–
# 2. æç¤ºè¯æ˜¯å¦åŒ…å«æ‰€æœ‰è¦æ±‚
# 3. æœ€ç»ˆpromptæ˜¯å¦æ­£ç¡®åˆå¹¶
```

### åœºæ™¯2ï¼šä¼˜åŒ–æç¤ºè¯

```bash
# ä¿®æ”¹æç¤ºè¯æ–‡ä»¶
vim twitter/prompts/pro_investment_analysis.txt

# æµ‹è¯•æ–°æç¤ºè¯
python manage.py run_analysis 1939614372311302186 --save-prompt

# å¯¹æ¯”æ–°æ—§æç¤ºè¯çš„è¾“å‡º
ls -lt debug_prompts/ | head -5
```

### åœºæ™¯3ï¼šè°ƒè¯•æ•°æ®ä¸ä¸€è‡´é—®é¢˜

```bash
# ä¿å­˜è°ƒè¯•ä¿¡æ¯
python manage.py run_analysis 1939614372311302186 --save-prompt --dry-run

# æŸ¥çœ‹æœ€ç»ˆpromptï¼Œæ£€æŸ¥ï¼š
# - æ¨æ–‡æ˜¯å¦éƒ½åŒ…å«åœ¨å†…
# - æç¤ºè¯çš„æ•°æ®ä¸€è‡´æ€§è¦æ±‚æ˜¯å¦æ˜ç¡®
# - AIåº”è¯¥è¿”å›ä»€ä¹ˆç»“æœ
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶å¤§å°**ï¼šæ¯æ¬¡åˆ†æä¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¯èƒ½å ç”¨ç£ç›˜ç©ºé—´
2. **æ•æ„Ÿä¿¡æ¯**ï¼šåŒ…å«å®Œæ•´çš„æ¨æ–‡å†…å®¹ï¼Œæ³¨æ„ä¿¡æ¯å®‰å…¨
3. **æ¸…ç†å»ºè®®**ï¼šå®šæœŸæ¸…ç† `debug_prompts/` ç›®å½•
   ```bash
   # æ¸…ç†30å¤©å‰çš„è°ƒè¯•æ–‡ä»¶
   find debug_prompts/ -name "*.txt" -mtime +30 -delete
   ```

## ğŸ¯ æœ€ä½³å®è·µ

1. **è°ƒè¯•æ—¶ä½¿ç”¨** `--dry-run` æ¨¡å¼ï¼Œé¿å…é‡å¤åˆ†æ
2. **åˆ†æåç«‹å³æŸ¥çœ‹** ä¿å­˜çš„æ–‡ä»¶ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
3. **å¯¹æ¯”åˆ†æ** å¤šæ¬¡è¿è¡Œçš„ç»“æœï¼Œè§‚å¯Ÿå˜åŒ–
4. **åŠæ—¶æ¸…ç†** è°ƒè¯•æ–‡ä»¶ï¼Œä¿æŒç›®å½•æ•´æ´

## ğŸ“ˆ ç¤ºä¾‹è¾“å‡º

```
[INFO] [Task 4b06edf0-df12-4143-b8af-ef0bf339d1af] âœ… è°ƒè¯•ä¿¡æ¯å·²ä¿å­˜åˆ°: /path/to/debug_prompts/prompt_4b06edf0-df12-4143-b8af-ef0bf339d1af_20251114_104500.txt
```

## ğŸ”§ æŠ€æœ¯å®ç°

### ä¿®æ”¹çš„æ–‡ä»¶

1. **twitter/services/ai_analysis_service.py**
   - æ·»åŠ  `save_prompt` å‚æ•°
   - æ–°å¢ `_save_prompt_for_debug` æ–¹æ³•
   - æ”¯æŒä¸€æ¬¡æ€§åˆ†æå’Œæ‰¹æ¬¡åˆ†æ

2. **twitter/services/orchestrator.py**
   - åœ¨ `run_analysis`ã€`execute_analysis` ä¸­ä¼ é€’å‚æ•°
   - ä¿®æ”¹æ–¹æ³•ç­¾åæ”¯æŒ `save_prompt`

3. **twitter/management/commands/run_analysis.py**
   - æ·»åŠ  `--save-prompt` å‘½ä»¤è¡Œå‚æ•°
   - åœ¨ `handle` æ–¹æ³•ä¸­å¤„ç†å‚æ•°

### ä¿å­˜é€»è¾‘

- **ä¸€æ¬¡æ€§åˆ†æ**ï¼šä¿å­˜å®Œæ•´çš„prompt
- **æ‰¹æ¬¡åˆ†æ**ï¼šä»…ä¿å­˜ç¬¬ä¸€æ‰¹æ¬¡çš„è°ƒè¯•ä¿¡æ¯
- **æ–‡ä»¶åæ ¼å¼**ï¼š`prompt_{task_id}_{timestamp}.txt`

---

**åŠŸèƒ½çŠ¶æ€**: âœ… å·²å®ç°å¹¶æµ‹è¯•
**æ·»åŠ æ—¶é—´**: 2025-11-14
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
