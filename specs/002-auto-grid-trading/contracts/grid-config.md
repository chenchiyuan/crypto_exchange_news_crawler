# Management Command API: ç½‘æ ¼é…ç½®ç®¡ç†

**è¯´æ˜**: æœ¬ç³»ç»Ÿä½¿ç”¨Django Management Commandä½œä¸ºä¸»è¦äº¤äº’æ¥å£,è€ŒéREST APIã€‚æœ¬æ–‡æ¡£å®šä¹‰å‘½ä»¤è¡Œæ¥å£å¥‘çº¦ã€‚

---

## 1. åˆ›å»ºç½‘æ ¼é…ç½®

### å‘½ä»¤
```bash
python manage.py create_grid_config \
  --name <é…ç½®åç§°> \
  --exchange <äº¤æ˜“æ‰€> \
  --symbol <äº¤æ˜“å¯¹> \
  --mode <ç½‘æ ¼æ¨¡å¼> \
  --upper <ä»·æ ¼ä¸Šç•Œ> \
  --lower <ä»·æ ¼ä¸‹ç•Œ> \
  --levels <ç½‘æ ¼æ•°é‡> \
  --amount <å•ç¬”é‡‘é¢> \
  --max-position <æœ€å¤§æŒä»“> \
  [--stop-loss-buffer <æ­¢æŸç¼“å†²åŒºç™¾åˆ†æ¯”>] \
  [--refresh-interval <è½®è¯¢é—´éš”æ¯«ç§’>]
```

### å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| `--name` | string | æ˜¯ | é…ç½®åç§°(å”¯ä¸€) | btc_short_grid |
| `--exchange` | string | æ˜¯ | äº¤æ˜“æ‰€ä»£ç  | binance |
| `--symbol` | string | æ˜¯ | äº¤æ˜“å¯¹ | BTCUSDT |
| `--mode` | enum | æ˜¯ | ç½‘æ ¼æ¨¡å¼: short/neutral/long | short |
| `--upper` | decimal | æ˜¯ | ä»·æ ¼ä¸Šç•Œ | 65000 |
| `--lower` | decimal | æ˜¯ | ä»·æ ¼ä¸‹ç•Œ | 60000 |
| `--levels` | integer | æ˜¯ | ç½‘æ ¼æ•°é‡(>=5) | 20 |
| `--amount` | decimal | æ˜¯ | å•ç¬”å¼€ä»“æ•°é‡ | 0.01 |
| `--max-position` | decimal | æ˜¯ | æœ€å¤§æŒä»“é™åˆ¶ | 0.2 |
| `--stop-loss-buffer` | decimal | å¦ | æ­¢æŸç¼“å†²åŒºç™¾åˆ†æ¯”(é»˜è®¤0.005) | 0.01 |
| `--refresh-interval` | integer | å¦ | è½®è¯¢é—´éš”æ¯«ç§’(é»˜è®¤1000) | 1000 |

### ç¤ºä¾‹

```bash
# åˆ›å»ºåšç©ºç½‘æ ¼é…ç½®
python manage.py create_grid_config \
  --name btc_short_grid \
  --exchange binance \
  --symbol BTCUSDT \
  --mode short \
  --upper 65000 \
  --lower 60000 \
  --levels 20 \
  --amount 0.01 \
  --max-position 0.2 \
  --stop-loss-buffer 0.005
```

### è¾“å‡º

**æˆåŠŸ**:
```
âœ… ç½‘æ ¼é…ç½®åˆ›å»ºæˆåŠŸ
é…ç½®åç§°: btc_short_grid
äº¤æ˜“æ‰€: binance
äº¤æ˜“å¯¹: BTCUSDT
ç½‘æ ¼æ¨¡å¼: SHORT (åšç©ºç½‘æ ¼)
ä»·æ ¼åŒºé—´: 60000 ~ 65000
ç½‘æ ¼æ•°é‡: 20å±‚
ç½‘æ ¼é—´è·: 250 USDT (0.42%)
å•ç¬”é‡‘é¢: 0.01 BTC
æœ€å¤§æŒä»“: 0.2 BTC
æ­¢æŸç¼“å†²: 0.5%
```

**å¤±è´¥ - é…ç½®åç§°é‡å¤**:
```
âŒ é”™è¯¯: é…ç½®åç§° 'btc_short_grid' å·²å­˜åœ¨
è¯·ä½¿ç”¨å…¶ä»–åç§°æˆ–åˆ é™¤ç°æœ‰é…ç½®
```

**å¤±è´¥ - å‚æ•°éªŒè¯é”™è¯¯**:
```
âŒ éªŒè¯å¤±è´¥:
- ä¸‹ç•Œä»·æ ¼(60000)å¿…é¡»å°äºä¸Šç•Œä»·æ ¼(60000)
- ç½‘æ ¼æ•°é‡(3)è‡³å°‘ä¸º5
```

---

## 2. åˆ—å‡ºæ‰€æœ‰é…ç½®

### å‘½ä»¤
```bash
python manage.py list_grid_configs [--active-only] [--exchange <äº¤æ˜“æ‰€>]
```

### å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `--active-only` | flag | å¦ | ä»…æ˜¾ç¤ºå¯ç”¨çš„é…ç½® |
| `--exchange` | string | å¦ | æŒ‰äº¤æ˜“æ‰€è¿‡æ»¤ |

### ç¤ºä¾‹

```bash
# åˆ—å‡ºæ‰€æœ‰é…ç½®
python manage.py list_grid_configs

# ä»…åˆ—å‡ºæ´»è·ƒé…ç½®
python manage.py list_grid_configs --active-only

# æŒ‰äº¤æ˜“æ‰€è¿‡æ»¤
python manage.py list_grid_configs --exchange binance
```

### è¾“å‡º

```
ğŸ“‹ ç½‘æ ¼é…ç½®åˆ—è¡¨ (å…±3ä¸ª)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é…ç½®åç§°          â”‚ äº¤æ˜“æ‰€   â”‚ äº¤æ˜“å¯¹   â”‚ æ¨¡å¼   â”‚ ä»·æ ¼åŒºé—´    â”‚ çŠ¶æ€   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ btc_short_grid   â”‚ binance  â”‚ BTCUSDT  â”‚ SHORT  â”‚ 60k ~ 65k  â”‚ âœ…è¿è¡Œä¸­â”‚
â”‚ eth_neutral_grid â”‚ binance  â”‚ ETHUSDT  â”‚ NEUTRALâ”‚ 3k ~ 3.5k  â”‚ â¸ï¸æš‚åœ  â”‚
â”‚ sol_long_grid    â”‚ binance  â”‚ SOLUSDT  â”‚ LONG   â”‚ 100 ~ 120  â”‚ â¹ï¸å·²åœæ­¢â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æŸ¥çœ‹é…ç½®è¯¦æƒ…

### å‘½ä»¤
```bash
python manage.py show_grid_config --name <é…ç½®åç§°>
```

### å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `--name` | string | æ˜¯ | é…ç½®åç§° |

### ç¤ºä¾‹

```bash
python manage.py show_grid_config --name btc_short_grid
```

### è¾“å‡º

```
ğŸ“Š ç½‘æ ¼é…ç½®è¯¦æƒ…

åŸºæœ¬ä¿¡æ¯:
  é…ç½®åç§°: btc_short_grid
  äº¤æ˜“æ‰€: Binance Futures
  äº¤æ˜“å¯¹: BTCUSDT
  ç½‘æ ¼æ¨¡å¼: SHORT (åšç©ºç½‘æ ¼)
  åˆ›å»ºæ—¶é—´: 2025-12-05 10:30:00
  æ›´æ–°æ—¶é—´: 2025-12-05 14:20:15

ä»·æ ¼å‚æ•°:
  ä»·æ ¼ä¸Šç•Œ: 65,000.00 USDT
  ä»·æ ¼ä¸‹ç•Œ: 60,000.00 USDT
  ä»·æ ¼åŒºé—´: 5,000.00 USDT (8.33%)
  ç½‘æ ¼æ•°é‡: 20å±‚
  ç½‘æ ¼é—´è·: 250.00 USDT (0.42%)

ä»“ä½å‚æ•°:
  å•ç¬”é‡‘é¢: 0.01 BTC
  æœ€å¤§æŒä»“: 0.20 BTC
  å½“å‰æŒä»“: 0.08 BTC (40%)

é£æ§å‚æ•°:
  æ­¢æŸç¼“å†²: 0.5%
  æ­¢æŸè§¦å‘: ä»·æ ¼ <= 59,700 æˆ– >= 65,325
  è½®è¯¢é—´éš”: 1000ms

ç²¾åº¦é…ç½®:
  ä»·æ ¼ç²¾åº¦: 0.01 (tick size)
  æ•°é‡ç²¾åº¦: 0.001 (step size)

çŠ¶æ€:
  è¿è¡ŒçŠ¶æ€: âœ… è¿è¡Œä¸­
  æŒç»­æ—¶é—´: 3å°æ—¶50åˆ†é’Ÿ
  æœ€ååŒæ­¥: 5ç§’å‰
```

---

## 4. æ›´æ–°é…ç½®

### å‘½ä»¤
```bash
python manage.py update_grid_config \
  --name <é…ç½®åç§°> \
  [--upper <æ–°çš„ä»·æ ¼ä¸Šç•Œ>] \
  [--lower <æ–°çš„ä»·æ ¼ä¸‹ç•Œ>] \
  [--max-position <æ–°çš„æœ€å¤§æŒä»“>] \
  [--stop-loss-buffer <æ–°çš„æ­¢æŸç¼“å†²åŒº>]
```

### é™åˆ¶
âš ï¸ **è¿è¡Œä¸­çš„ç½‘æ ¼ç­–ç•¥æ— æ³•ä¿®æ”¹é…ç½®,å¿…é¡»å…ˆåœæ­¢**

### å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `--name` | string | æ˜¯ | é…ç½®åç§° |
| `--upper` | decimal | å¦ | æ–°çš„ä»·æ ¼ä¸Šç•Œ |
| `--lower` | decimal | å¦ | æ–°çš„ä»·æ ¼ä¸‹ç•Œ |
| `--max-position` | decimal | å¦ | æ–°çš„æœ€å¤§æŒä»“ |
| `--stop-loss-buffer` | decimal | å¦ | æ–°çš„æ­¢æŸç¼“å†²åŒº |

### ç¤ºä¾‹

```bash
# è°ƒæ•´æ­¢æŸç¼“å†²åŒº
python manage.py update_grid_config \
  --name btc_short_grid \
  --stop-loss-buffer 0.01
```

### è¾“å‡º

**æˆåŠŸ**:
```
âœ… é…ç½®æ›´æ–°æˆåŠŸ
é…ç½®åç§°: btc_short_grid
æ›´æ–°é¡¹:
  - æ­¢æŸç¼“å†²: 0.5% â†’ 1.0%
```

**å¤±è´¥ - ç­–ç•¥è¿è¡Œä¸­**:
```
âŒ é”™è¯¯: é…ç½® 'btc_short_grid' æ­£åœ¨è¿è¡Œ
è¯·å…ˆä½¿ç”¨ stop_grid å‘½ä»¤åœæ­¢ç­–ç•¥,å†è¿›è¡Œä¿®æ”¹
```

---

## 5. åˆ é™¤é…ç½®

### å‘½ä»¤
```bash
python manage.py delete_grid_config --name <é…ç½®åç§°> [--force]
```

### é™åˆ¶
âš ï¸ **è¿è¡Œä¸­çš„ç½‘æ ¼ç­–ç•¥æ— æ³•åˆ é™¤,é™¤éä½¿ç”¨ --force å¼ºåˆ¶åˆ é™¤(ä¼šå…ˆåœæ­¢ç­–ç•¥)**

### å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `--name` | string | æ˜¯ | é…ç½®åç§° |
| `--force` | flag | å¦ | å¼ºåˆ¶åˆ é™¤(è‡ªåŠ¨åœæ­¢ç­–ç•¥) |

### ç¤ºä¾‹

```bash
# åˆ é™¤å·²åœæ­¢çš„é…ç½®
python manage.py delete_grid_config --name sol_long_grid

# å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­çš„é…ç½®
python manage.py delete_grid_config --name btc_short_grid --force
```

### è¾“å‡º

**æˆåŠŸ**:
```
âœ… é…ç½®å·²åˆ é™¤: btc_short_grid
ç›¸å…³æ•°æ®ä¹Ÿå·²æ¸…ç†:
  - ç½‘æ ¼å±‚çº§: 20æ¡
  - è®¢å•æ„å›¾: 156æ¡
  - äº¤æ˜“æ—¥å¿—: 1,024æ¡
  - ç»Ÿè®¡æ•°æ®: 48æ¡
```

**å¤±è´¥ - ç­–ç•¥è¿è¡Œä¸­ä¸”æœªä½¿ç”¨--force**:
```
âŒ é”™è¯¯: é…ç½® 'btc_short_grid' æ­£åœ¨è¿è¡Œ
è¯·å…ˆåœæ­¢ç­–ç•¥,æˆ–ä½¿ç”¨ --force å‚æ•°å¼ºåˆ¶åˆ é™¤
```

**ç¡®è®¤æç¤º (--forceæ—¶)**:
```
âš ï¸  è­¦å‘Š: é…ç½® 'btc_short_grid' æ­£åœ¨è¿è¡Œ
å¼ºåˆ¶åˆ é™¤å°†:
  1. ç«‹å³åœæ­¢ç­–ç•¥
  2. æ’¤é”€æ‰€æœ‰æŒ‚å•
  3. å¸‚ä»·å¹³ä»“æ‰€æœ‰æŒä»“
  4. åˆ é™¤æ‰€æœ‰ç›¸å…³æ•°æ®

ç¡®è®¤åˆ é™¤? (yes/no):
```

---

## 6. Django Admin æ¥å£

é™¤äº†å‘½ä»¤è¡Œæ¥å£,ä¹Ÿå¯ä»¥é€šè¿‡Django Adminç®¡ç†é…ç½®:

### URL
```
http://localhost:8000/admin/grid_trading/gridconfig/
```

### åŠŸèƒ½
- âœ… æŸ¥çœ‹æ‰€æœ‰é…ç½®åˆ—è¡¨
- âœ… æŸ¥çœ‹/ç¼–è¾‘é…ç½®è¯¦æƒ…
- âœ… åˆ é™¤é…ç½®(å¸¦è¿è¡ŒçŠ¶æ€æ£€æŸ¥)
- âœ… æ‰¹é‡æ“ä½œ(æ‰¹é‡åˆ é™¤å·²åœæ­¢çš„é…ç½®)
- âŒ ä¸æ”¯æŒå¯åŠ¨/åœæ­¢ç­–ç•¥(å¿…é¡»ä½¿ç”¨Management Command)

### Adminå­—æ®µé…ç½®

```python
# grid_trading/admin.py
@admin.register(GridConfig)
class GridConfigAdmin(admin.ModelAdmin):
    list_display = [
        'name', 'exchange', 'symbol', 'grid_mode',
        'upper_price', 'lower_price', 'grid_levels',
        'is_active', 'created_at'
    ]
    list_filter = ['exchange', 'grid_mode', 'is_active']
    search_fields = ['name', 'symbol']
    readonly_fields = ['created_at', 'updated_at']

    def delete_model(self, request, obj):
        if obj.is_active:
            messages.error(request, f"æ— æ³•åˆ é™¤è¿è¡Œä¸­çš„é…ç½®: {obj.name}")
            return
        super().delete_model(request, obj)
```

---

## é”™è¯¯ç æ€»ç»“

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ³• |
|--------|------|---------|
| `CONFIG_EXISTS` | é…ç½®åç§°å·²å­˜åœ¨ | ä½¿ç”¨å…¶ä»–åç§°æˆ–åˆ é™¤ç°æœ‰é…ç½® |
| `VALIDATION_ERROR` | å‚æ•°éªŒè¯å¤±è´¥ | æ£€æŸ¥å‚æ•°æ˜¯å¦ç¬¦åˆè§„åˆ™ |
| `CONFIG_NOT_FOUND` | é…ç½®ä¸å­˜åœ¨ | ç¡®è®¤é…ç½®åç§°æ‹¼å†™æ­£ç¡® |
| `CONFIG_RUNNING` | é…ç½®æ­£åœ¨è¿è¡Œ,æ— æ³•ä¿®æ”¹/åˆ é™¤ | å…ˆåœæ­¢ç­–ç•¥ |
| `INVALID_EXCHANGE` | ä¸æ”¯æŒçš„äº¤æ˜“æ‰€ | ä½¿ç”¨æ”¯æŒçš„äº¤æ˜“æ‰€(binance/okx/bybit) |
| `INVALID_MODE` | æ— æ•ˆçš„ç½‘æ ¼æ¨¡å¼ | ä½¿ç”¨ short/neutral/long |
| `PRICE_RANGE_ERROR` | ä»·æ ¼åŒºé—´é”™è¯¯ | ç¡®ä¿ä¸‹ç•Œ < ä¸Šç•Œ |
| `GRID_COUNT_ERROR` | ç½‘æ ¼æ•°é‡é”™è¯¯ | è‡³å°‘5å±‚ç½‘æ ¼ |
