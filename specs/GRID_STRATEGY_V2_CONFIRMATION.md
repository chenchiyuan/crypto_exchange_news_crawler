# ç½‘æ ¼ç­–ç•¥ v2.0 - å®Œæ•´ç­–ç•¥è¯´æ˜ä¹¦

**æ›´æ–°æ—¶é—´**: 2025-11-30
**æ–‡æ¡£çŠ¶æ€**: æœ€ç»ˆç‰ˆï¼ˆé¢å‘å°ç™½ï¼‰
**ç›®æ ‡è¯»è€…**: æ— é‡åŒ–èƒŒæ™¯ï¼Œéœ€è¦æ¸…æ™°ç†è§£ç­–ç•¥é€»è¾‘

---

## ğŸ“š ç›®å½•

1. [ç­–ç•¥æ ¸å¿ƒæ€æƒ³](#1-ç­–ç•¥æ ¸å¿ƒæ€æƒ³)
2. [ç½‘æ ¼ç®±ä½“è®¡ç®—](#2-ç½‘æ ¼ç®±ä½“è®¡ç®—)
3. [ä»“ä½ç®¡ç†æœºåˆ¶](#3-ä»“ä½ç®¡ç†æœºåˆ¶)
4. [æ¸è¿›å¼ä¹°å…¥ç®—æ³•](#4-æ¸è¿›å¼ä¹°å…¥ç®—æ³•)
5. [åˆ†çº§æ­¢ç›ˆå–å‡º](#5-åˆ†çº§æ­¢ç›ˆå–å‡º)
6. [ç®±ä½“æ­¢æŸæœºåˆ¶](#6-ç®±ä½“æ­¢æŸæœºåˆ¶) â­ æ–°å¢ç©ºå¤´æ­¢æŸ
7. [å®Œæ•´äº¤æ˜“ç¤ºä¾‹](#7-å®Œæ•´äº¤æ˜“ç¤ºä¾‹)
8. [æ•°æ®åº“è®¾è®¡](#8-æ•°æ®åº“è®¾è®¡)
9. [æ ¸å¿ƒä»£ç ç®—æ³•](#9-æ ¸å¿ƒä»£ç ç®—æ³•)
10. [å¸¸è§é—®é¢˜è§£ç­”](#10-å¸¸è§é—®é¢˜è§£ç­”) (9ä¸ªé—®é¢˜)

---

## 1. ç­–ç•¥æ ¸å¿ƒæ€æƒ³

### 1.1 ä»€ä¹ˆæ˜¯ç®±ä½“ç½‘æ ¼ç­–ç•¥ï¼Ÿ

**ç®€å•ç†è§£**ï¼š
- æŠŠä»·æ ¼æ³¢åŠ¨æƒ³è±¡æˆä¸€ä¸ª**ç®±å­**ï¼ˆç®±ä½“ï¼‰
- ç®±å­æœ‰**4å±‚**ï¼šä¸Šé¢2å±‚æ˜¯å‹åŠ›ä½ï¼ˆé˜»åŠ›ï¼‰ï¼Œä¸‹é¢2å±‚æ˜¯æ”¯æ’‘ä½ï¼ˆåå¼¹ï¼‰
- ä»·æ ¼åœ¨ç®±å­é‡Œæ¥å›æ³¢åŠ¨æ—¶ï¼Œæˆ‘ä»¬**ä½ä¹°é«˜å–**èµšå·®ä»·

```mermaid
graph TD
    A[ç®±ä½“ç½‘æ ¼ç­–ç•¥] --> B[åŠ¨æ€ç®±ä½“]
    A --> C[æ¸è¿›å¼äº¤æ˜“]
    A --> D[åˆ†çº§æ­¢ç›ˆ]
    A --> E[ç®±ä½“æ­¢æŸ]

    B --> B1[æ¯æ ¹Kçº¿é‡æ–°è®¡ç®—]
    B --> B2[åŸºäºæˆäº¤é‡åˆ†æ]

    C --> C1[åœ¨åŒºé—´å†…è¶Šä½ä¹°è¶Šå¤š]
    C --> C2[åœ¨åŒºé—´å†…è¶Šä½å–è¶Šå¤š]

    D --> D1[æ”¯æ’‘1â†’å‹åŠ›1å–50%+å‹åŠ›2å–50%]
    D --> D2[æ”¯æ’‘2â†’å‹åŠ›1å–70%+å‹åŠ›2å–30%]

    E --> E1[å¤šå¤´: è·Œç ´æ”¯æ’‘2-3%å…¨éƒ¨æ­¢æŸ]
    E --> E2[ç©ºå¤´: çªç ´å‹åŠ›2+3%å…¨éƒ¨æ­¢æŸ]
    E --> E3[ä¿æŠ¤æœ¬é‡‘]

    style A fill:#e1f5ff
    style B fill:#fff4e6
    style C fill:#e8f8f5
    style D fill:#fef5e7
    style E fill:#fadbd8
```

### 1.2 ä¸ä¼ ç»Ÿç½‘æ ¼çš„åŒºåˆ«

| ç‰¹æ€§ | ä¼ ç»Ÿå›ºå®šç½‘æ ¼ | ç®±ä½“ç½‘æ ¼ v2.0 |
|------|------------|--------------|
| ç½‘æ ¼ä»·æ ¼ | å›ºå®šç™¾åˆ†æ¯”ï¼ˆå¦‚æ¯2%ï¼‰ | **åŠ¨æ€è®¡ç®—**ï¼ˆåŸºäºæˆäº¤é‡ï¼‰ |
| æ›´æ–°é¢‘ç‡ | ä¸æ›´æ–° | **æ¯æ ¹Kçº¿æ›´æ–°** |
| ä¹°å…¥æ–¹å¼ | å•ç‚¹è§¦å‘ï¼Œä¸€æ¬¡ä¹°å…¥ | **åŒºé—´å†…æ¸è¿›å¼ä¹°å…¥** |
| å–å‡ºæ–¹å¼ | å•ä¸€ç›®æ ‡ä»· | **åˆ†çº§æ­¢ç›ˆ**ï¼ˆ2ä¸ªå‹åŠ›ä½ï¼‰ |
| ä»“ä½ç®¡ç† | ç®€å•å¹³åˆ† | **æ™ºèƒ½çº¦æŸ**ï¼ˆç†è®ºä¸Šé™+ç°é‡‘çº¦æŸï¼‰ |
| æ­¢æŸæœºåˆ¶ | æ— æˆ–ç®€å• | **ç®±ä½“æ­¢æŸ**ï¼ˆä¿æŠ¤æœ¬é‡‘ï¼‰ |

### 1.3 ç­–ç•¥æ‰§è¡Œæµç¨‹å›¾

```mermaid
flowchart TD
    Start([æ–°Kçº¿å¼€å§‹]) --> CalcGrid[åŠ¨æ€è®¡ç®—ç½‘æ ¼ç®±ä½“<br/>FourPeaksAnalyzer]

    CalcGrid --> CheckLongStop{ä»·æ ¼æ˜¯å¦è·Œç ´<br/>æ”¯æ’‘ä½2-3%?}
    CheckLongStop -->|æ˜¯| LongStopLoss[å¤šå¤´æ­¢æŸ<br/>å–å‡ºæ‰€æœ‰å¤šå¤´æŒä»“]
    CheckLongStop -->|å¦| CheckShortStop{ä»·æ ¼æ˜¯å¦çªç ´<br/>å‹åŠ›ä½2+3%?}

    CheckShortStop -->|æ˜¯| ShortStopLoss[ç©ºå¤´æ­¢æŸ<br/>ä¹°å…¥å¹³æ‰æ‰€æœ‰ç©ºå¤´]
    CheckShortStop -->|å¦| CheckSell{ä»·æ ¼æ˜¯å¦åœ¨<br/>å‹åŠ›ä½åŒºé—´?}

    CheckSell -->|æ˜¯| Sell[æ¸è¿›å¼å–å‡º<br/>æ›´æ–°ä»“ä½çŠ¶æ€]
    CheckSell -->|å¦| CheckBuy{ä»·æ ¼æ˜¯å¦åœ¨<br/>æ”¯æ’‘ä½åŒºé—´?}

    Sell --> CheckBuy

    CheckBuy -->|æ˜¯| Buy[æ¸è¿›å¼ä¹°å…¥<br/>åˆ›å»ºæ–°ä»“ä½]
    CheckBuy -->|å¦| End([ç­‰å¾…ä¸‹ä¸€æ ¹Kçº¿])

    Buy --> UpdateCash[æ›´æ–°ç°é‡‘ä½™é¢]
    UpdateCash --> End

    LongStopLoss --> End
    ShortStopLoss --> End

    style Start fill:#e1f5ff
    style CalcGrid fill:#fff4e6
    style CheckLongStop fill:#fadbd8
    style CheckShortStop fill:#fadbd8
    style LongStopLoss fill:#fadbd8
    style ShortStopLoss fill:#fadbd8
    style Sell fill:#d5f4e6
    style Buy fill:#d5f4e6
    style End fill:#e1f5ff
```

---

## 2. ç½‘æ ¼ç®±ä½“è®¡ç®—

### 2.1 ä»€ä¹ˆæ˜¯ç®±ä½“ï¼Ÿ

**æ¯”å–»ç†è§£**ï¼š
- æƒ³è±¡ä»·æ ¼åœ¨ä¸€ä¸ª**é€æ˜ç›’å­**é‡Œä¸Šä¸‹è·³åŠ¨
- ç›’å­æœ‰4å±‚"æ¶å­"ï¼š
  - é¡¶å±‚ï¼ˆå‹åŠ›ä½2ï¼‰ï¼š3300å…ƒ
  - ä¸Šå±‚ï¼ˆå‹åŠ›ä½1ï¼‰ï¼š3100å…ƒ
  - ä¸‹å±‚ï¼ˆæ”¯æ’‘ä½1ï¼‰ï¼š2900å…ƒ
  - åº•å±‚ï¼ˆæ”¯æ’‘ä½2ï¼‰ï¼š2700å…ƒ

```mermaid
graph TB
    subgraph ç®±ä½“ç»“æ„
        R2[å‹åŠ›ä½2: 3300<br/>ğŸ“ åŒºé—´ 3280-3320<br/>ä½œç”¨: é«˜ä½æ­¢ç›ˆ]
        R1[å‹åŠ›ä½1: 3100<br/>ğŸ“ åŒºé—´ 3080-3120<br/>ä½œç”¨: ä¸»è¦æ­¢ç›ˆ]
        Price[ğŸ’° å½“å‰ä»·æ ¼: 3000]
        S1[æ”¯æ’‘ä½1: 2900<br/>ğŸ“ åŒºé—´ 2880-2920<br/>ä½œç”¨: ç¬¬ä¸€æ¬¡æŠ„åº•]
        S2[æ”¯æ’‘ä½2: 2700<br/>ğŸ“ åŒºé—´ 2680-2720<br/>ä½œç”¨: åŠ ä»“æŠ„åº•]
        StopLine[ğŸ›‘ æ­¢æŸçº¿: 2619<br/>æ”¯æ’‘ä½2 - 3%]
    end

    R2 -.->|å–å‡ºåŒºé—´| R1
    R1 -.->|ä¸­æ€§åŒºé—´| Price
    Price -.->|ä¸­æ€§åŒºé—´| S1
    S1 -.->|ä¹°å…¥åŒºé—´| S2
    S2 -.->|ç´§æ€¥æ­¢æŸ| StopLine

    style R2 fill:#ffe6e6
    style R1 fill:#fff4e6
    style Price fill:#e1f5ff
    style S1 fill:#e8f8f5
    style S2 fill:#d5f4e6
    style StopLine fill:#fadbd8
```

### 2.2 ç®±ä½“å¦‚ä½•è®¡ç®—ï¼Ÿï¼ˆFourPeaksAnalyzerï¼‰

**ç®—æ³•æµç¨‹**ï¼ˆè‡ªåŠ¨æ‰§è¡Œï¼‰ï¼š

```mermaid
flowchart LR
    A[è·å–Kçº¿æ•°æ®<br/>4h, 1h, 15m] --> B[èšåˆæˆäº¤é‡<br/>æƒé‡: 1.5, 1.2, 1.0]

    B --> C[è¯†åˆ«æˆäº¤é‡é›†ä¸­åŒºé—´<br/>æ»‘åŠ¨çª—å£: 5ä¸ªä»·æ ¼æ¡¶]

    C --> D[ç­›é€‰Â±15%èŒƒå›´<br/>å½“å‰ä»·2900-3350]

    D --> E[é€‰æ‹©Top4åŒºé—´<br/>ä¸Šä¸‹å„2ä¸ª]

    E --> F[æå–ä¿å®ˆè¾¹ç•Œ<br/>å‹åŠ›ç”¨ä½ä»·,æ”¯æ’‘ç”¨é«˜ä»·]

    F --> G[MA25å¾®è°ƒ<br/>è·ç¦»<2%åˆ™è°ƒæ•´]

    G --> H[ç”Ÿæˆ4ä¸ªç½‘æ ¼å±‚çº§]

    style A fill:#e1f5ff
    style H fill:#d5f4e6
```

**ç¤ºä¾‹è®¡ç®—**ï¼š

```
åˆå§‹æ¡ä»¶:
â”œâ”€ å½“å‰ä»·æ ¼: 3000 USDT
â”œâ”€ æœ‰æ•ˆèŒƒå›´: 2550~3450 (Â±15%)
â””â”€ MA25: 2905 USDT

æ­¥éª¤1: èšåˆæˆäº¤é‡
â”œâ”€ 4h Kçº¿æˆäº¤é‡ Ã— 1.5
â”œâ”€ 1h Kçº¿æˆäº¤é‡ Ã— 1.2
â””â”€ 15m Kçº¿æˆäº¤é‡ Ã— 1.0

æ­¥éª¤2: è¯†åˆ«æˆäº¤é‡é›†ä¸­åŒºé—´ï¼ˆæ»‘åŠ¨çª—å£æ‰«æï¼‰
â”œâ”€ åŒºé—´A: 2680-2720, ä¸­å¿ƒ2700, æˆäº¤é‡50000 BTC
â”œâ”€ åŒºé—´B: 2860-2920, ä¸­å¿ƒ2890, æˆäº¤é‡45000 BTC
â”œâ”€ åŒºé—´C: 3080-3120, ä¸­å¿ƒ3100, æˆäº¤é‡48000 BTC
â”œâ”€ åŒºé—´D: 3260-3320, ä¸­å¿ƒ3290, æˆäº¤é‡42000 BTC
â””â”€ ... (æ›´å¤šåŒºé—´)

æ­¥éª¤3: é€‰æ‹©Top4ï¼ˆæŒ‰æˆäº¤é‡æ’åºï¼Œç¡®ä¿5%é—´è·ï¼‰
â”œâ”€ ä¸‹æ–¹2ä¸ª: åŒºé—´A(2700), åŒºé—´B(2890)
â””â”€ ä¸Šæ–¹2ä¸ª: åŒºé—´C(3100), åŒºé—´D(3290)

æ­¥éª¤4: æå–ä¿å®ˆè¾¹ç•Œ
â”œâ”€ æ”¯æ’‘ä½2: åŒºé—´Açš„é«˜ä»· = 2720
â”œâ”€ æ”¯æ’‘ä½1: åŒºé—´Bçš„é«˜ä»· = 2920
â”œâ”€ å‹åŠ›ä½1: åŒºé—´Cçš„ä½ä»· = 3080
â””â”€ å‹åŠ›ä½2: åŒºé—´Dçš„ä½ä»· = 3260

æ­¥éª¤5: MA25è°ƒæ•´ï¼ˆå‡è®¾MA25=2905ï¼‰
â”œâ”€ æ”¯æ’‘ä½1: 2920 è·ç¦»MA25 = |2920-2905|/2920 = 0.5% < 2%
â”‚              â†’ è°ƒæ•´åˆ°MA25 = 2905 âœ…
â”œâ”€ å…¶ä»–ä½ç½®è·ç¦»MA25 > 2%ï¼Œä¿æŒä¸å˜
â””â”€ æœ€ç»ˆ: æ”¯æ’‘ä½1 = 2905

æœ€ç»ˆç½‘æ ¼ç®±ä½“:
  â”Œâ”€ å‹åŠ›ä½2: 3260 (åŒºé—´ 3260-3320)
  â”œâ”€ å‹åŠ›ä½1: 3080 (åŒºé—´ 3080-3120)
  â”œâ”€ [å½“å‰ä»·æ ¼ 3000]
  â”œâ”€ æ”¯æ’‘ä½1: 2905 (åŒºé—´ 2880-2920) â† MA25è°ƒæ•´
  â””â”€ æ”¯æ’‘ä½2: 2720 (åŒºé—´ 2680-2720)
```

### 2.3 ä¸ºä»€ä¹ˆæ¯æ ¹Kçº¿éƒ½è¦é‡æ–°è®¡ç®—ï¼Ÿ

**é—®é¢˜**: ä¸ºä»€ä¹ˆä¸èƒ½ç®—ä¸€æ¬¡å°±å›ºå®šï¼Ÿ

**å›ç­”**: å¸‚åœºæ˜¯åŠ¨æ€çš„ï¼

```mermaid
gantt
    title ç½‘æ ¼åŠ¨æ€æ›´æ–°ç¤ºä¾‹ (ETH 180å¤©å›æµ‹)
    dateFormat HH:mm
    axisFormat %H:%M

    section ç¬¬1å¤©
    åˆå§‹ç®±ä½“ S1=2900, S2=2700      :done, a1, 00:00, 4h

    section ç¬¬2å¤©
    ä»·æ ¼ä¸‹è·Œï¼Œç®±ä½“ä¸‹ç§» S1=2850     :active, a2, 04:00, 4h

    section ç¬¬3å¤©
    ä»·æ ¼åå¼¹ï¼Œç®±ä½“å›å‡ S1=2920     :crit, a3, 08:00, 4h

    section ç¬¬4å¤©
    æ¨ªç›˜æ•´ç†ï¼Œç®±ä½“å¾®è°ƒ S1=2905     :done, a4, 12:00, 4h
```

**å…·ä½“ç¤ºä¾‹**ï¼š

| æ—¶é—´ | å½“å‰ä»·æ ¼ | æ”¯æ’‘ä½1ï¼ˆåŠ¨æ€ï¼‰ | å‹åŠ›ä½1ï¼ˆåŠ¨æ€ï¼‰ | è¯´æ˜ |
|------|---------|---------------|---------------|------|
| Day 1 00:00 | 3000 | 2900 (åŒºé—´2880-2920) | 3100 (åŒºé—´3080-3120) | åˆå§‹ç®±ä½“ |
| Day 1 04:00 | 2950 | 2850 (åŒºé—´2830-2870) | 3050 (åŒºé—´3030-3070) | ä»·æ ¼ä¸‹è·Œï¼Œç®±ä½“è·Ÿéš |
| Day 2 00:00 | 3100 | 3000 (åŒºé—´2980-3020) | 3200 (åŒºé—´3180-3220) | çªç ´åé‡æ–°å®šä½ |
| Day 2 08:00 | 3050 | 2950 (åŒºé—´2930-2970) | 3150 (åŒºé—´3130-3170) | å›è°ƒåè°ƒæ•´ |

**å…³é”®ç‚¹**ï¼š
- âœ… æ¯æ ¹Kçº¿ï¼ˆ4å°æ—¶ï¼‰é‡æ–°è®¡ç®— â†’ é€‚åº”å¸‚åœºå˜åŒ–
- âœ… ä¹°å…¥æ—¶è®°å½•å½“å‰çš„å‹åŠ›ä½ â†’ æ¯ä¸ªä»“ä½æœ‰è‡ªå·±çš„æ­¢ç›ˆç›®æ ‡
- âœ… å–å‡ºæ—¶ä½¿ç”¨è®°å½•çš„ç›®æ ‡ä»· â†’ é¿å…ç›®æ ‡ä»·å˜åŠ¨æ··ä¹±

---

## 3. ä»“ä½ç®¡ç†æœºåˆ¶

### 3.1 ç°é‡‘çº¦æŸåŸåˆ™

**æ ¸å¿ƒè§„åˆ™**ï¼š
- **å”¯ä¸€çº¦æŸ** = ç°é‡‘ä½™é¢
- **ç†è®ºä¸Šé™** = æ”¯æ’‘ä½1â‰¤20%ï¼Œæ”¯æ’‘ä½2â‰¤30%ï¼ˆåˆå§‹èµ„é‡‘ï¼‰
- **å®é™…ä¹°å…¥** = min(ç†è®ºå‰©ä½™, å®é™…ç°é‡‘)

```mermaid
flowchart TD
    Start[å‡†å¤‡ä¹°å…¥] --> Check1{æ£€æŸ¥ç†è®ºä¸Šé™<br/>æ”¯æ’‘ä½1å·²æŠ•å…¥<2000?}

    Check1 -->|å¦| Reject1[âŒ æ‹’ç»ä¹°å…¥<br/>è¯¥å±‚çº§å·²æ»¡]
    Check1 -->|æ˜¯| Calc1[è®¡ç®—ç†è®ºå‰©ä½™é¢åº¦]

    Calc1 --> Check2{æ£€æŸ¥ç°é‡‘<br/>current_cash>0?}

    Check2 -->|å¦| Reject2[âŒ æ‹’ç»ä¹°å…¥<br/>ç°é‡‘ä¸è¶³]
    Check2 -->|æ˜¯| CalcFinal[available = min<br/>ç†è®ºå‰©ä½™, å®é™…ç°é‡‘]

    CalcFinal --> CalcWeight[è®¡ç®—æƒé‡<br/>based on price position]

    CalcWeight --> Execute[æœ¬æ¬¡ä¹°å…¥ = available Ã— weight]

    Execute --> UpdateCash[current_cash -= ä¹°å…¥é‡‘é¢]

    Reject1 --> End([ç»“æŸ])
    Reject2 --> End
    UpdateCash --> End

    style Check1 fill:#fff4e6
    style Check2 fill:#fff4e6
    style Execute fill:#d5f4e6
    style Reject1 fill:#fadbd8
    style Reject2 fill:#fadbd8
```

### 3.2 ç¤ºä¾‹ï¼šèµ„é‡‘å¦‚ä½•åˆ†é…

**åˆå§‹æ¡ä»¶**ï¼š
- æ€»èµ„é‡‘: 10000 USDT
- æ”¯æ’‘ä½1ä¸Šé™: 2000 USDT (20%)
- æ”¯æ’‘ä½2ä¸Šé™: 3000 USDT (30%)
- å½“å‰ç°é‡‘: 10000 USDT

**åœºæ™¯æ¼”ç¤º**ï¼š

```mermaid
sequenceDiagram
    participant C as ç°é‡‘æ± <br/>Cash
    participant S1 as æ”¯æ’‘ä½1<br/>Support_1
    participant S2 as æ”¯æ’‘ä½2<br/>Support_2

    Note over C,S2: åˆå§‹çŠ¶æ€: Cash=10000

    C->>S1: ç¬¬1æ¬¡è§¦å‘ (ä»·æ ¼2945)<br/>available=min(2000, 10000)=2000<br/>weight=11%, ä¹°å…¥220
    Note over S1: å·²æŠ•å…¥: 220<br/>å‰©ä½™é¢åº¦: 1780
    Note over C: Cash=9780

    C->>S2: ç¬¬2æ¬¡è§¦å‘ (ä»·æ ¼2695)<br/>available=min(3000, 9780)=3000<br/>weight=80%, ä¹°å…¥2400
    Note over S2: å·²æŠ•å…¥: 2400<br/>å‰©ä½™é¢åº¦: 600
    Note over C: Cash=7380

    C->>S1: ç¬¬3æ¬¡è§¦å‘ (ä»·æ ¼2935)<br/>available=min(1780, 7380)=1780<br/>weight=47%, ä¹°å…¥836
    Note over S1: å·²æŠ•å…¥: 1056<br/>å‰©ä½™é¢åº¦: 944
    Note over C: Cash=6544

    S1->>C: æŸä»“ä½å–å‡ºè·åˆ©1200
    Note over C: Cash=7744 âœ… ç°é‡‘é‡Šæ”¾
```

**è¡¨æ ¼è¯¦è§£**ï¼š

| äº‹ä»¶ | ç†è®ºä¸Šé™ | å·²æŠ•å…¥ | ç†è®ºå‰©ä½™ | å®é™…ç°é‡‘ | å¯ç”¨é‡‘é¢ | æƒé‡ | æœ¬æ¬¡ä¹°å…¥ | æ›´æ–°åç°é‡‘ |
|------|---------|--------|---------|---------|---------|------|---------|-----------|
| **åˆå§‹** | - | - | - | - | - | - | - | 10000 |
| æ”¯æ’‘1 @2945 | 2000 | 0 | 2000 | 10000 | min(2000,10000)=2000 | 11% | 220 | 9780 |
| æ”¯æ’‘2 @2695 | 3000 | 0 | 3000 | 9780 | min(3000,9780)=3000 | 80% | 2400 | 7380 |
| æ”¯æ’‘1 @2935 | 2000 | 220 | 1780 | 7380 | min(1780,7380)=1780 | 47% | 836 | 6544 |
| å–å‡ºè·åˆ© | - | - | - | 6544 | - | - | +1200 | 7744 |

**å…³é”®ç†è§£**ï¼š
1. **ç†è®ºä¸Šé™** é˜²æ­¢å•å±‚è¿‡åº¦é›†ä¸­ï¼ˆæ”¯æ’‘1æœ€å¤š2000ï¼‰
2. **å®é™…ç°é‡‘** ç¡®ä¿ä¸è¶…æ”¯ï¼ˆé’±ä¸å¤Ÿå°±ä¹°å°‘ç‚¹ï¼‰
3. **å–å‡ºé‡Šæ”¾ç°é‡‘** å¯ç»§ç»­ä¹°å…¥ï¼ˆèµ„é‡‘å¾ªç¯ä½¿ç”¨ï¼‰

---

## âœ… æ ¸å¿ƒç‰¹æ€§ç¡®è®¤ï¼ˆ2025-11-30 æ›´æ–°ï¼‰

| åºå· | ç‰¹æ€§ | ç­–ç•¥è¯´æ˜ | çŠ¶æ€ |
|------|------|---------|------|
| 1 | **ç½‘æ ¼ä»·æ ¼** | åŠ¨æ€è®¡ç®—ï¼ˆåŸºäºæˆäº¤é‡åˆ†æï¼‰ï¼Œéå›ºå®šæ­¥é•¿ | âœ… å·²ç†è§£ |
| 2 | **ç½‘æ ¼å±‚æ•°** | 4å±‚ç®±ä½“ï¼ˆæ”¯æ’‘ä½2å±‚ + å‹åŠ›ä½2å±‚ï¼‰ | âœ… å·²ç†è§£ |
| 3 | **ä»“ä½ç®¡ç†** | å›ºå®šä»“ä½æ± ï¼Œæ”¯æ’‘ä½1=20%ï¼Œæ”¯æ’‘ä½2=30% | âœ… å·²æ›´æ–° |
| 4 | **ä¹°å…¥ç­–ç•¥** | æ¸è¿›å¼ä¹°å…¥ï¼Œè¶Šæ¥è¿‘ç½‘æ ¼è¾¹ç•Œä¹°å…¥è¶Šå¤š | âœ… å·²æ›´æ–° |
| 5 | **å–å‡ºç­–ç•¥** | åˆ†çº§æ­¢ç›ˆï¼ˆå¤šä¸ªå‹åŠ›ä½æŒ‰æ¯”ä¾‹å–å‡ºï¼‰ | âœ… å·²æ›´æ–° |
| 6 | **æ­¢æŸç­–ç•¥** | ç®±ä½“æ­¢æŸï¼ˆå¤šå¤´/ç©ºå¤´å¯¹ç§°æ­¢æŸæœºåˆ¶ï¼‰ | âœ… å·²æ›´æ–° |
| 7 | **éƒ¨åˆ†æˆäº¤** | æ”¯æŒéƒ¨åˆ†ä»“ä½æˆäº¤ï¼Œä¸‹æ¬¡è§¦å‘ä¹°æ»¡ | âœ… å·²æ›´æ–° |

---

## ğŸ“Š ç®±ä½“ç½‘æ ¼ç­–ç•¥è¯¦è§£ï¼ˆETH @ 3000ï¼‰

### 1ï¸âƒ£ ç½‘æ ¼ç®±ä½“è®¡ç®—

```
åˆå§‹èµ„é‡‘: 10000 USDT
å½“å‰ä»·æ ¼: 3000 USDT

åŠ¨æ€è®¡ç®—ç½‘æ ¼ç®±ä½“ï¼š
  â”Œâ”€ å‹åŠ›ä½2: 3300 (+10%)  â† ç®±ä½“é¡¶éƒ¨
  â”‚   â”œâ”€ åŒºé—´: 3280-3320
  â”‚   â””â”€ æ­¢ç›ˆç›®æ ‡ / ç©ºå¤´æ­¢æŸè¾¹ç•Œ
  â”‚
  â”œâ”€ å‹åŠ›ä½1: 3100 (+3.3%)
  â”‚   â”œâ”€ åŒºé—´: 3080-3120
  â”‚   â””â”€ ä¸»è¦æ­¢ç›ˆä½
  â”‚
  â”œâ”€ [å½“å‰ä»·æ ¼ 3000]
  â”‚
  â”œâ”€ æ”¯æ’‘ä½1: 2900 (-3.3%)
  â”‚   â”œâ”€ åŒºé—´: 2880-2920 (å®é™…: 2930-2950)
  â”‚   â”œâ”€ åˆ†é…ä»“ä½: 20% (2000 USDT)
  â”‚   â””â”€ ç›®æ ‡: è·Œåˆ°2930ä¹°æ»¡20%
  â”‚
  â””â”€ æ”¯æ’‘ä½2: 2700 (-10%)  â† ç®±ä½“åº•éƒ¨
      â”œâ”€ åŒºé—´: 2680-2720
      â”œâ”€ åˆ†é…ä»“ä½: 30% (3000 USDT)
      â”œâ”€ ç›®æ ‡: è·Œåˆ°2680ä¹°æ»¡30%
      â””â”€ å¤šå¤´æ­¢æŸè¾¹ç•Œ: 2680 Ã— (1-3%) = 2600
```

---

### 2ï¸âƒ£ åŠ¨æ€ä»“ä½ç®¡ç†æœºåˆ¶ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰

**æ¶æ„åŸåˆ™**ï¼š
- âœ… ç½‘æ ¼ä»·æ ¼**æ¯æ ¹Kçº¿é‡æ–°è®¡ç®—**ï¼ˆåŠ¨æ€é€‚åº”å¸‚åœºï¼‰
- âœ… æ¯ä¸ªä»“ä½**ç‹¬ç«‹ç®¡ç†**ï¼ˆè‡ªå·±ç»´æŠ¤ä¹°å…¥/å–å‡ºçŠ¶æ€ï¼‰
- âœ… å”¯ä¸€çº¦æŸï¼š**ç°é‡‘ä½™é¢**

#### å…¨å±€çŠ¶æ€

```python
class GridStrategy:
    # èµ„é‡‘ç®¡ç†
    initial_cash = 10000 USDT  # åˆå§‹èµ„é‡‘ï¼ˆä¸å˜ï¼‰
    current_cash = 10000 USDT  # å½“å‰å¯ç”¨ç°é‡‘ï¼ˆåŠ¨æ€å˜åŒ–ï¼‰

    # ç†è®ºä¸Šé™ï¼ˆæ¯ä¸ªå±‚çº§çš„æœ€å¤§æŠ•å…¥æ¯”ä¾‹ï¼‰
    support_1_max_pct = 20%  # æ”¯æ’‘ä½1æœ€å¤šæŠ•å…¥20%åˆå§‹èµ„é‡‘
    support_2_max_pct = 30%  # æ”¯æ’‘ä½2æœ€å¤šæŠ•å…¥30%åˆå§‹èµ„é‡‘

    # åŠ¨æ€ç½‘æ ¼ï¼ˆæ¯æ ¹Kçº¿æ›´æ–°ï¼‰
    current_grid_levels = {
        'resistance_2': 3300,
        'resistance_1': 3100,
        'support_1': 2900,
        'support_2': 2700
    }
```

#### ä¹°å…¥å¯ç”¨é‡‘é¢è®¡ç®—

```python
def get_available_buy_amount(grid_level):
    """
    è®¡ç®—æŸä¸ªç½‘æ ¼å±‚çº§çš„å¯ç”¨ä¹°å…¥é‡‘é¢

    Returns:
        float: æœ¬æ¬¡å¯ä¹°å…¥é‡‘é¢ï¼ˆUSDTï¼‰
    """
    # 1. è®¡ç®—ç†è®ºä¸Šé™
    if grid_level == 'support_1':
        theoretical_max = initial_cash * 0.20  # 2000 USDT
    elif grid_level == 'support_2':
        theoretical_max = initial_cash * 0.30  # 3000 USDT

    # 2. æŸ¥è¯¢è¯¥å±‚çº§å·²æŠ•å…¥é‡‘é¢
    existing_positions = GridPosition.filter(
        buy_level=grid_level,
        status__in=['open', 'partial_sold']  # æœªå®Œå…¨å¹³ä»“çš„
    )
    already_invested = sum(pos.buy_cost for pos in existing_positions)

    # 3. è®¡ç®—ç†è®ºå‰©ä½™é¢åº¦
    theoretical_available = theoretical_max - already_invested

    # 4. åŒé‡çº¦æŸï¼šmin(ç†è®ºå‰©ä½™, å®é™…ç°é‡‘)
    available = min(theoretical_available, current_cash)

    return max(0, available)
```

**ç¤ºä¾‹åœºæ™¯**ï¼š

```
åˆå§‹: current_cash = 10000 USDT

ç¬¬1æ¬¡è§¦å‘æ”¯æ’‘ä½1 (2945):
  â”œâ”€ ç†è®ºä¸Šé™: 2000 USDT
  â”œâ”€ å·²æŠ•å…¥: 0 USDT
  â”œâ”€ ç†è®ºå‰©ä½™: 2000 USDT
  â”œâ”€ å®é™…ç°é‡‘: 10000 USDT
  â”œâ”€ å¯ç”¨é‡‘é¢: min(2000, 10000) = 2000 USDT
  â”œâ”€ æƒé‡: 11%
  â”œâ”€ æœ¬æ¬¡ä¹°å…¥: 2000 Ã— 11% = 220 USDT
  â””â”€ æ›´æ–°: current_cash = 9780 USDT

ç¬¬2æ¬¡è§¦å‘æ”¯æ’‘ä½2 (2695):
  â”œâ”€ ç†è®ºä¸Šé™: 3000 USDT
  â”œâ”€ å·²æŠ•å…¥: 0 USDT
  â”œâ”€ ç†è®ºå‰©ä½™: 3000 USDT
  â”œâ”€ å®é™…ç°é‡‘: 9780 USDT
  â”œâ”€ å¯ç”¨é‡‘é¢: min(3000, 9780) = 3000 USDT
  â”œâ”€ æƒé‡: 80%
  â”œâ”€ æœ¬æ¬¡ä¹°å…¥: 3000 Ã— 80% = 2400 USDT
  â””â”€ æ›´æ–°: current_cash = 7380 USDT

ç¬¬3æ¬¡è§¦å‘æ”¯æ’‘ä½1 (2935):
  â”œâ”€ ç†è®ºä¸Šé™: 2000 USDT
  â”œâ”€ å·²æŠ•å…¥: 220 USDT
  â”œâ”€ ç†è®ºå‰©ä½™: 1780 USDT
  â”œâ”€ å®é™…ç°é‡‘: 7380 USDT
  â”œâ”€ å¯ç”¨é‡‘é¢: min(1780, 7380) = 1780 USDT
  â”œâ”€ æƒé‡: 47%
  â”œâ”€ æœ¬æ¬¡ä¹°å…¥: 1780 Ã— 47% = 836 USDT
  â””â”€ æ›´æ–°: current_cash = 6544 USDT

æŸä¸ªä»“ä½å–å‡ºè·åˆ© 1200 USDT:
  â””â”€ æ›´æ–°: current_cash = 7744 USDT  # ç°é‡‘é‡Šæ”¾
```

**å…³é”®ç‚¹**ï¼š
- âœ… æ¯ä¸ªå±‚çº§æœ‰ç†è®ºä¸Šé™ï¼ˆ20%/30%ï¼‰ï¼Œé˜²æ­¢å•å±‚çº§è¿‡åº¦é›†ä¸­
- âœ… å®é™…ä¹°å…¥å—ç°é‡‘çº¦æŸï¼Œç¡®ä¿ä¸è¶…æ”¯
- âœ… å–å‡ºåç°é‡‘é‡Šæ”¾ï¼Œå¯ç»§ç»­ä¹°å…¥
- âœ… ä¸åŒå±‚çº§ä¹‹é—´ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ï¼ˆåªå…±äº«ç°é‡‘æ± ï¼‰

---

## 4. æ¸è¿›å¼ä¹°å…¥ç®—æ³•

### 4.1 ä»€ä¹ˆæ˜¯æ¸è¿›å¼ä¹°å…¥ï¼Ÿ

**ä¼ ç»Ÿç½‘æ ¼** vs **æ¸è¿›å¼**ï¼š

```mermaid
graph LR
    subgraph ä¼ ç»Ÿç½‘æ ¼
        A1[ä»·æ ¼2900] -->|å•ç‚¹è§¦å‘| B1[ä¸€æ¬¡æ€§ä¹°å…¥2000]
    end

    subgraph æ¸è¿›å¼ç½‘æ ¼
        A2[ä»·æ ¼2950] -->|è¿›å…¥åŒºé—´| B2[ä¹°å…¥125 5%]
        B2 --> C2[ä»·æ ¼2940]
        C2 -->|æ›´æ¥è¿‘åº•éƒ¨| D2[ä¹°å…¥400 20%]
        D2 --> E2[ä»·æ ¼2930]
        E2 -->|åˆ°è¾¾åº•éƒ¨| F2[ä¹°å…¥å‰©ä½™1475 73%]
    end

    style B1 fill:#fadbd8
    style B2 fill:#d5f4e6
    style D2 fill:#d5f4e6
    style F2 fill:#d5f4e6
```

**ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ**
1. **é™ä½é£é™©**ï¼šä¸ä¼šåœ¨å•ç‚¹ä¹°å…¥å…¨éƒ¨ä»“ä½
2. **å¹³å‡æˆæœ¬**ï¼šåœ¨ä¸‹è·Œè¿‡ç¨‹ä¸­åˆ†æ‰¹ä¹°å…¥ï¼Œé™ä½å¹³å‡æˆæœ¬
3. **çµæ´»åº”å¯¹**ï¼šå¦‚æœåªè·Œåˆ°ä¸€åŠå°±åå¼¹ï¼Œè‡³å°‘ä¹°åˆ°ä¸€éƒ¨åˆ†

### 4.2 æƒé‡å‡½æ•°ï¼šæŒ‡æ•°è¡°å‡

**æ ¸å¿ƒå…¬å¼**ï¼š

```
weight = exp(-k * distance_pct)

å…¶ä¸­:
- k = 3 (è¡°å‡ç³»æ•°)
- distance_pct = (å½“å‰ä»·æ ¼ - åŒºé—´ä¸‹ç•Œ) / (åŒºé—´ä¸Šç•Œ - åŒºé—´ä¸‹ç•Œ)
```

**å¯è§†åŒ–æƒé‡åˆ†å¸ƒ**ï¼š

```mermaid
graph LR
    subgraph æ”¯æ’‘ä½1åŒºé—´ 2880-2920
        P1[2880 ä¸‹ç•Œ<br/>æƒé‡=100%] --> P2[2890<br/>75%]
        P2 --> P3[2900 ä¸­ç‚¹<br/>22%]
        P3 --> P4[2910<br/>11%]
        P4 --> P5[2920 ä¸Šç•Œ<br/>5%]
    end

    style P1 fill:#d5f4e6
    style P2 fill:#d5f4e6
    style P3 fill:#fff4e6
    style P4 fill:#ffe6e6
    style P5 fill:#fadbd8
```

**æƒé‡å¯¹ç…§è¡¨**ï¼š

| ä»·æ ¼ä½ç½® | è·ç¦»ä¸‹ç•Œ | distance_pct | æƒé‡ | è¯´æ˜ |
|---------|---------|-------------|------|------|
| 2880 (ä¸‹ç•Œ) | 0 | 0% | 100% | æœ€ä½ç‚¹ï¼Œå…¨åŠ›ä¹°å…¥ |
| 2885 | 5 | 12.5% | 71% | æ¥è¿‘åº•éƒ¨ |
| 2890 | 10 | 25% | 47% | è¿˜ä¸é”™çš„ä½ç½® |
| 2895 | 15 | 37.5% | 31% | ä¸­ç­‰ä½ç½® |
| 2900 (ä¸­ç‚¹) | 20 | 50% | 22% | è§‚æœ›ä¸ºä¸» |
| 2905 | 25 | 62.5% | 15% | å°‘é‡ä¹°å…¥ |
| 2910 | 30 | 75% | 11% | éå¸¸ä¿å®ˆ |
| 2915 | 35 | 87.5% | 7% | æå°ä»“ä½ |
| 2920 (ä¸Šç•Œ) | 40 | 100% | 5% | æœ€å°ä¹°å…¥ |

### 4.3 å®Œæ•´ä¹°å…¥ç¤ºä¾‹

**åœºæ™¯è®¾å®š**ï¼š
- æ”¯æ’‘ä½1åŒºé—´: 2880-2920 (å®½åº¦40)
- å¯ç”¨èµ„é‡‘: 2000 USDT
- å½“å‰ç°é‡‘: 10000 USDT
- ä»·æ ¼èµ°åŠ¿: 2945 â†’ 2910 â†’ 2895 â†’ 2885 â†’ 2880 â†’ 2870

```mermaid
sequenceDiagram
    participant P as ä»·æ ¼èµ°åŠ¿
    participant Zone as æ”¯æ’‘ä½1åŒºé—´<br/>2880-2920
    participant Cash as å¯ç”¨èµ„é‡‘<br/>åˆå§‹2000

    Note over P,Cash: åˆå§‹: ä»·æ ¼2945, ä¸åœ¨åŒºé—´

    P->>Zone: ä»·æ ¼è·Œè‡³2910
    Zone->>Zone: è®¡ç®—: distance=75%<br/>weight=11%
    Zone->>Cash: ä¹°å…¥: 2000Ã—11%=220
    Note over Cash: å‰©ä½™: 1780

    P->>Zone: ä»·æ ¼è·Œè‡³2895
    Zone->>Zone: è®¡ç®—: distance=37.5%<br/>weight=31%
    Zone->>Cash: ä¹°å…¥: 1780Ã—31%=552
    Note over Cash: å‰©ä½™: 1228

    P->>Zone: ä»·æ ¼è·Œè‡³2885
    Zone->>Zone: è®¡ç®—: distance=12.5%<br/>weight=71%
    Zone->>Cash: ä¹°å…¥: 1228Ã—71%=872
    Note over Cash: å‰©ä½™: 356

    P->>Zone: ä»·æ ¼è·Œè‡³2880
    Zone->>Zone: è®¡ç®—: distance=0%<br/>weight=100%
    Zone->>Cash: ä¹°æ»¡: 356Ã—100%=356
    Note over Cash: å‰©ä½™: 0 âœ… ä¹°æ»¡

    P->>Zone: ä»·æ ¼è·Œç ´2870
    Note over Zone: å·²ä¹°æ»¡ï¼Œä¸å†ä¹°å…¥
```

**è¯¦ç»†è®¡ç®—è¿‡ç¨‹**ï¼š

| Kçº¿æ—¶é—´ | ä»·æ ¼ | åœ¨åŒºé—´å†…? | è·ç¦» | distance_pct | weight | å¯ç”¨èµ„é‡‘ | æœ¬æ¬¡ä¹°å…¥ | ä¹°å…¥æ•°é‡(ETH) | å‰©ä½™èµ„é‡‘ |
|---------|------|----------|------|-------------|--------|---------|---------|--------------|---------|
| 00:00 | 2945 | âŒ | - | - | - | 2000 | 0 | 0 | 2000 |
| 04:00 | 2910 | âœ… | 30 | 75% | 11% | 2000 | 220 | 0.0755 | 1780 |
| 08:00 | 2895 | âœ… | 15 | 37.5% | 31% | 1780 | 552 | 0.1907 | 1228 |
| 12:00 | 2885 | âœ… | 5 | 12.5% | 71% | 1228 | 872 | 0.3023 | 356 |
| 16:00 | 2880 | âœ… | 0 | 0% | 100% | 356 | 356 | 0.1236 | 0 |
| 20:00 | 2870 | âŒ | å·²ä¹°æ»¡ | - | - | 0 | 0 | 0 | 0 |

**æ€»ç»“**ï¼š
- æ€»æŠ•å…¥: 2000 USDT
- æ€»ä¹°å…¥: 0.7921 ETH
- å¹³å‡æˆæœ¬: 2000 / 0.7921 = 2525 USDT/ETH
- ä¹°å…¥æ¬¡æ•°: 4æ¬¡ï¼ˆåˆ†æ‰¹è¿›å…¥ï¼‰

---

**ä¹°å…¥æƒé‡ç®—æ³•**ï¼š

```python
def calculate_buy_weight(current_price, zone_high, zone_low):
    """
    è®¡ç®—ä¹°å…¥æƒé‡ï¼ˆè¶Šæ¥è¿‘zone_lowæƒé‡è¶Šå¤§ï¼‰

    Args:
        current_price: å½“å‰ä»·æ ¼
        zone_high: åŒºé—´ä¸Šç•Œ (2950)
        zone_low: åŒºé—´ä¸‹ç•Œ (2930)

    Returns:
        weight: 0.0 ~ 1.0
    """
    # è·ç¦»ä¸‹ç•Œçš„ç™¾åˆ†æ¯”
    distance_pct = (current_price - zone_low) / (zone_high - zone_low)

    # åå‘æƒé‡ï¼šè¶Šæ¥è¿‘ä¸‹ç•Œï¼Œæƒé‡è¶Šå¤§
    # 2930 â†’ weight=1.0 (100%)
    # 2940 â†’ weight=0.5 (50%)
    # 2950 â†’ weight=0.1 (10%)
    weight = 1.0 - distance_pct

    # ä½¿ç”¨æŒ‡æ•°å‡½æ•°å¢å¼ºå°¾éƒ¨æƒé‡
    weight = weight ** 2  # å¹³æ–¹å‡½æ•°

    return max(0.1, min(1.0, weight))  # é™åˆ¶åœ¨10%-100%
```

**ç¤ºä¾‹è®¡ç®—**ï¼š

```
å‡è®¾æ”¯æ’‘ä½1: 2930-2950ï¼Œåˆ†é…ä»“ä½2000 USDT

ä»·æ ¼2945è§¦å‘:
  â”œâ”€ distance_pct = (2945-2930)/(2950-2930) = 0.75
  â”œâ”€ weight = (1-0.75)Â² = 0.0625 â‰ˆ 6.25%
  â”œâ”€ æœ¬æ¬¡ä¹°å…¥: 2000 Ã— 6.25% = 125 USDT
  â”œâ”€ ä¹°å…¥æ•°é‡: 125 / 2945 = 0.0424 ETH
  â””â”€ å‰©ä½™é¢åº¦: 2000 - 125 = 1875 USDT

ä»·æ ¼2935è§¦å‘:
  â”œâ”€ distance_pct = (2935-2930)/(2950-2930) = 0.25
  â”œâ”€ weight = (1-0.25)Â² = 0.5625 â‰ˆ 56.25%
  â”œâ”€ æœ¬æ¬¡ä¹°å…¥: 1875 Ã— 56.25% = 1055 USDT
  â”œâ”€ ä¹°å…¥æ•°é‡: 1055 / 2935 = 0.3595 ETH
  â””â”€ å‰©ä½™é¢åº¦: 820 USDT

ä»·æ ¼2930è§¦å‘:
  â”œâ”€ weight = 100%
  â”œâ”€ æœ¬æ¬¡ä¹°å…¥: 820 USDT (å‰©ä½™å…¨éƒ¨)
  â””â”€ æ”¯æ’‘ä½1ä»“ä½ä¹°æ»¡ âœ…
```

**éƒ¨åˆ†æˆäº¤æœºåˆ¶**ï¼š

```
åœºæ™¯1: ä»·æ ¼åªè·Œåˆ°2940å°±åå¼¹
  â”œâ”€ ä»…ä¹°å…¥çº¦30% (600 USDT)
  â”œâ”€ å‰©ä½™é¢åº¦: 1400 USDT
  â””â”€ ä¸‹æ¬¡è·Œåˆ°2940-2930æ—¶ï¼Œç»§ç»­ä¹°å…¥å‰©ä½™é¢åº¦

åœºæ™¯2: ä»·æ ¼ç›´æ¥è·Œç ´2930
  â”œâ”€ åœ¨2950-2930èŒƒå›´å†…åˆ†æ‰¹ä¹°å…¥
  â””â”€ åˆ°è¾¾2930æ—¶ä¹°æ»¡100%
```

---

## 5. åˆ†çº§æ­¢ç›ˆå–å‡º

### 5.1 ä¸ºä»€ä¹ˆè¦åˆ†çº§æ­¢ç›ˆï¼Ÿ

**é—®é¢˜**: ä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªä»·æ ¼å…¨éƒ¨å–å‡ºï¼Ÿ

**å›ç­”**: å¸‚åœºå¯èƒ½åªæ¶¨åˆ°ä¸€åŠå°±å›è°ƒï¼

```mermaid
graph LR
    subgraph å•ä¸€æ­¢ç›ˆé—®é¢˜
        A1[ä¹°å…¥@2900] --> B1{ä»·æ ¼æ¶¨åˆ°3100?}
        B1 -->|æ˜¯| C1[å…¨éƒ¨å–å‡º]
        B1 -->|å¦ï¼Œåªåˆ°3050| D1[âŒ é”™å¤±æœºä¼š<br/>ä¸€åˆ†é’±æ²¡èµš]
    end

    subgraph åˆ†çº§æ­¢ç›ˆä¼˜åŠ¿
        A2[ä¹°å…¥@2900] --> B2[ä»·æ ¼æ¶¨åˆ°3050]
        B2 --> C2[âœ… éƒ¨åˆ†å–å‡º20%<br/>é”å®šéƒ¨åˆ†åˆ©æ¶¦]
        C2 --> D2{ç»§ç»­æ¶¨åˆ°3100?}
        D2 -->|æ˜¯| E2[å†å–30%]
        D2 -->|å¦ï¼Œå›è°ƒ| F2[è‡³å°‘èµšäº†20%]
    end

    style D1 fill:#fadbd8
    style C2 fill:#d5f4e6
    style E2 fill:#d5f4e6
    style F2 fill:#d5f4e6
```

### 5.2 æ­¢ç›ˆåˆ†é…çŸ©é˜µ

**æ ¸å¿ƒè§„åˆ™**ï¼š
- æ”¯æ’‘ä½1ä¹°å…¥ â†’ å‹åŠ›ä½1å–50% + å‹åŠ›ä½2å–50%
- æ”¯æ’‘ä½2ä¹°å…¥ â†’ å‹åŠ›ä½1å–70% + å‹åŠ›ä½2å–30%

**ä¸ºä»€ä¹ˆè¿™æ ·åˆ†é…ï¼Ÿ**

```mermaid
graph TD
    S2[æ”¯æ’‘ä½2ä¹°å…¥<br/>æˆæœ¬è¾ƒä½<br/>åˆ©æ¶¦ç©ºé—´å¤§] -->|70%| R1[å‹åŠ›ä½1å–å‡º<br/>å¿«é€Ÿæ­¢ç›ˆ]
    S2 -->|30%| R2[å‹åŠ›ä½2å–å‡º<br/>åšå–æ›´å¤§åˆ©æ¶¦]

    S1[æ”¯æ’‘ä½1ä¹°å…¥<br/>æˆæœ¬ä¸­ç­‰<br/>åˆ©æ¶¦ç©ºé—´ä¸­] -->|50%| R1
    S1 -->|50%| R2

    style S2 fill:#d5f4e6
    style S1 fill:#e8f8f5
    style R1 fill:#fff4e6
    style R2 fill:#ffe6e6
```

**è¯¦ç»†è¯´æ˜**ï¼š

| ä¹°å…¥ä½ç½® | æˆæœ¬ | åˆ°å‹åŠ›1åˆ©æ¶¦ | åˆ°å‹åŠ›2åˆ©æ¶¦ | ç­–ç•¥ | åŸå›  |
|---------|------|-----------|-----------|------|------|
| æ”¯æ’‘ä½2 | 2700 | +14.8% | +22.2% | R1å–70% | æˆæœ¬ä½ï¼Œå¿«é€Ÿå›æœ¬ |
| æ”¯æ’‘ä½1 | 2900 | +6.9% | +13.8% | R1å–50% | æˆæœ¬ä¸­ï¼Œå¹³è¡¡ç­–ç•¥ |

### 5.3 å®Œæ•´å–å‡ºç¤ºä¾‹

**åœºæ™¯è®¾å®š**ï¼š
- åœ¨æ”¯æ’‘ä½1 (2900) ä¹°å…¥ 1.0 ETHï¼Œæˆæœ¬2900 USDT
- ä¹°å…¥æ—¶è®°å½•çš„ç›®æ ‡ä»·:
  - å‹åŠ›ä½1: 3100 (åŒºé—´3080-3120)
  - å‹åŠ›ä½2: 3300 (åŒºé—´3280-3320)

```mermaid
sequenceDiagram
    participant P as ä»·æ ¼èµ°åŠ¿
    participant Pos as ä»“ä½çŠ¶æ€<br/>1.0 ETH
    participant R1 as å‹åŠ›ä½1ç›®æ ‡<br/>å–50% (0.5 ETH)
    participant R2 as å‹åŠ›ä½2ç›®æ ‡<br/>å–50% (0.5 ETH)

    Note over P,R2: åˆå§‹: æŒä»“1.0 ETH @ 2900

    P->>R1: ä»·æ ¼æ¶¨è‡³3085
    R1->>R1: è®¡ç®—: distance=12.5%<br/>weight=71%
    R1->>Pos: å–å‡º: 0.5Ã—71%=0.355 ETH
    Note over Pos: å‰©ä½™0.645 ETH
    Note over R1: R1è¿˜éœ€å–: 0.145 ETH

    P->>R1: ä»·æ ¼æ¶¨è‡³3100
    R1->>R1: è®¡ç®—: distance=50%<br/>weight=22%
    R1->>Pos: å–å‡º: 0.145Ã—22%=0.032 ETH
    Note over Pos: å‰©ä½™0.613 ETH
    Note over R1: R1è¿˜éœ€å–: 0.113 ETH

    P->>R1: ä»·æ ¼æ¶¨è‡³3120
    R1->>R1: è®¡ç®—: distance=100%<br/>weight=100%
    R1->>Pos: å–å®ŒR1: 0.113 ETH
    Note over Pos: å‰©ä½™0.5 ETH
    Note over R1: âœ… R1å·²å…¨éƒ¨å–å®Œ

    P->>R2: ä»·æ ¼æ¶¨è‡³3285
    R2->>R2: è®¡ç®—: distance=12.5%<br/>weight=71%
    R2->>Pos: å–å‡º: 0.5Ã—71%=0.355 ETH
    Note over Pos: å‰©ä½™0.145 ETH

    P->>R2: ä»·æ ¼æ¶¨è‡³3320
    R2->>R2: è®¡ç®—: distance=100%<br/>weight=100%
    R2->>Pos: å–å®Œå‰©ä½™: 0.145 ETH
    Note over Pos: âœ… å…¨éƒ¨å–å®Œ
```

**è¯¦ç»†è®¡ç®—è¡¨æ ¼**ï¼š

| Kçº¿æ—¶é—´ | ä»·æ ¼ | è§¦å‘åŒºé—´ | è·ç¦» | weight | æœ¬æ¬¡å–å‡º | å‰©ä½™æŒä»“ | R1è¿›åº¦ | R2è¿›åº¦ |
|---------|------|---------|------|--------|---------|---------|-------|-------|
| 00:00 | 3085 | R1 | 12.5% | 71% | 0.355 ETH | 0.645 | 71% | 0% |
| 04:00 | 3100 | R1 | 50% | 22% | 0.032 ETH | 0.613 | 77.4% | 0% |
| 08:00 | 3120 | R1 | 100% | 100% | 0.113 ETH | 0.500 | âœ… 100% | 0% |
| 12:00 | 3285 | R2 | 12.5% | 71% | 0.355 ETH | 0.145 | âœ… 100% | 71% |
| 16:00 | 3320 | R2 | 100% | 100% | 0.145 ETH | 0.000 | âœ… 100% | âœ… 100% |

**æ”¶ç›Šè®¡ç®—**ï¼š

```
åˆå§‹æŠ•å…¥: 2900 USDT (1.0 ETH)

å‹åŠ›ä½1å–å‡º: 0.5 ETH
â”œâ”€ @3085: 0.355 ETH Ã— 3085 = 1095.18 USDT
â”œâ”€ @3100: 0.032 ETH Ã— 3100 = 99.20 USDT
â”œâ”€ @3120: 0.113 ETH Ã— 3120 = 352.56 USDT
â””â”€ å°è®¡: 1546.94 USDT

å‹åŠ›ä½2å–å‡º: 0.5 ETH
â”œâ”€ @3285: 0.355 ETH Ã— 3285 = 1166.18 USDT
â”œâ”€ @3320: 0.145 ETH Ã— 3320 = 481.40 USDT
â””â”€ å°è®¡: 1647.58 USDT

æ€»æ”¶å…¥: 1546.94 + 1647.58 = 3194.52 USDT (æ‰£é™¤æ‰‹ç»­è´¹å‰)
æ‰‹ç»­è´¹: 3194.52 Ã— 0.1% = 3.19 USDT
å‡€æ”¶å…¥: 3191.33 USDT

å‡€åˆ©æ¶¦: 3191.33 - 2900 = 291.33 USDT
æ”¶ç›Šç‡: 291.33 / 2900 = 10.05%
```

---

**æ¸è¿›å¼å–å‡ºç®—æ³•**ï¼ˆåŒä¹°å…¥ï¼‰ï¼š

```
å‹åŠ›ä½1åŒºé—´: 3080-3120

ä»·æ ¼3085è§¦å‘:
  â”œâ”€ è·ç¦»3080è¾ƒè¿œï¼Œæƒé‡10%
  â”œâ”€ æœ¬æ¬¡å–å‡º: 0.3448 Ã— 10% = 0.0345 ETH
  â””â”€ å‰©ä½™: 0.3103 ETH

ä»·æ ¼3100è§¦å‘:
  â”œâ”€ è·ç¦»3080è¾ƒè¿‘ï¼Œæƒé‡60%
  â”œâ”€ æœ¬æ¬¡å–å‡º: 0.3103 Ã— 60% = 0.1862 ETH
  â””â”€ å‰©ä½™: 0.1241 ETH

ä»·æ ¼3120è§¦å‘:
  â”œâ”€ åˆ°è¾¾ä¸Šç•Œï¼Œæƒé‡100%
  â””â”€ å–å®Œå‰©ä½™: 0.1241 ETH âœ…
```

#### æ”¯æ’‘ä½2ä¹°å…¥çš„ä»“ä½ â†’ æ­¢ç›ˆåˆ†é…

```
æ”¯æ’‘ä½2ä¹°å…¥: 1.1111 ETH (æˆæœ¬3000 USDT)

æ­¢ç›ˆç›®æ ‡:
â”œâ”€ å‹åŠ›ä½1 (3100): å–å‡º70% (0.7778 ETH)
â””â”€ å‹åŠ›ä½2 (3300): å–å‡º30% (0.3333 ETH)
```

**æ­¢ç›ˆåˆ†é…çŸ©é˜µ**ï¼š

| ä¹°å…¥ä½ç½® | å‹åŠ›ä½1å–å‡ºæ¯”ä¾‹ | å‹åŠ›ä½2å–å‡ºæ¯”ä¾‹ |
|---------|---------------|---------------|
| æ”¯æ’‘ä½1 | 50% | 50% |
| æ”¯æ’‘ä½2 | 70% | 30% |

---

### 5ï¸âƒ£ ç®±ä½“æ­¢æŸæœºåˆ¶

#### æ­¢æŸåŸç†

ç®±ä½“æ­¢æŸæ˜¯ä¸ºäº†**ä¿æŠ¤æœ¬é‡‘**ï¼Œé˜²æ­¢ä»·æ ¼çªç ´ç®±ä½“åæŒç»­äºæŸã€‚

```mermaid
graph TD
    subgraph ç®±ä½“æ­¢æŸè¾¹ç•Œ
        R2Stop[ç©ºå¤´æ­¢æŸçº¿<br/>å‹åŠ›ä½2 + 3%<br/>3399]
        R2[å‹åŠ›ä½2: 3300<br/>åŒºé—´ 3280-3320]
        R1[å‹åŠ›ä½1: 3100<br/>åŒºé—´ 3080-3120]
        Price[å½“å‰ä»·æ ¼: 3000]
        S1[æ”¯æ’‘ä½1: 2900<br/>åŒºé—´ 2880-2920]
        S2[æ”¯æ’‘ä½2: 2700<br/>åŒºé—´ 2680-2720]
        S2Stop[å¤šå¤´æ­¢æŸçº¿<br/>æ”¯æ’‘ä½2 - 3%<br/>2619]
    end

    R2Stop -.->|çªç ´åˆ™å¹³ç©º| R2
    S2Stop -.->|è·Œç ´åˆ™å¹³å¤š| S2

    style R2Stop fill:#fadbd8
    style S2Stop fill:#fadbd8
    style Price fill:#e1f5ff
```

#### å¤šå¤´æ­¢æŸ

**è§¦å‘æ¡ä»¶**: ä»·æ ¼è·Œç ´æ”¯æ’‘ä½2åŒºé—´ä¸‹ç•Œ - 3%ï¼ˆå¯é…ç½®ï¼‰

```
ç®±ä½“åº•éƒ¨: æ”¯æ’‘ä½2åŒºé—´ä¸‹ç•Œ = 2680
æ­¢æŸé˜ˆå€¼: 3%ï¼ˆå¯é…ç½®ï¼‰
æ­¢æŸè¾¹ç•Œ: 2680 Ã— (1 - 3%) = 2619.60

è§¦å‘æ¡ä»¶: å½“å‰ä»·æ ¼ < 2619.60
```

**æ­¢æŸåŠ¨ä½œ**ï¼š

```mermaid
sequenceDiagram
    participant P as ä»·æ ¼è·Œç ´2619
    participant S1 as æ”¯æ’‘ä½1æŒä»“
    participant S2 as æ”¯æ’‘ä½2æŒä»“
    participant Cash as ç°é‡‘æ± 

    Note over P: è§¦å‘å¤šå¤´æ­¢æŸ âš ï¸

    P->>S1: æŸ¥è¯¢æ‰€æœ‰æœªå¹³ä»“ä½
    S1-->>P: è¿”å›3ä¸ªä»“ä½ (0.5 ETH)

    P->>S2: æŸ¥è¯¢æ‰€æœ‰æœªå¹³ä»“ä½
    S2-->>P: è¿”å›2ä¸ªä»“ä½ (0.8 ETH)

    P->>P: æŒ‰å¸‚ä»·å–å‡º 1.3 ETH @ 2619
    Note over P: å–å‡ºæ”¶å…¥: 3404.7 USDT<br/>æ‰£é™¤æ‰‹ç»­è´¹: 3.4 USDT

    P->>Cash: é‡Šæ”¾ç°é‡‘ 3401.3 USDT
    Note over Cash: ç°é‡‘å¢åŠ  âœ…

    P->>S1: æ›´æ–°æ‰€æœ‰ä»“ä½çŠ¶æ€ â†’ 'closed'
    P->>S2: æ›´æ–°æ‰€æœ‰ä»“ä½çŠ¶æ€ â†’ 'closed'

    Note over P,Cash: æ­¢æŸå®Œæˆï¼Œç­‰å¾…ä»·æ ¼å›åˆ°ç®±ä½“å†…
```

**æ­¢æŸåçŠ¶æ€**ï¼š

```
æ‰€æœ‰å¤šå¤´æŒä»“: å·²å¹³ä»“
ç°é‡‘: é‡Šæ”¾æ‰€æœ‰ä»“ä½èµ„é‡‘ï¼ˆæ¥å—äºæŸï¼‰
ç½‘æ ¼çŠ¶æ€: ç»§ç»­è®¡ç®—ï¼Œç­‰å¾…ä»·æ ¼å›åˆ°ç®±ä½“å†…é‡æ–°æ¿€æ´»
```

#### ç©ºå¤´æ­¢æŸ

**è§¦å‘æ¡ä»¶**: ä»·æ ¼çªç ´å‹åŠ›ä½2åŒºé—´ä¸Šç•Œ + 3%ï¼ˆå¯é…ç½®ï¼‰

```
ç®±ä½“é¡¶éƒ¨: å‹åŠ›ä½2åŒºé—´ä¸Šç•Œ = 3320
æ­¢æŸé˜ˆå€¼: 3%ï¼ˆå¯é…ç½®ï¼‰
æ­¢æŸè¾¹ç•Œ: 3320 Ã— (1 + 3%) = 3419.60

è§¦å‘æ¡ä»¶: å½“å‰ä»·æ ¼ > 3419.60
```

**æ­¢æŸåŠ¨ä½œ**ï¼š

```mermaid
sequenceDiagram
    participant P as ä»·æ ¼çªç ´3419
    participant R1 as å‹åŠ›ä½1ç©ºå¤´
    participant R2 as å‹åŠ›ä½2ç©ºå¤´
    participant Cash as ç°é‡‘æ± 

    Note over P: è§¦å‘ç©ºå¤´æ­¢æŸ âš ï¸

    P->>R1: æŸ¥è¯¢æ‰€æœ‰æœªå¹³ä»“ä½
    R1-->>P: è¿”å›2ä¸ªä»“ä½ (éœ€ä¹°å…¥0.4 ETH)

    P->>R2: æŸ¥è¯¢æ‰€æœ‰æœªå¹³ä»“ä½
    R2-->>P: è¿”å›1ä¸ªä»“ä½ (éœ€ä¹°å…¥0.2 ETH)

    P->>P: æŒ‰å¸‚ä»·ä¹°å…¥ 0.6 ETH @ 3419
    Note over P: ä¹°å…¥æˆæœ¬: 2051.4 USDT<br/>æ‰£é™¤æ‰‹ç»­è´¹: 2.05 USDT

    P->>Cash: æ‰£é™¤ç°é‡‘ 2053.45 USDT
    Note over Cash: ç°é‡‘å‡å°‘ âŒ

    P->>R1: æ›´æ–°æ‰€æœ‰ä»“ä½çŠ¶æ€ â†’ 'closed'
    P->>R2: æ›´æ–°æ‰€æœ‰ä»“ä½çŠ¶æ€ â†’ 'closed'

    Note over P,Cash: æ­¢æŸå®Œæˆï¼Œç­‰å¾…ä»·æ ¼å›åˆ°ç®±ä½“å†…
```

**æ­¢æŸåçŠ¶æ€**ï¼š

```
æ‰€æœ‰ç©ºå¤´æŒä»“: å·²å¹³ä»“
ç°é‡‘: æ‰£é™¤å¹³ä»“æˆæœ¬ï¼ˆæ¥å—äºæŸï¼‰
ç½‘æ ¼çŠ¶æ€: ç»§ç»­è®¡ç®—ï¼Œç­‰å¾…ä»·æ ¼å›åˆ°ç®±ä½“å†…é‡æ–°æ¿€æ´»
```

#### å¯¹ç§°æ€§è®¾è®¡

| é¡¹ç›® | å¤šå¤´æ­¢æŸ | ç©ºå¤´æ­¢æŸ |
|------|---------|---------|
| **è§¦å‘è¾¹ç•Œ** | æ”¯æ’‘ä½2åŒºé—´ä¸‹ç•Œ - 3% | å‹åŠ›ä½2åŒºé—´ä¸Šç•Œ + 3% |
| **è§¦å‘æ¡ä»¶** | ä»·æ ¼ < æ­¢æŸè¾¹ç•Œ | ä»·æ ¼ > æ­¢æŸè¾¹ç•Œ |
| **å¹³ä»“åŠ¨ä½œ** | å–å‡ºæ‰€æœ‰å¤šå¤´æŒä»“ | ä¹°å…¥å¹³æ‰æ‰€æœ‰ç©ºå¤´æŒä»“ |
| **ç°é‡‘å½±å“** | å¢åŠ ç°é‡‘ï¼ˆå–å‡ºæ”¶å…¥ï¼‰ | å‡å°‘ç°é‡‘ï¼ˆä¹°å…¥æˆæœ¬ï¼‰ |
| **é…ç½®å‚æ•°** | stop_loss_pctï¼ˆé»˜è®¤3%ï¼‰ | stop_loss_pctï¼ˆé»˜è®¤3%ï¼‰ |
| **é‡æ–°æ¿€æ´»** | ä»·æ ¼å›åˆ°ç®±ä½“å†… | ä»·æ ¼å›åˆ°ç®±ä½“å†… |

#### ç¤ºä¾‹è®¡ç®—

**åœºæ™¯1: å¤šå¤´æ­¢æŸ**

```
åˆå§‹çŠ¶æ€:
â”œâ”€ æ”¯æ’‘ä½1æŒä»“: 3ä¸ªä»“ä½ï¼Œå…±0.5 ETHï¼Œæˆæœ¬1450 USDT
â”œâ”€ æ”¯æ’‘ä½2æŒä»“: 2ä¸ªä»“ä½ï¼Œå…±0.8 ETHï¼Œæˆæœ¬2160 USDT
â”œâ”€ å½“å‰ç®±ä½“: S2åŒºé—´ä¸‹ç•Œ = 2680
â””â”€ æ­¢æŸè¾¹ç•Œ: 2680 Ã— (1-3%) = 2619.60

Day 20 ä»·æ ¼è·Œè‡³2610:
â”œâ”€ è§¦å‘æ¡ä»¶: 2610 < 2619.60 âœ…
â”œâ”€ å–å‡º1.3 ETH @ 2610 = 3393 USDT
â”œâ”€ æ‰£é™¤æ‰‹ç»­è´¹: 3.39 USDT
â”œâ”€ å‡€æ”¶å…¥: 3389.61 USDT
â”œâ”€ æ€»æˆæœ¬: 1450 + 2160 = 3610 USDT
â””â”€ å‡€äºæŸ: 3389.61 - 3610 = -220.39 USDT (-6.1%)

æ­¢æŸä¿æŠ¤æ•ˆæœ:
âœ… é˜²æ­¢ç»§ç»­ä¸‹è·Œé€ æˆæ›´å¤§äºæŸ
âœ… ä¿ç•™ç°é‡‘ç­‰å¾…ä¸‹ä¸€æ¬¡æœºä¼š
```

**åœºæ™¯2: ç©ºå¤´æ­¢æŸ**

```
åˆå§‹çŠ¶æ€:
â”œâ”€ å‹åŠ›ä½1ç©ºå¤´: 2ä¸ªä»“ä½ï¼Œå–å‡º0.4 ETHï¼Œæ”¶å…¥1240 USDT
â”œâ”€ å‹åŠ›ä½2ç©ºå¤´: 1ä¸ªä»“ä½ï¼Œå–å‡º0.2 ETHï¼Œæ”¶å…¥660 USDT
â”œâ”€ å½“å‰ç®±ä½“: R2åŒºé—´ä¸Šç•Œ = 3320
â””â”€ æ­¢æŸè¾¹ç•Œ: 3320 Ã— (1+3%) = 3419.60

Day 15 ä»·æ ¼æ¶¨è‡³3425:
â”œâ”€ è§¦å‘æ¡ä»¶: 3425 > 3419.60 âœ…
â”œâ”€ ä¹°å…¥0.6 ETH @ 3425 = 2055 USDT
â”œâ”€ æ‰£é™¤æ‰‹ç»­è´¹: 2.06 USDT
â”œâ”€ æ€»æˆæœ¬: 2057.06 USDT
â”œâ”€ å–å‡ºæ”¶å…¥: 1240 + 660 = 1900 USDT
â””â”€ å‡€äºæŸ: 1900 - 2057.06 = -157.06 USDT (-8.3%)

æ­¢æŸä¿æŠ¤æ•ˆæœ:
âœ… é˜²æ­¢ç»§ç»­ä¸Šæ¶¨é€ æˆæ›´å¤§äºæŸ
âœ… åŠæ—¶æ­¢æŸä¿æŠ¤æœ¬é‡‘
```

---

### 6ï¸âƒ£ å®Œæ•´äº¤æ˜“æµç¨‹ç¤ºä¾‹

```mermaid
sequenceDiagram
    participant P as ä»·æ ¼
    participant S1 as æ”¯æ’‘ä½1ä»“ä½æ± 
    participant S2 as æ”¯æ’‘ä½2ä»“ä½æ± 
    participant R1 as å‹åŠ›ä½1
    participant R2 as å‹åŠ›ä½2

    Note over P,R2: åˆå§‹çŠ¶æ€: 10000 USDTç°é‡‘

    P->>S1: è·Œè‡³2945 (è¿›å…¥åŒºé—´)
    S1-->>S1: ä¹°å…¥6.25% (125 USDT)
    Note right of S1: å‰©ä½™é¢åº¦1875

    P->>S1: è·Œè‡³2935
    S1-->>S1: ä¹°å…¥56.25% (1055 USDT)
    Note right of S1: å‰©ä½™é¢åº¦820

    P->>S1: è·Œè‡³2930
    S1-->>S1: ä¹°æ»¡100% (820 USDT)
    Note right of S1: âœ… æ”¯æ’‘ä½1ä¹°æ»¡

    P->>S2: è·Œè‡³2695
    S2-->>S2: ä¹°å…¥80% (2400 USDT)
    Note right of S2: å‰©ä½™é¢åº¦600

    Note over P,R2: === ä»·æ ¼åå¼¹ ===

    P->>R1: æ¶¨è‡³3085 (è¿›å…¥å‹åŠ›ä½1åŒºé—´)
    R1-->>S1: å–å‡ºæ”¯æ’‘ä½1çš„10% (50%ç›®æ ‡çš„10%)
    R1-->>S2: å–å‡ºæ”¯æ’‘ä½2çš„7% (70%ç›®æ ‡çš„10%)

    P->>R1: æ¶¨è‡³3100
    R1-->>S1: å–å‡ºæ”¯æ’‘ä½1çš„60%
    R1-->>S2: å–å‡ºæ”¯æ’‘ä½2çš„42%

    P->>R1: æ¶¨è‡³3120
    R1-->>S1: å–å®Œæ”¯æ’‘ä½1å‰©ä½™ âœ… (50%å·²å…¨éƒ¨å–å‡º)
    R1-->>S2: å–å®Œæ”¯æ’‘ä½2å‰©ä½™ âœ… (70%å·²å…¨éƒ¨å–å‡º)

    Note right of S1: ä»“ä½é¢åº¦æ¢å¤1000 USDT (50%)
    Note right of S2: ä»“ä½é¢åº¦æ¢å¤2100 USDT (70%)

    P->>R2: æ¶¨è‡³3290
    R2-->>S1: å–å‡ºæ”¯æ’‘ä½1å‰©ä½™50%

    Note over P,R2: === å…¨éƒ¨æ­¢ç›ˆå®Œæˆ ===
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡ï¼ˆæœ€ç»ˆç‰ˆï¼‰

### GridPosition è¡¨ï¼ˆæ ¸å¿ƒè¡¨ï¼‰

æ¯æ¬¡ä¹°å…¥åˆ›å»ºä¸€æ¡è®°å½•ï¼Œç‹¬ç«‹ç®¡ç†è¯¥ä»“ä½çš„å…¨ç”Ÿå‘½å‘¨æœŸï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| **id** | int | ä¸»é”® | 1 |
| **backtest_result_id** | int | å…³è”å›æµ‹ | 100 |
| **buy_level** | str | ä¹°å…¥å±‚çº§ | 'support_1' |
| **buy_price** | decimal | ä¹°å…¥ä»·æ ¼ | 2935.00 |
| **buy_time** | datetime | ä¹°å…¥æ—¶é—´ | 2025-11-30 10:00 |
| **buy_amount** | decimal | ä¹°å…¥æ•°é‡(ETH) | 0.5690 |
| **buy_cost** | decimal | ä¹°å…¥æˆæœ¬(USDT) | 1670.00 |
| **buy_zone_weight** | decimal | ä¹°å…¥æ—¶æƒé‡ | 0.47 |
| | | | |
| **sell_target_r1_price** | decimal | å‹åŠ›ä½1ä»·æ ¼ â­ | 3100.00 |
| **sell_target_r1_pct** | decimal | å‹åŠ›ä½1æ¯”ä¾‹ | 50.00% |
| **sell_target_r1_sold** | decimal | å‹åŠ›ä½1å·²å– | 0.2845 ETH |
| **sell_target_r1_zone_low** | decimal | å‹åŠ›ä½1åŒºé—´ä¸‹ç•Œ | 3080.00 |
| **sell_target_r1_zone_high** | decimal | å‹åŠ›ä½1åŒºé—´ä¸Šç•Œ | 3120.00 |
| | | | |
| **sell_target_r2_price** | decimal | å‹åŠ›ä½2ä»·æ ¼ â­ | 3300.00 |
| **sell_target_r2_pct** | decimal | å‹åŠ›ä½2æ¯”ä¾‹ | 50.00% |
| **sell_target_r2_sold** | decimal | å‹åŠ›ä½2å·²å– | 0 ETH |
| **sell_target_r2_zone_low** | decimal | å‹åŠ›ä½2åŒºé—´ä¸‹ç•Œ | 3280.00 |
| **sell_target_r2_zone_high** | decimal | å‹åŠ›ä½2åŒºé—´ä¸Šç•Œ | 3320.00 |
| | | | |
| **total_sold_amount** | decimal | æ€»å·²å–æ•°é‡ | 0.2845 ETH |
| **total_revenue** | decimal | æ€»å–å‡ºæ”¶å…¥ | 880.00 USDT |
| **pnl** | decimal | å‡€åˆ©æ¶¦ | -790.00 USDT |
| **status** | str | çŠ¶æ€ | 'open'/'partial'/'closed' |

**çŠ¶æ€è¯´æ˜**ï¼š
- `open`: æœªå–å‡ºä»»ä½•éƒ¨åˆ†
- `partial`: éƒ¨åˆ†å–å‡ºï¼ˆR1æˆ–R2å–äº†ä¸€éƒ¨åˆ†ï¼‰
- `closed`: å…¨éƒ¨å–å‡ºï¼ˆR1å’ŒR2éƒ½å–å®Œï¼‰

**å…³é”®è®¾è®¡**ï¼š
- âœ… æ¯ä¸ªPositionç‹¬ç«‹ç»´æŠ¤è‡ªå·±çš„å–å‡ºç›®æ ‡
- âœ… ä¹°å…¥æ—¶è®°å½•å½“å‰çš„å‹åŠ›ä½ä»·æ ¼ï¼ˆåŠ¨æ€ï¼‰
- âœ… è®°å½•ä¸¤ä¸ªå‹åŠ›ä½çš„å–å‡ºåŒºé—´
- âœ… è·Ÿè¸ªæ¯ä¸ªå‹åŠ›ä½å·²å–æ•°é‡

---

### ç¤ºä¾‹æ•°æ®

```sql
-- æ”¯æ’‘ä½1ä¹°å…¥çš„ç¬¬1ç¬”ä»“ä½
INSERT INTO grid_position VALUES (
  id = 1,
  buy_level = 'support_1',
  buy_price = 2935.00,
  buy_amount = 0.5690,
  buy_cost = 1670.00,

  -- ä¹°å…¥æ—¶è®¡ç®—çš„å–å‡ºç›®æ ‡ï¼ˆåŠ¨æ€ï¼‰
  sell_target_r1_price = 3100.00,  -- å½“æ—¶çš„å‹åŠ›ä½1
  sell_target_r1_pct = 50.00,
  sell_target_r1_sold = 0.10,      -- å·²å–0.10 ETH
  sell_target_r1_zone_low = 3080.00,
  sell_target_r1_zone_high = 3120.00,

  sell_target_r2_price = 3300.00,  -- å½“æ—¶çš„å‹åŠ›ä½2
  sell_target_r2_pct = 50.00,
  sell_target_r2_sold = 0,         -- è¿˜æ²¡å–
  sell_target_r2_zone_low = 3280.00,
  sell_target_r2_zone_high = 3320.00,

  total_sold_amount = 0.10,
  status = 'partial'
);

-- æ”¯æ’‘ä½2ä¹°å…¥çš„ç¬¬1ç¬”ä»“ä½
INSERT INTO grid_position VALUES (
  id = 2,
  buy_level = 'support_2',
  buy_price = 2695.00,
  buy_amount = 0.8905,
  buy_cost = 2400.00,

  -- æ”¯æ’‘ä½2çš„æ­¢ç›ˆåˆ†é…ä¸åŒ
  sell_target_r1_price = 3100.00,
  sell_target_r1_pct = 70.00,      -- 70%åœ¨R1å–
  sell_target_r1_sold = 0,

  sell_target_r2_price = 3300.00,
  sell_target_r2_pct = 30.00,      -- 30%åœ¨R2å–
  sell_target_r2_sold = 0,

  status = 'open'
);
```

---

### æŸ¥è¯¢ç¤ºä¾‹

```python
# 1. æŸ¥è¯¢æ”¯æ’‘ä½1å·²æŠ•å…¥é‡‘é¢
already_invested = GridPosition.filter(
    buy_level='support_1',
    status__in=['open', 'partial']
).aggregate(Sum('buy_cost'))['buy_cost__sum']

# 2. æŸ¥è¯¢åœ¨å‹åŠ›ä½1éœ€è¦å–å‡ºçš„ä»“ä½
positions_to_sell = GridPosition.filter(
    status__in=['open', 'partial'],
    sell_target_r1_sold__lt=F('buy_amount') * F('sell_target_r1_pct') / 100
)

# 3. è®¡ç®—æŸä¸ªä»“ä½åœ¨å‹åŠ›ä½1è¿˜éœ€å–å¤šå°‘
position = GridPosition.get(id=1)
r1_target_amount = position.buy_amount * (position.sell_target_r1_pct / 100)
r1_remaining = r1_target_amount - position.sell_target_r1_sold
```

---

## ğŸ”„ æ ¸å¿ƒäº¤æ˜“ç®—æ³•ï¼ˆæœ€ç»ˆç‰ˆï¼‰

### æ¯æ ¹Kçº¿çš„æ‰§è¡Œæµç¨‹

```python
def on_new_kline(current_time, current_price, df_history):
    """
    æ¯æ ¹Kçº¿è°ƒç”¨ä¸€æ¬¡

    Args:
        current_time: å½“å‰Kçº¿æ—¶é—´
        current_price: å½“å‰æ”¶ç›˜ä»·
        df_history: å†å²æ•°æ®ï¼ˆç”¨äºFourPeaksAnalyzerï¼‰
    """
    # 1. åŠ¨æ€è®¡ç®—æœ€æ–°ç½‘æ ¼
    grid_levels = calculate_grid_levels(current_time, df_history)
    # Returns: {
    #   'resistance_2': {'price': 3300, 'zone_low': 3280, 'zone_high': 3320},
    #   'resistance_1': {'price': 3100, 'zone_low': 3080, 'zone_high': 3120},
    #   'support_1': {'price': 2900, 'zone_low': 2880, 'zone_high': 2920},
    #   'support_2': {'price': 2700, 'zone_low': 2680, 'zone_high': 2720}
    # }

    # 2. æ£€æŸ¥æ­¢æŸï¼ˆå¤šå¤´å’Œç©ºå¤´ï¼‰
    check_stop_loss(current_price, grid_levels)

    # 3. æ£€æŸ¥å–å‡ºï¼ˆå…ˆå–åä¹°ï¼Œé‡Šæ”¾ç°é‡‘ï¼‰
    check_sell_signals(current_price, grid_levels)

    # 4. æ£€æŸ¥ä¹°å…¥
    check_buy_signals(current_price, grid_levels)
```

---

### ä¹°å…¥æµç¨‹

```python
def check_buy_signals(current_price, grid_levels):
    """æ£€æŸ¥æ˜¯å¦è§¦å‘ä¹°å…¥"""

    # éå†æ”¯æ’‘ä½
    for level_name in ['support_1', 'support_2']:
        level_info = grid_levels[level_name]

        # æ£€æŸ¥ä»·æ ¼æ˜¯å¦åœ¨åŒºé—´å†…
        if not (level_info['zone_low'] <= current_price <= level_info['zone_high']):
            continue  # ä¸åœ¨åŒºé—´å†…ï¼Œè·³è¿‡

        # æ‰§è¡Œæ¸è¿›å¼ä¹°å…¥
        execute_progressive_buy(
            level_name=level_name,
            current_price=current_price,
            level_info=level_info,
            grid_levels=grid_levels  # ç”¨äºè®°å½•å–å‡ºç›®æ ‡
        )


def execute_progressive_buy(level_name, current_price, level_info, grid_levels):
    """
    æ¸è¿›å¼ä¹°å…¥ç®—æ³•

    Args:
        level_name: 'support_1' / 'support_2'
        current_price: å½“å‰ä»·æ ¼
        level_info: {'price': 2900, 'zone_low': 2880, 'zone_high': 2920}
        grid_levels: å®Œæ•´ç½‘æ ¼ä¿¡æ¯ï¼ˆç”¨äºè®°å½•å–å‡ºç›®æ ‡ï¼‰
    """
    # 1. è®¡ç®—å¯ç”¨ä¹°å…¥é‡‘é¢
    available_amount = get_available_buy_amount(level_name)

    if available_amount <= 10:  # è‡³å°‘10 USDT
        return  # èµ„é‡‘ä¸è¶³

    # 2. è®¡ç®—ä¹°å…¥æƒé‡ï¼ˆæŒ‡æ•°è¡°å‡ï¼‰
    import math
    zone_low = level_info['zone_low']
    zone_high = level_info['zone_high']

    distance_pct = (current_price - zone_low) / (zone_high - zone_low)
    distance_pct = max(0.0, min(1.0, distance_pct))

    k = 3.0  # è¡°å‡ç³»æ•°
    weight = math.exp(-k * distance_pct)
    weight = max(0.05, min(1.0, weight))

    # 3. è®¡ç®—æœ¬æ¬¡ä¹°å…¥é‡‘é¢
    buy_amount_usdt = available_amount * weight

    # 4. æ‰£é™¤æ‰‹ç»­è´¹
    fee_rate = 0.001
    fee = buy_amount_usdt * fee_rate
    actual_buy_usdt = buy_amount_usdt - fee

    # 5. è®¡ç®—ä¹°å…¥æ•°é‡
    buy_amount_eth = actual_buy_usdt / current_price

    # 6. ç¡®å®šå–å‡ºç›®æ ‡æ¯”ä¾‹
    if level_name == 'support_1':
        r1_pct, r2_pct = 50.0, 50.0
    elif level_name == 'support_2':
        r1_pct, r2_pct = 70.0, 30.0
    else:
        raise ValueError(f"Unknown level: {level_name}")

    # 7. åˆ›å»ºæŒä»“è®°å½•
    position = GridPosition.objects.create(
        backtest_result_id=backtest_result_id,
        buy_level=level_name,
        buy_price=current_price,
        buy_time=current_time,
        buy_amount=buy_amount_eth,
        buy_cost=buy_amount_usdt,  # å«æ‰‹ç»­è´¹
        buy_zone_weight=weight,

        # è®°å½•å½“å‰çš„å‹åŠ›ä½ï¼ˆåŠ¨æ€ï¼‰
        sell_target_r1_price=grid_levels['resistance_1']['price'],
        sell_target_r1_pct=r1_pct,
        sell_target_r1_sold=0,
        sell_target_r1_zone_low=grid_levels['resistance_1']['zone_low'],
        sell_target_r1_zone_high=grid_levels['resistance_1']['zone_high'],

        sell_target_r2_price=grid_levels['resistance_2']['price'],
        sell_target_r2_pct=r2_pct,
        sell_target_r2_sold=0,
        sell_target_r2_zone_low=grid_levels['resistance_2']['zone_low'],
        sell_target_r2_zone_high=grid_levels['resistance_2']['zone_high'],

        total_sold_amount=0,
        total_revenue=0,
        pnl=0,
        status='open'
    )

    # 8. æ‰£é™¤ç°é‡‘
    current_cash -= buy_amount_usdt

    return buy_amount_eth
```

---

### å–å‡ºæµç¨‹

```python
def check_sell_signals(current_price, grid_levels):
    """æ£€æŸ¥æ˜¯å¦è§¦å‘å–å‡º"""

    # éå†å‹åŠ›ä½
    for target_level in ['resistance_1', 'resistance_2']:
        level_info = grid_levels[target_level]

        # æ£€æŸ¥ä»·æ ¼æ˜¯å¦åœ¨åŒºé—´å†…
        if not (level_info['zone_low'] <= current_price <= level_info['zone_high']):
            continue

        # æŸ¥æ‰¾éœ€è¦åœ¨æ­¤å‹åŠ›ä½å–å‡ºçš„ä»“ä½
        execute_progressive_sell_at_level(
            target_level=target_level,
            current_price=current_price,
            level_info=level_info
        )


def execute_progressive_sell_at_level(target_level, current_price, level_info):
    """
    åœ¨æŒ‡å®šå‹åŠ›ä½æ‰§è¡Œæ¸è¿›å¼å–å‡º

    Args:
        target_level: 'resistance_1' / 'resistance_2'
        current_price: å½“å‰ä»·æ ¼
        level_info: {'price': 3100, 'zone_low': 3080, 'zone_high': 3120}
    """
    # 1. æŸ¥æ‰¾éœ€è¦åœ¨æ­¤å‹åŠ›ä½å–å‡ºçš„æŒä»“
    if target_level == 'resistance_1':
        # æ‰¾åˆ°æ‰€æœ‰R1è¿˜æ²¡å–å®Œçš„ä»“ä½
        positions = GridPosition.objects.filter(
            status__in=['open', 'partial'],
            sell_target_r1_zone_low__lte=current_price,
            sell_target_r1_zone_high__gte=current_price
        )
        target_field_prefix = 'sell_target_r1'
    else:  # resistance_2
        positions = GridPosition.objects.filter(
            status__in=['open', 'partial'],
            sell_target_r2_zone_low__lte=current_price,
            sell_target_r2_zone_high__gte=current_price
        )
        target_field_prefix = 'sell_target_r2'

    # 2. éå†æ¯ä¸ªä»“ä½ï¼Œæ‰§è¡Œæ¸è¿›å¼å–å‡º
    for pos in positions:
        # è®¡ç®—è¯¥ä»“ä½åœ¨æ­¤å‹åŠ›ä½çš„ç›®æ ‡æ•°é‡
        target_pct = getattr(pos, f'{target_field_prefix}_pct')
        target_amount = pos.buy_amount * (target_pct / 100.0)

        # è®¡ç®—å·²å–æ•°é‡
        sold_amount = getattr(pos, f'{target_field_prefix}_sold')

        # è®¡ç®—å‰©ä½™éœ€å–æ•°é‡
        remaining = target_amount - sold_amount

        if remaining <= 0.0001:  # å·²å–å®Œ
            continue

        # è®¡ç®—å–å‡ºæƒé‡
        zone_low = getattr(pos, f'{target_field_prefix}_zone_low')
        zone_high = getattr(pos, f'{target_field_prefix}_zone_high')

        distance_pct = (current_price - zone_low) / (zone_high - zone_low)
        distance_pct = max(0.0, min(1.0, distance_pct))

        import math
        k = 3.0
        weight = math.exp(-k * distance_pct)
        weight = max(0.05, min(1.0, weight))

        # æœ¬æ¬¡å–å‡ºæ•°é‡
        sell_amount = remaining * weight

        # è®¡ç®—å–å‡ºæ”¶å…¥
        fee_rate = 0.001
        sell_revenue_before_fee = sell_amount * current_price
        fee = sell_revenue_before_fee * fee_rate
        sell_revenue = sell_revenue_before_fee - fee

        # æ›´æ–°ä»“ä½è®°å½•
        setattr(pos, f'{target_field_prefix}_sold',
                sold_amount + sell_amount)

        pos.total_sold_amount += sell_amount
        pos.total_revenue += sell_revenue
        pos.pnl = pos.total_revenue - pos.buy_cost

        # æ›´æ–°çŠ¶æ€
        if pos.total_sold_amount >= pos.buy_amount * 0.9999:  # å…è®¸è¯¯å·®
            pos.status = 'closed'
        elif pos.total_sold_amount > 0:
            pos.status = 'partial'

        pos.save()

        # å¢åŠ ç°é‡‘
        current_cash += sell_revenue
```

---

### æ­¢æŸæµç¨‹

```python
def check_stop_loss(current_price, grid_levels):
    """
    ç®±ä½“æ­¢æŸæ£€æŸ¥ï¼ˆå¤šå¤´å’Œç©ºå¤´ï¼‰

    Args:
        current_price: å½“å‰ä»·æ ¼
        grid_levels: å½“å‰ç½‘æ ¼å±‚çº§ä¿¡æ¯
    """
    stop_loss_pct = 0.03  # é»˜è®¤3%ï¼Œå¯é…ç½®

    # 1. å¤šå¤´æ­¢æŸæ£€æŸ¥
    support_2_zone_low = grid_levels['support_2']['zone_low']
    long_stop_boundary = support_2_zone_low * (1 - stop_loss_pct)

    if current_price < long_stop_boundary:
        # è§¦å‘å¤šå¤´æ­¢æŸ
        long_positions = GridPosition.objects.filter(
            buy_level__in=['support_1', 'support_2'],
            status__in=['open', 'partial']
        )

        for pos in long_positions:
            remaining_amount = pos.buy_amount - pos.total_sold_amount

            if remaining_amount <= 0.0001:
                continue

            # æŒ‰å½“å‰å¸‚ä»·å–å‡º
            fee_rate = 0.001
            sell_revenue_before_fee = remaining_amount * current_price
            fee = sell_revenue_before_fee * fee_rate
            sell_revenue = sell_revenue_before_fee - fee

            # æ›´æ–°ä»“ä½
            pos.total_sold_amount = pos.buy_amount
            pos.total_revenue += sell_revenue
            pos.pnl = pos.total_revenue - pos.buy_cost
            pos.status = 'closed'
            pos.save()

            # å¢åŠ ç°é‡‘
            current_cash += sell_revenue

    # 2. ç©ºå¤´æ­¢æŸæ£€æŸ¥
    resistance_2_zone_high = grid_levels['resistance_2']['zone_high']
    short_stop_boundary = resistance_2_zone_high * (1 + stop_loss_pct)

    if current_price > short_stop_boundary:
        # è§¦å‘ç©ºå¤´æ­¢æŸ
        short_positions = GridPosition.objects.filter(
            buy_level__in=['resistance_1', 'resistance_2'],
            status__in=['open', 'partial']
        )

        for pos in short_positions:
            remaining_amount = pos.buy_amount - pos.total_sold_amount

            if remaining_amount <= 0.0001:
                continue

            # æŒ‰å½“å‰å¸‚ä»·ä¹°å…¥å¹³ä»“
            fee_rate = 0.001
            buy_cost_before_fee = remaining_amount * current_price
            fee = buy_cost_before_fee * fee_rate
            buy_cost = buy_cost_before_fee + fee

            # æ›´æ–°ä»“ä½
            pos.total_sold_amount = pos.buy_amount
            pos.total_revenue -= buy_cost  # ç©ºå¤´å¹³ä»“æ˜¯æˆæœ¬
            pos.pnl = pos.total_revenue - pos.buy_cost
            pos.status = 'closed'
            pos.save()

            # å‡å°‘ç°é‡‘
            current_cash -= buy_cost
```

---

## ğŸ¯ é¢„æœŸç»“æœ

åœ¨éœ‡è¡å¸‚åœºï¼ˆETH 2500-3500ï¼Œ180å¤©ï¼‰ï¼š

| æŒ‡æ ‡ | ä¼ ç»Ÿå›ºå®šç½‘æ ¼ | ç®±ä½“ç½‘æ ¼ç­–ç•¥ v2.0 |
|------|------------|----------------|
| äº¤æ˜“æ¬¡æ•° | 4-10ç¬” | **50-100ç¬”** (æ¸è¿›å¼ä¹°å–) |
| ç½‘æ ¼è§¦å‘ | å¶å°” | **é¢‘ç¹** (æ¯æ¬¡è§¦ç¢°åŒºé—´éƒ½äº¤æ˜“) |
| ä»“ä½ç®¡ç† | ç®€å• | **æ™ºèƒ½** (æ¸è¿›å¼+å›ºå®šæ± ) |
| æ­¢ç›ˆæ–¹å¼ | å•ä¸€ç›®æ ‡ä»· | **åˆ†çº§æ­¢ç›ˆ** (å¤šå‹åŠ›ä½) |
| èµ„é‡‘åˆ©ç”¨ç‡ | ä½ | **é«˜** (ä»“ä½å¯é‡å¤ä½¿ç”¨) |
| é€‚åº”æ€§ | å·® | **å¼º** (ç®±ä½“æ­¢æŸä¿æŠ¤) |

**å…³é”®æå‡**ï¼š
- âœ… **æ¸è¿›å¼ä¹°å–**ï¼šåœ¨åŒºé—´å†…åˆ†æ‰¹å»ºä»“/å‡ä»“ï¼Œé™ä½å•ç‚¹é£é™©
- âœ… **å›ºå®šä»“ä½æ± **ï¼šæ¯ä¸ªç½‘æ ¼å±‚çº§æœ‰èµ„é‡‘ä¸Šé™ï¼Œé˜²æ­¢è¿‡åº¦ä¹°å…¥
- âœ… **åˆ†çº§æ­¢ç›ˆ**ï¼šå¤šä¸ªå‹åŠ›ä½æŒ‰æ¯”ä¾‹å–å‡ºï¼Œæé«˜ç›ˆåˆ©æ¦‚ç‡
- âœ… **ç®±ä½“æ­¢æŸ**ï¼šè¶…å‡ºç®±ä½“è¾¹ç•Œå…¨éƒ¨æ­¢æŸï¼Œä¿æŠ¤æœ¬é‡‘
- âœ… **éƒ¨åˆ†æˆäº¤**ï¼šæ”¯æŒéƒ¨åˆ†ä»“ä½æˆäº¤ï¼Œä¸‹æ¬¡è§¦å‘ä¹°æ»¡
- âœ… **æ•°æ®é©±åŠ¨**ï¼šåŸºäºæˆäº¤é‡åˆ†æçš„åŠ¨æ€ç½‘æ ¼ä»·æ ¼

---

## âœ… ç½‘æ ¼ä»·æ ¼è®¡ç®—æ–¹æ³•ï¼ˆå·²åœ¨é¡¹ç›®ä¸­å®ç°ï¼‰

æ ¹æ®é¡¹ç›®ä»£ç  `vp_squeeze/services/four_peaks_analyzer.py`ï¼Œç½‘æ ¼ä»·æ ¼è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š

### ç®—æ³•æµç¨‹

```mermaid
flowchart TD
    A[å¼€å§‹] --> B[èšåˆå¤šå‘¨æœŸæˆäº¤é‡çƒ­åŠ›å›¾]
    B --> C[è¯†åˆ«æˆäº¤é‡é›†ä¸­åŒºé—´<br/>æ»‘åŠ¨çª—å£]
    C --> D[ç­›é€‰: å½“å‰ä»·Â±15%èŒƒå›´]
    D --> E[é€‰æ‹©4ä¸ªåŒºé—´<br/>ä¸Šä¸‹å„2ä¸ª]
    E --> F[æå–åŒºé—´è¾¹ç•Œ]
    F --> G{å‹åŠ›ä½?}
    G -->|æ˜¯| H[ä½¿ç”¨åŒºé—´ä½ä»·]
    G -->|å¦| I[ä½¿ç”¨åŒºé—´é«˜ä»·]
    H --> J[MA25è°ƒæ•´]
    I --> J
    J --> K[ç”ŸæˆKeyLevel]

    style B fill:#e8f4f8
    style C fill:#fff4e6
    style F fill:#ffd700
    style J fill:#90EE90
```

### è¯¦ç»†æ­¥éª¤

#### 1. èšåˆå¤šå‘¨æœŸæˆäº¤é‡ï¼ˆaggregate_volume_heatmapï¼‰

```python
# æ—¶é—´å‘¨æœŸæƒé‡
weights = {
    '4h': 1.5,   # 4å°æ—¶æƒé‡æœ€é«˜
    '1h': 1.2,   # 1å°æ—¶æ¬¡ä¹‹
    '15m': 1.0   # 15åˆ†é’ŸåŸºå‡†
}

# èšåˆæ‰€æœ‰å‘¨æœŸçš„æˆäº¤é‡
heatmap = {}  # {price: total_volume}
for analysis in analyses:
    for price, volume in analysis.volume_profile.items():
        heatmap[price] += volume * weights[analysis.timeframe]
```

#### 2. è¯†åˆ«æˆäº¤é‡é›†ä¸­åŒºé—´ï¼ˆfind_volume_clusters_by_windowï¼‰

**å…³é”®å‚æ•°**ï¼š
- `window_size`: 5ä¸ªä»·æ ¼æ¡¶
- `price_range_pct`: 15% ï¼ˆåªçœ‹å½“å‰ä»·Â±15%èŒƒå›´ï¼‰

```python
# æ»‘åŠ¨çª—å£æ‰«æ
for i in range(len(prices) - window_size + 1):
    window_prices = prices[i:i+5]

    # è®¡ç®—åŒºé—´
    price_low = window_prices[0]
    price_high = window_prices[-1]
    price_center = (price_low + price_high) / 2

    # è¿‡æ»¤ï¼šå¿½ç•¥è¶…å‡ºÂ±15%çš„åŒºé—´
    if price_center < current_price * 0.85:
        continue
    if price_center > current_price * 1.15:
        continue

    # è®¡ç®—åŒºé—´æ€»æˆäº¤é‡
    total_volume = sum(heatmap[p] for p in window_prices)

    clusters.append({
        'price_center': price_center,
        'price_low': price_low,
        'price_high': price_high,
        'volume': total_volume
    })

# æŒ‰æ€»æˆäº¤é‡é™åºæ’åº
clusters.sort(key=lambda c: c.volume, reverse=True)
```

#### 3. é€‰æ‹©4ä¸ªåŒºé—´ï¼ˆselect_four_clustersï¼‰

**è§„åˆ™**ï¼š
- åˆ†ä¸ºä¸Šä¸‹ä¸¤ç»„ï¼ˆä»¥å½“å‰ä»·æ ¼ä¸ºç•Œï¼‰
- æ¯ç»„é€‰2ä¸ªæˆäº¤é‡æœ€å¤§çš„
- **æœ€å°é—´è·**: 5%ï¼ˆé¿å…é‡å ï¼‰

```python
# åˆ†ç±»
below_clusters = [c for c in clusters if c.price_center < current_price]
above_clusters = [c for c in clusters if c.price_center > current_price]

# ç­›é€‰æ»¡è¶³5%é—´è·çš„
selected_below = []  # æœ€å¤š2ä¸ª
selected_above = []  # æœ€å¤š2ä¸ª

# ç¡®ä¿ç›¸é‚»åŒºé—´è‡³å°‘ç›¸è·5%
for cluster in below_clusters:
    if all(abs(cluster.price - sel.price) / current_price >= 0.05
           for sel in selected_below):
        selected_below.append(cluster)
        if len(selected_below) >= 2:
            break
```

#### 4. æå–åŒºé—´è¾¹ç•Œï¼ˆcreate_key_level_from_clusterï¼‰

**å…³é”®é€»è¾‘**ï¼š
```python
# å‹åŠ›ä½ï¼ˆresistanceï¼‰ï¼šä½¿ç”¨åŒºé—´ä½ä»·ï¼ˆæ›´ä¿å®ˆï¼‰
if level_type in ['resistance1', 'resistance2']:
    base_price = cluster.price_low

# æ”¯æ’‘ä½ï¼ˆsupportï¼‰ï¼šä½¿ç”¨åŒºé—´é«˜ä»·ï¼ˆæ›´ä¿å®ˆï¼‰
else:
    base_price = cluster.price_high
```

#### 5. MA25è°ƒæ•´ï¼ˆadjust_price_with_ma25ï¼‰

**è§„åˆ™**ï¼šå¦‚æœä»·æ ¼è·ç¦»MA25 < 2%ï¼Œè°ƒæ•´åˆ°MA25

```python
def adjust_price_with_ma25(price, ma25):
    if ma25 is None:
        return price, False

    distance_pct = abs(price - ma25) / price

    if distance_pct < 0.02:  # 2%é˜ˆå€¼
        return ma25, True  # è°ƒæ•´åˆ°MA25
    else:
        return price, False  # ä¸è°ƒæ•´
```

### ç¤ºä¾‹è®¡ç®—

å‡è®¾å½“å‰ETHä»·æ ¼ = 3000 USDTï¼š

```
1. èšåˆæˆäº¤é‡çƒ­åŠ›å›¾
   - 4hå‘¨æœŸæˆäº¤é‡ Ã— 1.5
   - 1hå‘¨æœŸæˆäº¤é‡ Ã— 1.2
   - 15må‘¨æœŸæˆäº¤é‡ Ã— 1.0

2. è¯†åˆ«åŒºé—´ï¼ˆÂ±15%èŒƒå›´ï¼š2550-3450ï¼‰
   - åŒºé—´A: 2680-2720, ä¸­å¿ƒ2700, æ€»æˆäº¤é‡50000
   - åŒºé—´B: 2860-2900, ä¸­å¿ƒ2880, æ€»æˆäº¤é‡45000
   - åŒºé—´C: 3080-3120, ä¸­å¿ƒ3100, æ€»æˆäº¤é‡48000
   - åŒºé—´D: 3260-3300, ä¸­å¿ƒ3280, æ€»æˆäº¤é‡42000
   ...

3. é€‰æ‹©Top4ï¼ˆæ»¡è¶³5%é—´è·ï¼‰
   - ä¸‹æ–¹: åŒºé—´A(2700), åŒºé—´B(2880)
   - ä¸Šæ–¹: åŒºé—´C(3100), åŒºé—´D(3280)

4. æå–è¾¹ç•Œ
   - support2 = åŒºé—´A.price_high = 2720
   - support1 = åŒºé—´B.price_high = 2900
   - resistance1 = åŒºé—´C.price_low = 3080
   - resistance2 = åŒºé—´D.price_low = 3260

5. MA25è°ƒæ•´ï¼ˆå‡è®¾MA25=2905ï¼‰
   - support1: 2900 â†’ 2905 (è·ç¦»<2%, è°ƒæ•´åˆ°MA25)
   - å…¶ä»–: ä¿æŒä¸å˜

æœ€ç»ˆç½‘æ ¼ï¼š
  â”œâ”€ resistance2: 3260
  â”œâ”€ resistance1: 3080
  â”œâ”€ [å½“å‰ä»·æ ¼ 3000]
  â”œâ”€ support1: 2905 (MA25è°ƒæ•´)
  â””â”€ support2: 2720
```

### å…³é”®ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **æ•°æ®é©±åŠ¨** | åŸºäºå¤šå‘¨æœŸæˆäº¤é‡åˆ†æï¼Œéå›ºå®šç™¾åˆ†æ¯” |
| **åŠ¨æ€è®¡ç®—** | æ¯æ¬¡åˆ†ææ—¶é‡æ–°è®¡ç®—ï¼Œé€‚åº”å¸‚åœºå˜åŒ– |
| **ä¿å®ˆè¾¹ç•Œ** | å‹åŠ›ç”¨ä½ä»·ï¼Œæ”¯æ’‘ç”¨é«˜ä»·ï¼Œé™ä½å‡çªç ´ |
| **MAå¯¹é½** | ä»·æ ¼æ¥è¿‘MA25æ—¶è‡ªåŠ¨è°ƒæ•´ï¼Œæé«˜å‡†ç¡®æ€§ |
| **èŒƒå›´é™åˆ¶** | åªçœ‹Â±15%èŒƒå›´ï¼Œé¿å…è¿‡è¿œçš„æ— æ•ˆç‚¹ä½ |
| **é—´è·ä¿è¯** | ç›¸é‚»ç½‘æ ¼è‡³å°‘5%ï¼Œé¿å…è¿‡å¯† |

---

### âœ… å·²ç¡®å®šç­–ç•¥ç»†èŠ‚ï¼ˆ2025-11-30 æœ€ç»ˆç‰ˆï¼‰

| ç­–ç•¥é¡¹ | ç¡®å®šæ–¹æ¡ˆ | è¯´æ˜ |
|--------|---------|------|
| **ç½‘æ ¼åŒºé—´** | FourPeaksAnalyzer åŸå§‹åŒºé—´ | ä½¿ç”¨ price_low ~ price_high |
| **ç½‘æ ¼æ›´æ–°** | **æ¯æ ¹Kçº¿é‡æ–°è®¡ç®—** | åŠ¨æ€é€‚åº”å¸‚åœºå˜åŒ– |
| **ä¹°å…¥æƒé‡** | æŒ‡æ•°è¡°å‡å‡½æ•° | è¶Šæ¥è¿‘åŒºé—´ä¸‹ç•Œä¹°å…¥è¶Šå¤šï¼ˆè§ä¸‹æ–¹ç®—æ³•ï¼‰ |
| **å–å‡ºæƒé‡** | æŒ‡æ•°è¡°å‡å‡½æ•° | è¶Šæ¥è¿‘åŒºé—´ä¸‹ç•Œå–å‡ºè¶Šå¤š |
| **æ‰‹ç»­è´¹** | ä»æŠ•å…¥é‡‘é¢ä¸­æ‰£é™¤ | ç¬¦åˆå®é™…äº¤æ˜“é€»è¾‘ |
| **ä»“ä½ç®¡ç†** | **ç‹¬ç«‹ä»“ä½ + ç°é‡‘çº¦æŸ** | æ¯ä¸ªä»“ä½ç‹¬ç«‹ï¼Œåªå—ç°é‡‘é™åˆ¶ |
| **ç†è®ºä¸Šé™** | æ”¯æ’‘1â‰¤20%ï¼Œæ”¯æ’‘2â‰¤30% | æ¯ä¸ªå±‚çº§çš„æœ€å¤§æŠ•å…¥æ¯”ä¾‹ |
| **å®é™…ä¹°å…¥** | `min(ç†è®ºå‰©ä½™, å¯ç”¨ç°é‡‘)` | åŒé‡çº¦æŸ |
| **æ­¢ç›ˆåˆ†é…** | æ”¯æ’‘1â†’R1(50%)+R2(50%)<br/>æ”¯æ’‘2â†’R1(70%)+R2(30%) | ä¹°å…¥æ—¶è®°å½•åŠ¨æ€ç›®æ ‡ä»· |
| **ç®±ä½“æ­¢æŸ** | è·Œç ´æ”¯æ’‘2-3%ï¼ˆå¯é…ç½®ï¼‰ | å…¨éƒ¨å¹³ä»“ä¿æŠ¤æœ¬é‡‘ |

---

### ğŸ“ ä¹°å…¥æƒé‡ç®—æ³•ï¼ˆæ–°å¢ï¼‰

**åŸåˆ™**ï¼šè¶Šä½ä¹°è¶Šå¤šï¼Œä½†è¦å¹³æ»‘åˆ†å¸ƒ

**æ¨èæ–¹æ¡ˆï¼šæŒ‡æ•°è¡°å‡å‡½æ•°**

```python
def calculate_buy_weight(current_price, zone_low, zone_high):
    """
    è®¡ç®—ä¹°å…¥æƒé‡ï¼ˆè¶Šæ¥è¿‘zone_lowæƒé‡è¶Šå¤§ï¼‰

    Args:
        current_price: å½“å‰ä»·æ ¼ (å¦‚2945)
        zone_low: åŒºé—´ä¸‹ç•Œ (å¦‚2930)
        zone_high: åŒºé—´ä¸Šç•Œ (å¦‚2950)

    Returns:
        weight: 0.05 ~ 1.0 (5%~100%)
    """
    # 1. è®¡ç®—è·ç¦»ç™¾åˆ†æ¯”ï¼ˆ0=ä¸‹ç•Œï¼Œ1=ä¸Šç•Œï¼‰
    distance_pct = (current_price - zone_low) / (zone_high - zone_low)
    distance_pct = max(0.0, min(1.0, distance_pct))  # é™åˆ¶0-1

    # 2. æŒ‡æ•°è¡°å‡ï¼šè¶Šæ¥è¿‘ä¸‹ç•Œï¼Œæƒé‡è¶Šå¤§
    # ä½¿ç”¨æŒ‡æ•°å‡½æ•°: weight = exp(-k * distance)
    # k=3: è¾ƒå¹³æ»‘ï¼Œä¸‹ç•Œ100%ï¼Œä¸­ç‚¹50%ï¼Œä¸Šç•Œ5%
    k = 3.0
    weight = math.exp(-k * distance_pct)

    # 3. å½’ä¸€åŒ–åˆ° 5%~100%
    # distance=0 â†’ weight=1.0 (100%)
    # distance=0.5 â†’ weight=0.22 (22%)
    # distance=1.0 â†’ weight=0.05 (5%)

    return max(0.05, min(1.0, weight))
```

**æƒé‡åˆ†å¸ƒå¯¹æ¯”**ï¼š

| ä»·æ ¼ä½ç½® | è·ç¦»% | æŒ‡æ•°è¡°å‡(k=3) | å¹³æ–¹å‡½æ•° | çº¿æ€§å‡½æ•° |
|---------|------|-------------|---------|---------|
| 2930 (ä¸‹ç•Œ) | 0% | **100%** | 100% | 100% |
| 2935 | 25% | **47%** | 56% | 75% |
| 2940 | 50% | **22%** | 25% | 50% |
| 2945 | 75% | **11%** | 6% | 25% |
| 2950 (ä¸Šç•Œ) | 100% | **5%** | 5% | 5% |

**ä¸ºä»€ä¹ˆé€‰æ‹©æŒ‡æ•°è¡°å‡**ï¼š
- âœ… åœ¨ä¸‹ç•Œé™„è¿‘æƒé‡è¡°å‡è¾ƒæ…¢ï¼ˆ47%@25%ï¼‰ï¼Œå®¹é”™æ€§å¥½
- âœ… åœ¨ä¸Šç•Œé™„è¿‘æƒé‡å¿«é€Ÿè¡°å‡ï¼ˆ11%@75%ï¼‰ï¼Œé¿å…é«˜ä½ä¹°å…¥
- âœ… å¹³æ»‘è¿‡æ¸¡ï¼Œç¬¦åˆå®é™…äº¤æ˜“å¿ƒç†

**å¯è°ƒå‚æ•° k**ï¼š
- k=2: æ›´å¹³æ»‘ï¼ˆä¸­ç‚¹37%ï¼‰
- k=3: æ¨èï¼ˆä¸­ç‚¹22%ï¼‰
- k=4: æ›´æ¿€è¿›ï¼ˆä¸­ç‚¹14%ï¼‰

---

## âœ… æœ€ç»ˆç¡®è®¤æ‘˜è¦

### ç­–ç•¥å‚æ•°ï¼ˆå·²ç¡®å®šï¼‰

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| **ç½‘æ ¼åŒºé—´** | FourPeaksAnalyzer åŸå§‹åŒºé—´ | ä½¿ç”¨ price_low ~ price_high |
| **ä¹°å…¥æƒé‡** | æŒ‡æ•°è¡°å‡ (k=3) | `weight = exp(-3 * distance)` |
| **å–å‡ºæƒé‡** | æŒ‡æ•°è¡°å‡ (k=3) | åŒä¹°å…¥ |
| **ç½‘æ ¼æ›´æ–°** | **æ¯æ ¹Kçº¿è®¡ç®—** | åŠ¨æ€é€‚åº”å¸‚åœº |
| **æ‰‹ç»­è´¹** | ä»æŠ•å…¥é‡‘é¢æ‰£é™¤ | 0.1% |
| **æ”¯æ’‘ä½1ä¸Šé™** | 20% | åˆå§‹èµ„é‡‘çš„20% |
| **æ”¯æ’‘ä½2ä¸Šé™** | 30% | åˆå§‹èµ„é‡‘çš„30% |
| **æ­¢æŸé˜ˆå€¼** | 3%ï¼ˆå¯é…ç½®ï¼‰ | æ”¯æ’‘ä½2-3% |
| **æ­¢ç›ˆåˆ†é…** | S1â†’R1(50%)+R2(50%)<br/>S2â†’R1(70%)+R2(30%) | åˆ†çº§æ­¢ç›ˆ |

---

### æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ¯æ ¹Kçº¿è§¦å‘ï¼ˆ4hå‘¨æœŸï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  åŠ¨æ€è®¡ç®—æœ€æ–°ç½‘æ ¼ä»·æ ¼   â”‚
        â”‚  (FourPeaksAnalyzer)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
            â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ä¹°å…¥æ£€æŸ¥  â”‚    â”‚ å–å‡ºæ£€æŸ¥  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚               â”‚
            â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ åˆ›å»ºç‹¬ç«‹ä»“ä½  â”‚ â”‚ æ›´æ–°ä»“ä½çŠ¶æ€ â”‚
    â”‚ (GridPosition)â”‚ â”‚ (æ¸è¿›å¼å–å‡º) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  æ›´æ–°ç°é‡‘ä½™é¢ â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. å®Œæ•´äº¤æ˜“ç¤ºä¾‹ï¼ˆ30å¤©æ¨¡æ‹Ÿï¼‰

### 7.1 åœºæ™¯è®¾å®š

- åˆå§‹èµ„é‡‘: 10000 USDT
- å›æµ‹å‘¨æœŸ: 30å¤©ï¼ˆ180æ ¹4h Kçº¿ï¼‰
- äº¤æ˜“å¯¹: ETHUSDT
- åˆå§‹ä»·æ ¼: 3000 USDT

### 7.2 Day 1-5: ä¸‹è·Œé˜¶æ®µå»ºä»“

```mermaid
gantt
    title ETHä»·æ ¼èµ°åŠ¿ (Day 1-5)
    dateFormat YYYY-MM-DD
    axisFormat %m-%d

    section ä»·æ ¼èµ°åŠ¿
    3000 â†’ 2950 ä¸‹è·Œ      :2025-01-01, 2d
    2950 â†’ 2900 è·Œç ´S1    :2d
    2900 â†’ 2800 ç»§ç»­ä¸‹è·Œ  :1d

    section ç®±ä½“çŠ¶æ€
    ç®±ä½“1 S1=2900          :crit, 2025-01-01, 2d
    ç®±ä½“2 S1=2880 ä¸‹ç§»     :active, 2d
    ç®±ä½“3 S1=2850 ç»§ç»­ä¸‹ç§» :1d
```

**äº¤æ˜“è®°å½•**ï¼š

| æ—¶é—´ | ä»·æ ¼ | ç®±ä½“çŠ¶æ€ | è§¦å‘åŠ¨ä½œ | ä»“ä½ | ç°é‡‘ |
|------|------|---------|---------|------|------|
| Day1 00:00 | 3000 | åˆå§‹ç®±ä½“ S1=2900 S2=2700 | - | 0 | 10000 |
| Day1 20:00 | 2910 | è¿›å…¥S1åŒºé—´ | ä¹°å…¥220 USDT (æ”¯æ’‘1) | 0.075 ETH | 9780 |
| Day2 12:00 | 2895 | S1åŒºé—´ | ä¹°å…¥552 USDT (æ”¯æ’‘1) | 0.266 ETH | 9228 |
| Day3 00:00 | 2880 | ç®±ä½“ä¸‹ç§» S1=2880 | ä¹°æ»¡æ”¯æ’‘1 836 USDT | 0.556 ETH | 8392 |
| Day4 08:00 | 2720 | è¿›å…¥S2åŒºé—´ | ä¹°å…¥2100 USDT (æ”¯æ’‘2) | 1.328 ETH | 6292 |
| Day4 20:00 | 2700 | S2åŒºé—´ | ä¹°å…¥600 USDT (æ”¯æ’‘2) | 1.550 ETH | 5692 |

**ä»“ä½æ˜ç»†**ï¼š

```
æ”¯æ’‘ä½1ä»“ä½ï¼ˆå·²ä¹°æ»¡2000 USDTï¼‰:
â”œâ”€ ä»“ä½#1: 220 USDT @ 2910, ç›®æ ‡R1=3100, R2=3300
â”œâ”€ ä»“ä½#2: 552 USDT @ 2895, ç›®æ ‡R1=3080, R2=3280
â””â”€ ä»“ä½#3: 836 USDT @ 2880, ç›®æ ‡R1=3080, R2=3280

æ”¯æ’‘ä½2ä»“ä½ï¼ˆå·²æŠ•å…¥2700 USDTï¼Œå‰©ä½™300ï¼‰:
â”œâ”€ ä»“ä½#4: 2100 USDT @ 2720, ç›®æ ‡R1=3080, R2=3280
â””â”€ ä»“ä½#5: 600 USDT @ 2700, ç›®æ ‡R1=3080, R2=3280

æŒä»“æ€»ä»·å€¼: 1.550 ETH Ã— 2700 = 4185 USDT
è´¦æˆ·æ€»ä»·å€¼: 5692 + 4185 = 9877 USDT (æµ®äº1.23%)
```

### 7.3 Day 6-15: åå¼¹é˜¶æ®µæ­¢ç›ˆ

```mermaid
gantt
    title ETHä»·æ ¼èµ°åŠ¿ (Day 6-15)
    dateFormat YYYY-MM-DD
    axisFormat %m-%d

    section ä»·æ ¼èµ°åŠ¿
    2700 â†’ 2900 åå¼¹        :2025-01-06, 3d
    2900 â†’ 3100 çªç ´R1      :3d
    3100 â†’ 3200 å†²é«˜        :2d
    3200 â†’ 3100 å›è°ƒ        :2d

    section æ­¢ç›ˆåŠ¨ä½œ
    å¼€å§‹å–å‡ºR1              :milestone, 2025-01-09, 0d
    R1å…¨éƒ¨å–å®Œ              :milestone, 2025-01-11, 0d
```

**Day 9 (ä»·æ ¼æ¶¨è‡³3085, è§¦å‘R1åŒºé—´)**ï¼š

| ä»“ä½ | R1ç›®æ ‡ | æœ¬æ¬¡å–å‡º | å–å‡ºæ•°é‡ | æ”¶å…¥ |
|------|--------|---------|---------|------|
| #1 | 50% (0.038 ETH) | 71% | 0.027 ETH | 83 USDT |
| #2 | 50% (0.095 ETH) | 71% | 0.067 ETH | 207 USDT |
| #3 | 50% (0.145 ETH) | 71% | 0.103 ETH | 318 USDT |
| #4 (S2) | 70% (0.537 ETH) | 71% | 0.381 ETH | 1175 USDT |
| #5 (S2) | 70% (0.155 ETH) | 71% | 0.110 ETH | 339 USDT |
| **åˆè®¡** | - | - | 0.688 ETH | 2122 USDT |

**æ›´æ–°åçŠ¶æ€**ï¼š
- ç°é‡‘: 5692 + 2122 = 7814 USDT
- å‰©ä½™æŒä»“: 0.862 ETH
- è´¦æˆ·æ€»ä»·å€¼: 7814 + 0.862Ã—3085 = 10473 USDT (ç›ˆåˆ©4.73%)

**Day 11 (ä»·æ ¼æ¶¨è‡³3120, R1å…¨éƒ¨å–å®Œ)**ï¼š

| ä»“ä½ | R1å‰©ä½™ | å…¨éƒ¨å–å‡º | æ”¶å…¥ |
|------|--------|---------|------|
| æ‰€æœ‰ä»“ä½ | 29% | 0.196 ETH | 612 USDT |

**æ›´æ–°åçŠ¶æ€**ï¼š
- ç°é‡‘: 7814 + 612 = 8426 USDT
- å‰©ä½™æŒä»“: 0.666 ETH (å…¨éƒ¨æ˜¯R2ç›®æ ‡50%æˆ–30%)
- è´¦æˆ·æ€»ä»·å€¼: 8426 + 0.666Ã—3120 = 10504 USDT (ç›ˆåˆ©5.04%)

### 7.4 Day 16-20: è§¦å‘æ­¢æŸ

```mermaid
gantt
    title ETHä»·æ ¼èµ°åŠ¿ (Day 16-20)
    dateFormat YYYY-MM-DD
    axisFormat %m-%d

    section ä»·æ ¼èµ°åŠ¿
    3100 â†’ 2950 ä¸‹è·Œ        :2025-01-16, 2d
    2950 â†’ 2700 åŠ é€Ÿä¸‹è·Œ    :2d
    2700 â†’ 2600 è·Œç ´æ­¢æŸ    :1d

    section æ­¢æŸè§¦å‘
    è·Œç ´ç®±åº•-3%             :crit, milestone, 2025-01-20, 0d
```

**Day 20 (ä»·æ ¼è·Œè‡³2600, è§¦å‘ç®±ä½“æ­¢æŸ)**ï¼š

```
æ­¢æŸè¾¹ç•Œè®¡ç®—:
â”œâ”€ å½“å‰ç®±ä½“æ”¯æ’‘ä½2: 2680
â”œâ”€ æ­¢æŸé˜ˆå€¼: 3%
â””â”€ æ­¢æŸä»·æ ¼: 2680 Ã— (1-3%) = 2600 âœ… è§¦å‘

å‰©ä½™æŒä»“: 0.666 ETH
æ­¢æŸå–å‡º: 0.666 ETH @ 2600 = 1732 USDT (æ‰£è´¹å)

æœ€ç»ˆçŠ¶æ€:
â”œâ”€ ç°é‡‘: 8426 + 1732 = 10158 USDT
â”œâ”€ æŒä»“: 0 ETH
â””â”€ æ€»ä»·å€¼: 10158 USDT (ç›ˆåˆ©1.58%)
```

### 7.5 Day 21-30: é‡æ–°å»ºä»“

```mermaid
gantt
    title ETHä»·æ ¼èµ°åŠ¿ (Day 21-30)
    dateFormat YYYY-MM-DD
    axisFormat %m-%d

    section ä»·æ ¼èµ°åŠ¿
    2600 â†’ 2800 åå¼¹        :2025-01-21, 3d
    2800 â†’ 2900 ç»§ç»­ä¸Šæ¶¨    :3d
    2900 â†’ 3000 æ¢å¤        :4d

    section ç®±ä½“æ›´æ–°
    æ­¢æŸåé‡æ–°è®¡ç®—ç®±ä½“      :milestone, 2025-01-21, 0d
    æ–°ç®±ä½“ S1=2780 S2=2600  :2025-01-21, 10d
```

**æ€»ç»“**ï¼š
- åˆå§‹èµ„é‡‘: 10000 USDT
- æœ€ç»ˆä»·å€¼: 10158 USDT
- å‡€æ”¶ç›Š: 158 USDT (1.58%)
- äº¤æ˜“æ¬¡æ•°: çº¦25ç¬”ï¼ˆä¹°å…¥10ç¬” + å–å‡º12ç¬” + æ­¢æŸ3ç¬”ï¼‰
- æœ€å¤§å›æ’¤: -1.23%

---

## 10. å¸¸è§é—®é¢˜è§£ç­”ï¼ˆFAQï¼‰

### Q1: å¦‚æœä»·æ ¼åœ¨åŒºé—´å†…æ¨ªç›˜ï¼Œä¼šé‡å¤ä¹°å…¥å—ï¼Ÿ

**A**: ä¼šçš„ï¼è¿™æ˜¯æ¸è¿›å¼ä¹°å…¥çš„ç‰¹ç‚¹ã€‚

```mermaid
graph LR
    A[ä»·æ ¼åœ¨2910æ¨ªç›˜] -->|ç¬¬1æ ¹Kçº¿| B[ä¹°å…¥11%]
    B -->|ç¬¬2æ ¹Kçº¿| C[ä¹°å…¥11%]
    C -->|ç¬¬3æ ¹Kçº¿| D[ä¹°å…¥11%]
    D -->|ç›´åˆ°ä¹°æ»¡| E[åœæ­¢ä¹°å…¥]
```

**é˜²æ­¢è¿‡åº¦ä¹°å…¥çš„æœºåˆ¶**ï¼š
1. **ç†è®ºä¸Šé™**ï¼šæ”¯æ’‘1æœ€å¤š2000 USDT
2. **å‰©ä½™èµ„é‡‘é€’å‡**ï¼šæ¯æ¬¡ä¹°å…¥åå¯ç”¨èµ„é‡‘å‡å°‘
3. **è‡ªç„¶åœæ­¢**ï¼šä¹°æ»¡åè‡ªåŠ¨åœæ­¢

### Q2: å¦‚æœç½‘æ ¼ä»·æ ¼å˜åŒ–å¤ªå¿«ï¼Œä¼šä¸ä¼šæ··ä¹±ï¼Ÿ

**A**: ä¸ä¼šï¼æ¯ä¸ªä»“ä½è®°å½•è‡ªå·±çš„ç›®æ ‡ä»·ã€‚

**ç¤ºä¾‹**ï¼š
```
Day 1: ä¹°å…¥ä»“ä½#1 @ 2900, è®°å½•ç›®æ ‡R1=3100
Day 2: ç½‘æ ¼æ›´æ–°ï¼ŒR1å˜æˆ3080
Day 3: ä¹°å…¥ä»“ä½#2 @ 2880, è®°å½•ç›®æ ‡R1=3080 (æ–°ä»·æ ¼)

å–å‡ºæ—¶:
â”œâ”€ ä»“ä½#1: ç­‰å¾…ä»·æ ¼åˆ°3100æ‰å– (è‡ªå·±çš„ç›®æ ‡)
â””â”€ ä»“ä½#2: ç­‰å¾…ä»·æ ¼åˆ°3080æ‰å– (è‡ªå·±çš„ç›®æ ‡)
```

### Q3: æ”¯æ’‘ä½1ä¹°æ»¡åï¼Œä»·æ ¼å†è·Œæ€ä¹ˆåŠï¼Ÿ

**A**: æ”¯æ’‘ä½2æ¥åŠ›ä¹°å…¥ï¼

```mermaid
flowchart TD
    A[æ”¯æ’‘ä½1ä¹°æ»¡2000] --> B{ä»·æ ¼ç»§ç»­ä¸‹è·Œ?}
    B -->|æ˜¯| C[è¿›å…¥æ”¯æ’‘ä½2åŒºé—´]
    C --> D[æ”¯æ’‘ä½2ä¹°å…¥æœ€å¤š3000]
    B -->|å¦| E[ç­‰å¾…åå¼¹å–å‡º]

    style A fill:#fff4e6
    style D fill:#d5f4e6
```

**æç«¯æƒ…å†µ**ï¼ˆä¸¤å±‚éƒ½ä¹°æ»¡ï¼‰ï¼š
- å·²æŠ•å…¥: 2000 + 3000 = 5000 USDT
- å‰©ä½™ç°é‡‘: 5000 USDT
- **æ­¤æ—¶åªèƒ½ç­‰å¾…åå¼¹å–å‡ºé‡Šæ”¾ç°é‡‘**

### Q4: æ­¢æŸåä¼šé‡æ–°ä¹°å…¥å—ï¼Ÿ

**A**: ä¼šï¼æ­¢æŸåç³»ç»Ÿé‡æ–°è®¡ç®—ç®±ä½“ã€‚

```
Day 20: è§¦å‘æ­¢æŸ @ 2600, å…¨éƒ¨å¹³ä»“
â”œâ”€ ç°é‡‘: 10158 USDT
â”œâ”€ æŒä»“: 0 ETH
â””â”€ é‡æ–°è®¡ç®—ç®±ä½“

Day 21: ä»·æ ¼2650, æ–°ç®±ä½“
â”œâ”€ æ”¯æ’‘ä½1: 2550 (åŒºé—´2530-2570)
â”œâ”€ æ”¯æ’‘ä½2: 2450 (åŒºé—´2430-2470)
â””â”€ å¯ä»¥é‡æ–°å¼€å§‹ä¹°å…¥
```

### Q5: å¦‚æœä»·æ ¼ä¸€ç›´æ¶¨ï¼Œæ²¡ä¹°åˆ°æ€ä¹ˆåŠï¼Ÿ

**A**: è¿™æ˜¯"è¸ç©ºé£é™©"ï¼Œç®±ä½“ç­–ç•¥çš„ç‰¹ç‚¹ã€‚

**åº”å¯¹**ï¼š
1. ç­‰å¾…å›è°ƒè¿›å…¥æ”¯æ’‘åŒºé—´
2. æˆ–è€…å–å‡ºå·²æœ‰ä»“ä½è·åˆ©ï¼ˆå¦‚æœæœ‰ï¼‰
3. **ä¸è¿½æ¶¨**ï¼šä¸¥æ ¼æŒ‰ç®±ä½“äº¤æ˜“

### Q6: æ‰‹ç»­è´¹ä¼šä¸ä¼šåƒæ‰åˆ©æ¶¦ï¼Ÿ

**A**: æ‰‹ç»­è´¹0.1%ï¼Œåœ¨ç­–ç•¥ä¸­å·²è€ƒè™‘ã€‚

**ç¤ºä¾‹è®¡ç®—**ï¼š
```
ä¹°å…¥2000 USDT:
â”œâ”€ æ‰‹ç»­è´¹: 2000 Ã— 0.001 = 2 USDT
â”œâ”€ å®é™…ä¹°å…¥: 1998 USDT
â””â”€ æ‰‹ç»­è´¹å æ¯”: 0.1%

å–å‡ºè·åˆ©200 USDT (10%æ”¶ç›Š):
â”œâ”€ å–å‡ºé‡‘é¢: 2200 USDT
â”œâ”€ æ‰‹ç»­è´¹: 2.2 USDT
â”œâ”€ å‡€æ”¶ç›Š: 197.8 USDT
â””â”€ æ‰‹ç»­è´¹å½±å“: 2.2/200 = 1.1%

æ€»ç»“: æ‰‹ç»­è´¹å½±å“å¾ˆå°ï¼Œåªè¦æ”¶ç›Š>1%å°±èƒ½è¦†ç›–
```

### Q7: å¤šå¤´å’Œç©ºå¤´æ­¢æŸæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**: å¯¹ç§°è®¾è®¡ï¼Œä¿æŠ¤ä¸åŒæ–¹å‘çš„ä»“ä½ã€‚

**å¯¹æ¯”è¡¨**ï¼š

| é¡¹ç›® | å¤šå¤´æ­¢æŸ | ç©ºå¤´æ­¢æŸ |
|------|---------|---------|
| **è§¦å‘ä»·æ ¼** | ä»·æ ¼ < æ”¯æ’‘2åŒºé—´ä¸‹ç•Œ - 3% | ä»·æ ¼ > å‹åŠ›2åŒºé—´ä¸Šç•Œ + 3% |
| **å¹³ä»“åŠ¨ä½œ** | å–å‡ºæ‰€æœ‰å¤šå¤´æŒä»“ | ä¹°å…¥å¹³æ‰æ‰€æœ‰ç©ºå¤´æŒä»“ |
| **ç°é‡‘æµå‘** | è·å¾—ç°é‡‘ï¼ˆäºæŸï¼‰ | æ”¯å‡ºç°é‡‘ï¼ˆäºæŸï¼‰ |
| **ä¿æŠ¤å¯¹è±¡** | é˜²æ­¢ç»§ç»­ä¸‹è·ŒäºæŸ | é˜²æ­¢ç»§ç»­ä¸Šæ¶¨äºæŸ |

**ç¤ºä¾‹**ï¼š

```
å½“å‰ç®±ä½“:
â”œâ”€ å‹åŠ›ä½2: 3320 (ä¸Šç•Œ)
â”œâ”€ æ”¯æ’‘ä½2: 2680 (ä¸‹ç•Œ)
â””â”€ æ­¢æŸé˜ˆå€¼: 3%

å¤šå¤´æ­¢æŸè¾¹ç•Œ: 2680 Ã— (1-3%) = 2599.60
  â””â”€ ä»·æ ¼è·Œç ´2599æ—¶ï¼Œå–å‡ºæ‰€æœ‰å¤šå¤´æŒä»“

ç©ºå¤´æ­¢æŸè¾¹ç•Œ: 3320 Ã— (1+3%) = 3419.60
  â””â”€ ä»·æ ¼çªç ´3419æ—¶ï¼Œä¹°å…¥å¹³æ‰æ‰€æœ‰ç©ºå¤´æŒä»“
```

### Q8: ç­–ç•¥æœ€é€‚åˆä»€ä¹ˆå¸‚åœºï¼Ÿ

**A**: éœ‡è¡å¸‚åœºï¼ˆç®±ä½“å¸‚ï¼‰ã€‚

| å¸‚åœºç±»å‹ | é€‚åˆåº¦ | è¯´æ˜ |
|---------|--------|------|
| æ¨ªç›˜éœ‡è¡ | â­â­â­â­â­ | æœ€ä½³ï¼Œåå¤ä¹°å–èµšå·®ä»· |
| ç¼“æ…¢ä¸Šæ¶¨ | â­â­â­â­ | è¾ƒå¥½ï¼Œä½ä½ä¹°å…¥é«˜ä½æ­¢ç›ˆ |
| ç¼“æ…¢ä¸‹è·Œ | â­â­â­ | ä¸€èˆ¬ï¼Œéœ€è¦ç®±ä½“æ­¢æŸä¿æŠ¤ |
| å•è¾¹æš´æ¶¨ | â­â­ | è¸ç©ºï¼Œä¹°ä¸åˆ°ï¼ˆç©ºå¤´æ­¢æŸä¿æŠ¤ï¼‰ |
| å•è¾¹æš´è·Œ | â­ | å±é™©ï¼ˆå¤šå¤´æ­¢æŸä¿æŠ¤ï¼‰ |

### Q9: å¦‚ä½•ä¼˜åŒ–å‚æ•°ï¼Ÿ

**å¯è°ƒå‚æ•°**ï¼š

| å‚æ•° | é»˜è®¤å€¼ | å¯é€‰èŒƒå›´ | å½±å“ |
|------|--------|---------|------|
| æ”¯æ’‘1ä¸Šé™ | 20% | 10-30% | æŠ•å…¥æ¯”ä¾‹ |
| æ”¯æ’‘2ä¸Šé™ | 30% | 20-40% | æŠ•å…¥æ¯”ä¾‹ |
| æ­¢æŸé˜ˆå€¼ | 3% | 2-5% | é£é™©æ‰¿å— |
| æƒé‡ç³»æ•°k | 3 | 2-4 | ä¹°å…¥æ¿€è¿›åº¦ |

**å»ºè®®**ï¼š
1. ä¿å®ˆ: æ”¯æ’‘1=15%, æ”¯æ’‘2=25%, æ­¢æŸ=5%
2. æ¿€è¿›: æ”¯æ’‘1=25%, æ”¯æ’‘2=35%, æ­¢æŸ=2%

---

## ğŸ“ æ–‡æ¡£å®Œæˆæ€»ç»“

æœ¬æ–‡æ¡£å·²åŒ…å«ï¼š

âœ… **ç­–ç•¥æ ¸å¿ƒæ€æƒ³**ï¼ˆå¸¦Mermaidæµç¨‹å›¾ + åŒå‘æ­¢æŸï¼‰
âœ… **ç½‘æ ¼ç®±ä½“è®¡ç®—**ï¼ˆFourPeaksAnalyzerç®—æ³•è¯¦è§£ï¼‰
âœ… **ä»“ä½ç®¡ç†æœºåˆ¶**ï¼ˆç°é‡‘çº¦æŸ+ç†è®ºä¸Šé™ï¼‰
âœ… **æ¸è¿›å¼ä¹°å…¥**ï¼ˆæŒ‡æ•°è¡°å‡æƒé‡å‡½æ•°+å®Œæ•´ç¤ºä¾‹ï¼‰
âœ… **åˆ†çº§æ­¢ç›ˆå–å‡º**ï¼ˆR1/R2åˆ†é…+æ”¶ç›Šè®¡ç®—ï¼‰
âœ… **ç®±ä½“æ­¢æŸæœºåˆ¶**ï¼ˆå¤šå¤´/ç©ºå¤´å¯¹ç§°æ­¢æŸï¼Œ3%å¯é…ç½®ï¼‰â­ å·²æ›´æ–°
âœ… **å®Œæ•´30å¤©äº¤æ˜“ç¤ºä¾‹**ï¼ˆå«å»ºä»“/æ­¢ç›ˆ/æ­¢æŸ/é‡å»ºï¼‰
âœ… **æ•°æ®åº“è®¾è®¡**ï¼ˆGridPositionè¡¨ç»“æ„ï¼‰
âœ… **æ ¸å¿ƒä»£ç ç®—æ³•**ï¼ˆPythonä¼ªä»£ç ï¼Œå«åŒå‘æ­¢æŸï¼‰â­ å·²æ›´æ–°
âœ… **å¸¸è§é—®é¢˜è§£ç­”**ï¼ˆ9ä¸ªFAQï¼Œæ–°å¢æ­¢æŸå¯¹æ¯”ï¼‰â­ å·²æ›´æ–°

**æ–‡æ¡£ç‰¹ç‚¹**ï¼š
- ğŸ¨ å¤§é‡Mermaidå›¾è¡¨å¯è§†åŒ–ï¼ˆ35+å›¾è¡¨ï¼‰
- ğŸ“Š è¯¦ç»†æ•°å€¼è®¡ç®—ç¤ºä¾‹ï¼ˆå«æ­¢æŸåœºæ™¯ï¼‰
- ğŸ’¡ é¢å‘å°ç™½ï¼Œé€šä¿—æ˜“æ‡‚
- âœ… è¦†ç›–æ‰€æœ‰å®ç°ç»†èŠ‚
- ğŸ”„ å®Œæ•´å¯¹ç§°æ€§è®¾è®¡ï¼ˆå¤šå¤´/ç©ºå¤´ï¼‰

**æ›´æ–°å†…å®¹ï¼ˆ2025-11-30ï¼‰**ï¼š
- âœ… æ–°å¢ç©ºå¤´æ­¢æŸæœºåˆ¶ï¼ˆä¸å¤šå¤´æ­¢æŸå¯¹ç§°ï¼‰
- âœ… æ›´æ–°ç­–ç•¥æ‰§è¡Œæµç¨‹å›¾ï¼ˆåŒå‘æ­¢æŸæ£€æŸ¥ï¼‰
- âœ… æ›´æ–°æ ¸å¿ƒäº¤æ˜“ç®—æ³•ï¼ˆcheck_stop_losså‡½æ•°ï¼‰
- âœ… æ–°å¢FAQ Q7ï¼ˆæ­¢æŸå¯¹æ¯”è¯´æ˜ï¼‰
- âœ… æ–°å¢ç¤ºä¾‹è®¡ç®—ï¼ˆç©ºå¤´æ­¢æŸåœºæ™¯ï¼‰

**å¯ä»¥å¼€å§‹å®ç°äº†ï¼** ğŸš€
